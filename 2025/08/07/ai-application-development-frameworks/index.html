<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.vjoker.blog","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.24.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="在混沌中寻找真相，在黑暗里绽放微笑">
<meta property="og:type" content="blog">
<meta property="og:title" content="V&#39;s Joker Blog">
<meta property="og:url" content="https://www.vjoker.blog/2025/08/07/ai-application-development-frameworks/index.html">
<meta property="og:site_name" content="V&#39;s Joker">
<meta property="og:description" content="在混沌中寻找真相，在黑暗里绽放微笑">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-08-07T05:00:00.000Z">
<meta property="article:modified_time" content="2025-08-25T01:02:07.702Z">
<meta property="article:author" content="V.Joker">
<meta property="article:tag" content="AI开发">
<meta property="article:tag" content="LangChain">
<meta property="article:tag" content="LlamaIndex">
<meta property="article:tag" content="RAG">
<meta property="article:tag" content="Agent">
<meta property="article:tag" content="向量数据库">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.vjoker.blog/2025/08/07/ai-application-development-frameworks/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.vjoker.blog/2025/08/07/ai-application-development-frameworks/","path":"2025/08/07/ai-application-development-frameworks/","title":"AI应用开发框架实战指南：从LangChain到LlamaIndex的完整攻略"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>AI应用开发框架实战指南：从LangChain到LlamaIndex的完整攻略 | V's Joker</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>







  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="V's Joker" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">V's Joker</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Remember remember the chaos and smile</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%8F%97%EF%B8%8F-AI%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6%E7%94%9F%E6%80%81"><span class="nav-number">1.</span> <span class="nav-text">🏗️ AI应用开发框架生态</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%8A-%E6%A1%86%E6%9E%B6%E5%88%86%E7%B1%BB%E5%92%8C%E5%AE%9A%E4%BD%8D"><span class="nav-number">1.1.</span> <span class="nav-text">📊 框架分类和定位</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%8E%AF-%E6%A0%B8%E5%BF%83%E8%83%BD%E5%8A%9B%E5%AF%B9%E6%AF%94"><span class="nav-number">1.2.</span> <span class="nav-text">🎯 核心能力对比</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%A6%9C-LangChain%EF%BC%9A%E6%9C%80%E5%85%A8%E9%9D%A2%E7%9A%84AI%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6"><span class="nav-number">2.</span> <span class="nav-text">🦜 LangChain：最全面的AI应用开发框架</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%94%A7-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-number">2.1.</span> <span class="nav-text">🔧 核心概念</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%BB%84%E4%BB%B6%E6%9E%B6%E6%9E%84"><span class="nav-number">2.1.1.</span> <span class="nav-text">1. 组件架构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%AE%BE%E8%AE%A1%E5%93%B2%E5%AD%A6"><span class="nav-number">2.1.2.</span> <span class="nav-text">2. 设计哲学</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%9A%80-%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE"><span class="nav-number">2.2.</span> <span class="nav-text">🚀 安装和配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%9D-%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="nav-number">2.3.</span> <span class="nav-text">📝 基础使用示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%AE%80%E5%8D%95%E7%9A%84LLM%E8%B0%83%E7%94%A8"><span class="nav-number">2.3.1.</span> <span class="nav-text">1. 简单的LLM调用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%A8%A1%E6%9D%BF"><span class="nav-number">2.3.2.</span> <span class="nav-text">2. 提示词模板</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E9%93%BE%E5%BC%8F%E7%BB%84%E5%90%88"><span class="nav-number">2.3.3.</span> <span class="nav-text">3. 链式组合</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%A4%96-Agent%E5%BC%80%E5%8F%91"><span class="nav-number">2.4.</span> <span class="nav-text">🤖 Agent开发</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%9F%BA%E7%A1%80Agent"><span class="nav-number">2.4.1.</span> <span class="nav-text">1. 基础Agent</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E9%AB%98%E7%BA%A7Agent%EF%BC%9AReAct%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.4.2.</span> <span class="nav-text">2. 高级Agent：ReAct模式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%92%BE-%E8%AE%B0%E5%BF%86%E7%AE%A1%E7%90%86"><span class="nav-number">2.5.</span> <span class="nav-text">💾 记忆管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BF%86"><span class="nav-number">2.5.1.</span> <span class="nav-text">1. 对话记忆</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%90%91%E9%87%8F%E8%AE%B0%E5%BF%86"><span class="nav-number">2.5.2.</span> <span class="nav-text">2. 向量记忆</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%94%8D-RAG%E7%B3%BB%E7%BB%9F%E6%9E%84%E5%BB%BA"><span class="nav-number">2.6.</span> <span class="nav-text">🔍 RAG系统构建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%9F%BA%E7%A1%80RAG%E5%AE%9E%E7%8E%B0"><span class="nav-number">2.6.1.</span> <span class="nav-text">1. 基础RAG实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E9%AB%98%E7%BA%A7RAG%EF%BC%9A%E5%A4%9A%E6%A8%A1%E6%80%81%E6%A3%80%E7%B4%A2"><span class="nav-number">2.6.2.</span> <span class="nav-text">2. 高级RAG：多模态检索</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%94%A7-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6"><span class="nav-number">2.7.</span> <span class="nav-text">🔧 自定义组件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E8%87%AA%E5%AE%9A%E4%B9%89LLM"><span class="nav-number">2.7.1.</span> <span class="nav-text">1. 自定义LLM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B7%A5%E5%85%B7"><span class="nav-number">2.7.2.</span> <span class="nav-text">2. 自定义工具</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%A6%99-LlamaIndex%EF%BC%9A%E4%B8%93%E4%B8%9A%E7%9A%84RAG%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6"><span class="nav-number">3.</span> <span class="nav-text">🦙 LlamaIndex：专业的RAG开发框架</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%8E%AF-%E6%A0%B8%E5%BF%83%E4%BC%98%E5%8A%BF"><span class="nav-number">3.1.</span> <span class="nav-text">🎯 核心优势</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%9A%80-%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B"><span class="nav-number">3.2.</span> <span class="nav-text">🚀 快速开始</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE"><span class="nav-number">3.2.1.</span> <span class="nav-text">1. 安装和配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="nav-number">3.2.2.</span> <span class="nav-text">2. 基础使用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%8A-%E9%AB%98%E7%BA%A7%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84"><span class="nav-number">3.3.</span> <span class="nav-text">📊 高级索引结构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%B1%82%E6%AC%A1%E7%B4%A2%E5%BC%95"><span class="nav-number">3.3.1.</span> <span class="nav-text">1. 层次索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%85%B3%E9%94%AE%E8%AF%8D%E7%B4%A2%E5%BC%95"><span class="nav-number">3.3.2.</span> <span class="nav-text">2. 关键词索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E7%B4%A2%E5%BC%95"><span class="nav-number">3.3.3.</span> <span class="nav-text">3. 知识图谱索引</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%94%8D-%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2%E6%8A%80%E6%9C%AF"><span class="nav-number">3.4.</span> <span class="nav-text">🔍 高级查询技术</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%A4%9A%E6%A8%A1%E6%80%81%E6%9F%A5%E8%AF%A2"><span class="nav-number">3.4.1.</span> <span class="nav-text">1. 多模态查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%AD%90%E9%97%AE%E9%A2%98%E6%9F%A5%E8%AF%A2"><span class="nav-number">3.4.2.</span> <span class="nav-text">2. 子问题查询</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%88-RAG%E8%AF%84%E4%BC%B0"><span class="nav-number">3.5.</span> <span class="nav-text">📈 RAG评估</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E8%AF%84%E4%BC%B0%E6%8C%87%E6%A0%87"><span class="nav-number">3.5.1.</span> <span class="nav-text">1. 评估指标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%84%E4%BC%B0"><span class="nav-number">3.5.2.</span> <span class="nav-text">2. 自定义评估</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%97%84%EF%B8%8F-%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E6%88%98"><span class="nav-number">4.</span> <span class="nav-text">🗄️ 向量数据库实战</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%8E%A8-Chroma%EF%BC%9A%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">4.1.</span> <span class="nav-text">🎨 Chroma：轻量级向量数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="nav-number">4.1.1.</span> <span class="nav-text">1. 基础使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD"><span class="nav-number">4.1.2.</span> <span class="nav-text">2. 高级功能</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%8C-Pinecone%EF%BC%9A%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">4.2.</span> <span class="nav-text">📌 Pinecone：企业级向量数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE"><span class="nav-number">4.2.1.</span> <span class="nav-text">1. 基础配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C"><span class="nav-number">4.2.2.</span> <span class="nav-text">2. 数据操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.2.3.</span> <span class="nav-text">3. 高级查询</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%8E%A8-UI%E6%A1%86%E6%9E%B6%EF%BC%9AGradio%E5%92%8CStreamlit"><span class="nav-number">5.</span> <span class="nav-text">🎨 UI框架：Gradio和Streamlit</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%9A%80-Gradio%EF%BC%9A%E5%BF%AB%E9%80%9FAI%E5%BA%94%E7%94%A8%E5%8E%9F%E5%9E%8B"><span class="nav-number">5.1.</span> <span class="nav-text">🚀 Gradio：快速AI应用原型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%9F%BA%E7%A1%80%E7%95%8C%E9%9D%A2"><span class="nav-number">5.1.1.</span> <span class="nav-text">1. 基础界面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%A4%9A%E5%8A%9F%E8%83%BD%E5%BA%94%E7%94%A8"><span class="nav-number">5.1.2.</span> <span class="nav-text">2. 多功能应用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%8A-Streamlit%EF%BC%9A%E6%95%B0%E6%8D%AE%E9%A9%B1%E5%8A%A8%E7%9A%84AI%E5%BA%94%E7%94%A8"><span class="nav-number">5.2.</span> <span class="nav-text">📊 Streamlit：数据驱动的AI应用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8"><span class="nav-number">5.2.1.</span> <span class="nav-text">1. 基础应用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD-1"><span class="nav-number">5.2.2.</span> <span class="nav-text">2. 高级功能</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%94%A7-%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%9E%84%E5%BB%BA%E5%AE%8C%E6%95%B4%E7%9A%84RAG%E5%BA%94%E7%94%A8"><span class="nav-number">6.</span> <span class="nav-text">🔧 实战项目：构建完整的RAG应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%8B-%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84"><span class="nav-number">6.1.</span> <span class="nav-text">📋 项目架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%8F%97%EF%B8%8F-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E5%AE%9E%E7%8E%B0"><span class="nav-number">6.2.</span> <span class="nav-text">🏗️ 核心组件实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86"><span class="nav-number">6.2.1.</span> <span class="nav-text">1. 配置管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%96%87%E6%A1%A3%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="nav-number">6.2.2.</span> <span class="nav-text">2. 文档加载器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%90%91%E9%87%8F%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86"><span class="nav-number">6.2.3.</span> <span class="nav-text">3. 向量存储管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E6%A3%80%E7%B4%A2%E5%99%A8"><span class="nav-number">6.2.4.</span> <span class="nav-text">4. 检索器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E7%94%9F%E6%88%90%E5%99%A8"><span class="nav-number">6.2.5.</span> <span class="nav-text">5. 生成器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%96%A5%EF%B8%8F-Streamlit%E5%BA%94%E7%94%A8%E7%95%8C%E9%9D%A2"><span class="nav-number">6.3.</span> <span class="nav-text">🖥️ Streamlit应用界面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%A6-%E9%83%A8%E7%BD%B2%E9%85%8D%E7%BD%AE"><span class="nav-number">6.4.</span> <span class="nav-text">📦 部署配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E4%BE%9D%E8%B5%96%E6%96%87%E4%BB%B6"><span class="nav-number">6.4.1.</span> <span class="nav-text">1. 依赖文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="nav-number">6.4.2.</span> <span class="nav-text">2. 环境配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC"><span class="nav-number">6.4.3.</span> <span class="nav-text">3. 启动脚本</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%9A%80-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E5%92%8C%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE"><span class="nav-number">7.</span> <span class="nav-text">🚀 最佳实践和优化建议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">7.1.</span> <span class="nav-text">1. 性能优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-number">7.2.</span> <span class="nav-text">2. 错误处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%9B%91%E6%8E%A7%E5%92%8C%E6%97%A5%E5%BF%97"><span class="nav-number">7.3.</span> <span class="nav-text">3. 监控和日志</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%93%88-%E8%BF%9B%E9%98%B6%E5%8A%9F%E8%83%BD%E6%89%A9%E5%B1%95"><span class="nav-number">8.</span> <span class="nav-text">📈 进阶功能扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%A4%9A%E6%A8%A1%E6%80%81RAG"><span class="nav-number">8.1.</span> <span class="nav-text">1. 多模态RAG</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AE%9E%E6%97%B6%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%9B%B4%E6%96%B0"><span class="nav-number">8.2.</span> <span class="nav-text">2. 实时学习和更新</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%8E%AF-%E6%80%BB%E7%BB%93%E5%92%8C%E9%80%89%E6%8B%A9%E5%BB%BA%E8%AE%AE"><span class="nav-number">9.</span> <span class="nav-text">🎯 总结和选择建议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%86%E6%9E%B6%E9%80%89%E6%8B%A9%E7%9F%A9%E9%98%B5"><span class="nav-number">9.1.</span> <span class="nav-text">框架选择矩阵</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84%E5%BB%BA%E8%AE%AE"><span class="nav-number">9.2.</span> <span class="nav-text">学习路径建议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3"><span class="nav-number">9.3.</span> <span class="nav-text">常见问题解决</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="V.Joker"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">V.Joker</p>
  <div class="site-description" itemprop="description">在混沌中寻找真相，在黑暗里绽放微笑</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">37</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">116</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/itzdd9527" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;itzdd9527" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yourname@gmail.com" title="E-Mail → mailto:yourname@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vjoker.blog/2025/08/07/ai-application-development-frameworks/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="V.Joker">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="V's Joker">
      <meta itemprop="description" content="在混沌中寻找真相，在黑暗里绽放微笑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="AI应用开发框架实战指南：从LangChain到LlamaIndex的完整攻略 | V's Joker">
      <meta itemprop="description" content="深入学习主流AI应用开发框架，包括LangChain、LlamaIndex、向量数据库等工具的实战使用方法和最佳实践。">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AI应用开发框架实战指南：从LangChain到LlamaIndex的完整攻略
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-08-07 13:00:00" itemprop="dateCreated datePublished" datetime="2025-08-07T13:00:00+08:00">2025-08-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-08-25 09:02:07" itemprop="dateModified" datetime="2025-08-25T09:02:07+08:00">2025-08-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">AI技术</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI%E6%8A%80%E6%9C%AF/%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">开发框架</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">深入学习主流AI应用开发框架，包括LangChain、LlamaIndex、向量数据库等工具的实战使用方法和最佳实践。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>AI应用开发框架为构建智能应用提供了强大的基础设施，让开发者能够快速构建复杂的AI系统。本文将深入介绍主流框架的使用方法，从基础概念到实战项目，帮助您掌握现代AI应用开发的核心技能。</p>
<span id="more"></span>

<h2 id="🏗️-AI应用开发框架生态"><a href="#🏗️-AI应用开发框架生态" class="headerlink" title="🏗️ AI应用开发框架生态"></a>🏗️ AI应用开发框架生态</h2><h3 id="📊-框架分类和定位"><a href="#📊-框架分类和定位" class="headerlink" title="📊 框架分类和定位"></a>📊 框架分类和定位</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[AI应用开发框架] --&gt; B[应用编排框架]</span><br><span class="line">    A --&gt; C[数据处理框架]</span><br><span class="line">    A --&gt; D[向量数据库]</span><br><span class="line">    A --&gt; E[UI框架]</span><br><span class="line">    </span><br><span class="line">    B --&gt; B1[LangChain]</span><br><span class="line">    B --&gt; B2[LlamaIndex]</span><br><span class="line">    B --&gt; B3[Semantic Kernel]</span><br><span class="line">    </span><br><span class="line">    C --&gt; C1[Transformers]</span><br><span class="line">    C --&gt; C2[Datasets]</span><br><span class="line">    C --&gt; C3[Accelerate]</span><br><span class="line">    </span><br><span class="line">    D --&gt; D1[Chroma]</span><br><span class="line">    D --&gt; D2[Pinecone]</span><br><span class="line">    D --&gt; D3[Weaviate]</span><br><span class="line">    D --&gt; D4[Qdrant]</span><br><span class="line">    </span><br><span class="line">    E --&gt; E1[Gradio]</span><br><span class="line">    E --&gt; E2[Streamlit]</span><br><span class="line">    E --&gt; E3[Chainlit]</span><br></pre></td></tr></table></figure>

<h3 id="🎯-核心能力对比"><a href="#🎯-核心能力对比" class="headerlink" title="🎯 核心能力对比"></a>🎯 核心能力对比</h3><table>
<thead>
<tr>
<th>框架</th>
<th>主要用途</th>
<th>核心优势</th>
<th>学习难度</th>
<th>生态成熟度</th>
</tr>
</thead>
<tbody><tr>
<td><strong>LangChain</strong></td>
<td>通用AI应用</td>
<td>生态丰富，组件完整</td>
<td>中等</td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
<tr>
<td><strong>LlamaIndex</strong></td>
<td>RAG应用</td>
<td>数据处理强，索引优化</td>
<td>简单</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td><strong>Transformers</strong></td>
<td>模型使用</td>
<td>模型丰富，性能优秀</td>
<td>中等</td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
<tr>
<td><strong>Gradio</strong></td>
<td>快速原型</td>
<td>简单易用，部署便捷</td>
<td>简单</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td><strong>Streamlit</strong></td>
<td>数据应用</td>
<td>交互丰富，可视化强</td>
<td>简单</td>
<td>⭐⭐⭐⭐</td>
</tr>
</tbody></table>
<h2 id="🦜-LangChain：最全面的AI应用开发框架"><a href="#🦜-LangChain：最全面的AI应用开发框架" class="headerlink" title="🦜 LangChain：最全面的AI应用开发框架"></a>🦜 LangChain：最全面的AI应用开发框架</h2><p><strong>官方网站</strong>：<a target="_blank" rel="noopener" href="https://langchain.com/">https://langchain.com</a><br><strong>GitHub</strong>：<a target="_blank" rel="noopener" href="https://github.com/langchain-ai/langchain">https://github.com/langchain-ai/langchain</a></p>
<p>LangChain是目前最受欢迎的AI应用开发框架，提供了构建复杂AI应用所需的全套工具。</p>
<h3 id="🔧-核心概念"><a href="#🔧-核心概念" class="headerlink" title="🔧 核心概念"></a>🔧 核心概念</h3><h4 id="1-组件架构"><a href="#1-组件架构" class="headerlink" title="1. 组件架构"></a>1. 组件架构</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># LangChain核心组件</span></span><br><span class="line">components = &#123;</span><br><span class="line">    <span class="string">&quot;Models&quot;</span>: <span class="string">&quot;语言模型抽象层&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Prompts&quot;</span>: <span class="string">&quot;提示词模板管理&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Chains&quot;</span>: <span class="string">&quot;组件链式组合&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Agents&quot;</span>: <span class="string">&quot;智能决策代理&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Memory&quot;</span>: <span class="string">&quot;对话记忆管理&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Retrievers&quot;</span>: <span class="string">&quot;信息检索组件&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Tools&quot;</span>: <span class="string">&quot;外部工具集成&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Callbacks&quot;</span>: <span class="string">&quot;执行过程监控&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-设计哲学"><a href="#2-设计哲学" class="headerlink" title="2. 设计哲学"></a>2. 设计哲学</h4><ul>
<li><strong>模块化</strong>：每个组件都可以独立使用和替换</li>
<li><strong>可组合</strong>：通过链式调用构建复杂应用</li>
<li><strong>可扩展</strong>：支持自定义组件和工具</li>
<li><strong>可观测</strong>：完整的执行过程追踪</li>
</ul>
<h3 id="🚀-安装和配置"><a href="#🚀-安装和配置" class="headerlink" title="🚀 安装和配置"></a>🚀 安装和配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装核心包</span></span><br><span class="line">pip install langchain</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装社区包（更多集成）</span></span><br><span class="line">pip install langchain-community</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装实验性功能</span></span><br><span class="line">pip install langchain-experimental</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装特定集成</span></span><br><span class="line">pip install langchain-openai</span><br><span class="line">pip install langchain-anthropic</span><br><span class="line">pip install langchain-google-genai</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装向量数据库支持</span></span><br><span class="line">pip install chromadb</span><br><span class="line">pip install pinecone-client</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装其他依赖</span></span><br><span class="line">pip install tiktoken</span><br><span class="line">pip install faiss-cpu</span><br></pre></td></tr></table></figure>

<h3 id="📝-基础使用示例"><a href="#📝-基础使用示例" class="headerlink" title="📝 基础使用示例"></a>📝 基础使用示例</h3><h4 id="1-简单的LLM调用"><a href="#1-简单的LLM调用" class="headerlink" title="1. 简单的LLM调用"></a>1. 简单的LLM调用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> langchain.schema <span class="keyword">import</span> HumanMessage, SystemMessage</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化模型</span></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">    model=<span class="string">&quot;gpt-4-turbo&quot;</span>,</span><br><span class="line">    temperature=<span class="number">0.7</span>,</span><br><span class="line">    api_key=<span class="string">&quot;your-api-key&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建消息</span></span><br><span class="line">messages = [</span><br><span class="line">    SystemMessage(content=<span class="string">&quot;你是一个专业的Python编程助手。&quot;</span>),</span><br><span class="line">    HumanMessage(content=<span class="string">&quot;如何实现一个简单的装饰器？&quot;</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取回复</span></span><br><span class="line">response = llm.invoke(messages)</span><br><span class="line"><span class="built_in">print</span>(response.content)</span><br></pre></td></tr></table></figure>

<h4 id="2-提示词模板"><a href="#2-提示词模板" class="headerlink" title="2. 提示词模板"></a>2. 提示词模板</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.prompts <span class="keyword">import</span> ChatPromptTemplate, PromptTemplate</span><br><span class="line"><span class="keyword">from</span> langchain.prompts.few_shot <span class="keyword">import</span> FewShotPromptTemplate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 基础提示词模板</span></span><br><span class="line">prompt = ChatPromptTemplate.from_messages([</span><br><span class="line">    (<span class="string">&quot;system&quot;</span>, <span class="string">&quot;你是一个&#123;role&#125;，专门帮助用户&#123;task&#125;。&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;human&quot;</span>, <span class="string">&quot;请帮我&#123;request&#125;&quot;</span>)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 格式化提示词</span></span><br><span class="line">formatted_prompt = prompt.format_messages(</span><br><span class="line">    role=<span class="string">&quot;数据分析师&quot;</span>,</span><br><span class="line">    task=<span class="string">&quot;分析数据和生成报告&quot;</span>,</span><br><span class="line">    request=<span class="string">&quot;分析这个销售数据的趋势&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(formatted_prompt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Few-shot提示词</span></span><br><span class="line">examples = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;question&quot;</span>: <span class="string">&quot;什么是机器学习？&quot;</span>,</span><br><span class="line">        <span class="string">&quot;answer&quot;</span>: <span class="string">&quot;机器学习是人工智能的一个分支，通过算法让计算机从数据中学习模式。&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;question&quot;</span>: <span class="string">&quot;什么是深度学习？&quot;</span>,</span><br><span class="line">        <span class="string">&quot;answer&quot;</span>: <span class="string">&quot;深度学习是机器学习的子集，使用多层神经网络来处理复杂数据。&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">example_prompt = PromptTemplate(</span><br><span class="line">    input_variables=[<span class="string">&quot;question&quot;</span>, <span class="string">&quot;answer&quot;</span>],</span><br><span class="line">    template=<span class="string">&quot;问题: &#123;question&#125;\n答案: &#123;answer&#125;&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">few_shot_prompt = FewShotPromptTemplate(</span><br><span class="line">    examples=examples,</span><br><span class="line">    example_prompt=example_prompt,</span><br><span class="line">    prefix=<span class="string">&quot;以下是一些问答示例：&quot;</span>,</span><br><span class="line">    suffix=<span class="string">&quot;问题: &#123;input&#125;\n答案:&quot;</span>,</span><br><span class="line">    input_variables=[<span class="string">&quot;input&quot;</span>]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(few_shot_prompt.<span class="built_in">format</span>(<span class="built_in">input</span>=<span class="string">&quot;什么是自然语言处理？&quot;</span>))</span><br></pre></td></tr></table></figure>

<h4 id="3-链式组合"><a href="#3-链式组合" class="headerlink" title="3. 链式组合"></a>3. 链式组合</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> LLMChain, SimpleSequentialChain</span><br><span class="line"><span class="keyword">from</span> langchain.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一个链：生成故事大纲</span></span><br><span class="line">outline_prompt = PromptTemplate(</span><br><span class="line">    input_variables=[<span class="string">&quot;topic&quot;</span>],</span><br><span class="line">    template=<span class="string">&quot;为以下主题创建一个故事大纲：&#123;topic&#125;&quot;</span></span><br><span class="line">)</span><br><span class="line">outline_chain = LLMChain(llm=llm, prompt=outline_prompt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二个链：扩展故事</span></span><br><span class="line">story_prompt = PromptTemplate(</span><br><span class="line">    input_variables=[<span class="string">&quot;outline&quot;</span>],</span><br><span class="line">    template=<span class="string">&quot;基于以下大纲写一个完整的短故事：&#123;outline&#125;&quot;</span></span><br><span class="line">)</span><br><span class="line">story_chain = LLMChain(llm=llm, prompt=story_prompt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 组合链</span></span><br><span class="line">full_chain = SimpleSequentialChain(</span><br><span class="line">    chains=[outline_chain, story_chain],</span><br><span class="line">    verbose=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行链</span></span><br><span class="line">result = full_chain.run(<span class="string">&quot;一个关于AI和人类友谊的科幻故事&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h3 id="🤖-Agent开发"><a href="#🤖-Agent开发" class="headerlink" title="🤖 Agent开发"></a>🤖 Agent开发</h3><h4 id="1-基础Agent"><a href="#1-基础Agent" class="headerlink" title="1. 基础Agent"></a>1. 基础Agent</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> create_openai_tools_agent, AgentExecutor</span><br><span class="line"><span class="keyword">from</span> langchain.tools <span class="keyword">import</span> Tool</span><br><span class="line"><span class="keyword">from</span> langchain_community.tools <span class="keyword">import</span> DuckDuckGoSearchRun</span><br><span class="line"><span class="keyword">from</span> langchain.prompts <span class="keyword">import</span> ChatPromptTemplate</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义自定义工具</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_weather</span>(<span class="params">city: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;获取指定城市的天气信息&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 这里应该调用真实的天气API</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;city&#125;</span>今天天气晴朗，温度25°C&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate</span>(<span class="params">expression: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;计算数学表达式&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = <span class="built_in">eval</span>(expression)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;计算结果: <span class="subst">&#123;result&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;计算错误，请检查表达式&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建工具列表</span></span><br><span class="line">tools = [</span><br><span class="line">    Tool(</span><br><span class="line">        name=<span class="string">&quot;搜索&quot;</span>,</span><br><span class="line">        func=DuckDuckGoSearchRun().run,</span><br><span class="line">        description=<span class="string">&quot;用于搜索最新信息和回答问题&quot;</span></span><br><span class="line">    ),</span><br><span class="line">    Tool(</span><br><span class="line">        name=<span class="string">&quot;天气查询&quot;</span>,</span><br><span class="line">        func=get_weather,</span><br><span class="line">        description=<span class="string">&quot;查询指定城市的天气信息，输入城市名称&quot;</span></span><br><span class="line">    ),</span><br><span class="line">    Tool(</span><br><span class="line">        name=<span class="string">&quot;计算器&quot;</span>,</span><br><span class="line">        func=calculate,</span><br><span class="line">        description=<span class="string">&quot;计算数学表达式，输入要计算的表达式&quot;</span></span><br><span class="line">    )</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Agent提示词</span></span><br><span class="line">prompt = ChatPromptTemplate.from_messages([</span><br><span class="line">    (<span class="string">&quot;system&quot;</span>, <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    你是一个有用的AI助手，可以使用以下工具来帮助用户：</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    &#123;tools&#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    使用以下格式：</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Question: 用户的问题</span></span><br><span class="line"><span class="string">    Thought: 你应该思考要做什么</span></span><br><span class="line"><span class="string">    Action: 要使用的工具名称</span></span><br><span class="line"><span class="string">    Action Input: 工具的输入</span></span><br><span class="line"><span class="string">    Observation: 工具的输出</span></span><br><span class="line"><span class="string">    ... (这个思考/行动/观察的过程可以重复N次)</span></span><br><span class="line"><span class="string">    Thought: 我现在知道最终答案了</span></span><br><span class="line"><span class="string">    Final Answer: 对原始问题的最终答案</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;human&quot;</span>, <span class="string">&quot;&#123;input&#125;&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;&#123;agent_scratchpad&#125;&quot;</span>)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Agent</span></span><br><span class="line">agent = create_openai_tools_agent(llm, tools, prompt)</span><br><span class="line">agent_executor = AgentExecutor(agent=agent, tools=tools, verbose=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用Agent</span></span><br><span class="line">result = agent_executor.invoke(&#123;</span><br><span class="line">    <span class="string">&quot;input&quot;</span>: <span class="string">&quot;北京今天天气怎么样？另外帮我计算一下 25 * 4 + 10 等于多少？&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result[<span class="string">&quot;output&quot;</span>])</span><br></pre></td></tr></table></figure>

<h4 id="2-高级Agent：ReAct模式"><a href="#2-高级Agent：ReAct模式" class="headerlink" title="2. 高级Agent：ReAct模式"></a>2. 高级Agent：ReAct模式</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> create_react_agent</span><br><span class="line"><span class="keyword">from</span> langchain <span class="keyword">import</span> hub</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用预定义的ReAct提示词</span></span><br><span class="line">react_prompt = hub.pull(<span class="string">&quot;hwchase17/react&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建ReAct Agent</span></span><br><span class="line">react_agent = create_react_agent(llm, tools, react_prompt)</span><br><span class="line">react_executor = AgentExecutor(</span><br><span class="line">    agent=react_agent, </span><br><span class="line">    tools=tools, </span><br><span class="line">    verbose=<span class="literal">True</span>,</span><br><span class="line">    max_iterations=<span class="number">5</span>,</span><br><span class="line">    early_stopping_method=<span class="string">&quot;generate&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复杂任务执行</span></span><br><span class="line">complex_task = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">请帮我完成以下任务：</span></span><br><span class="line"><span class="string">1. 搜索最新的AI技术趋势</span></span><br><span class="line"><span class="string">2. 查询上海的天气情况</span></span><br><span class="line"><span class="string">3. 计算如果我每天学习2小时，一年能学习多少小时</span></span><br><span class="line"><span class="string">4. 基于以上信息，给我一个学习AI的建议</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">result = react_executor.invoke(&#123;<span class="string">&quot;input&quot;</span>: complex_task&#125;)</span><br><span class="line"><span class="built_in">print</span>(result[<span class="string">&quot;output&quot;</span>])</span><br></pre></td></tr></table></figure>

<h3 id="💾-记忆管理"><a href="#💾-记忆管理" class="headerlink" title="💾 记忆管理"></a>💾 记忆管理</h3><h4 id="1-对话记忆"><a href="#1-对话记忆" class="headerlink" title="1. 对话记忆"></a>1. 对话记忆</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.memory <span class="keyword">import</span> ConversationBufferMemory, ConversationSummaryMemory</span><br><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> ConversationChain</span><br><span class="line"></span><br><span class="line"><span class="comment"># 缓冲记忆（保存完整对话历史）</span></span><br><span class="line">buffer_memory = ConversationBufferMemory()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 摘要记忆（压缩历史对话）</span></span><br><span class="line">summary_memory = ConversationSummaryMemory(llm=llm)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建对话链</span></span><br><span class="line">conversation = ConversationChain(</span><br><span class="line">    llm=llm,</span><br><span class="line">    memory=buffer_memory,</span><br><span class="line">    verbose=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多轮对话</span></span><br><span class="line"><span class="built_in">print</span>(conversation.predict(<span class="built_in">input</span>=<span class="string">&quot;你好，我叫张三&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(conversation.predict(<span class="built_in">input</span>=<span class="string">&quot;我喜欢编程&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(conversation.predict(<span class="built_in">input</span>=<span class="string">&quot;你还记得我的名字吗？&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看记忆内容</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n记忆内容:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(buffer_memory.buffer)</span><br></pre></td></tr></table></figure>

<h4 id="2-向量记忆"><a href="#2-向量记忆" class="headerlink" title="2. 向量记忆"></a>2. 向量记忆</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.memory <span class="keyword">import</span> VectorStoreRetrieverMemory</span><br><span class="line"><span class="keyword">from</span> langchain.vectorstores <span class="keyword">import</span> Chroma</span><br><span class="line"><span class="keyword">from</span> langchain.embeddings <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建向量存储</span></span><br><span class="line">embeddings = OpenAIEmbeddings()</span><br><span class="line">vectorstore = Chroma(embedding_function=embeddings)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建向量记忆</span></span><br><span class="line">vector_memory = VectorStoreRetrieverMemory(</span><br><span class="line">    retriever=vectorstore.as_retriever(search_kwargs=&#123;<span class="string">&quot;k&quot;</span>: <span class="number">3</span>&#125;)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存记忆</span></span><br><span class="line">vector_memory.save_context(</span><br><span class="line">    &#123;<span class="string">&quot;input&quot;</span>: <span class="string">&quot;我最喜欢的编程语言是Python&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;output&quot;</span>: <span class="string">&quot;很好！Python是一门优秀的编程语言。&quot;</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">vector_memory.save_context(</span><br><span class="line">    &#123;<span class="string">&quot;input&quot;</span>: <span class="string">&quot;我在学习机器学习&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;output&quot;</span>: <span class="string">&quot;机器学习是一个很有前景的领域。&quot;</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检索相关记忆</span></span><br><span class="line">relevant_memories = vector_memory.load_memory_variables(</span><br><span class="line">    &#123;<span class="string">&quot;prompt&quot;</span>: <span class="string">&quot;编程语言&quot;</span>&#125;</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(relevant_memories)</span><br></pre></td></tr></table></figure>

<h3 id="🔍-RAG系统构建"><a href="#🔍-RAG系统构建" class="headerlink" title="🔍 RAG系统构建"></a>🔍 RAG系统构建</h3><h4 id="1-基础RAG实现"><a href="#1-基础RAG实现" class="headerlink" title="1. 基础RAG实现"></a>1. 基础RAG实现</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.document_loaders <span class="keyword">import</span> TextLoader, PyPDFLoader</span><br><span class="line"><span class="keyword">from</span> langchain.text_splitter <span class="keyword">import</span> RecursiveCharacterTextSplitter</span><br><span class="line"><span class="keyword">from</span> langchain.vectorstores <span class="keyword">import</span> Chroma</span><br><span class="line"><span class="keyword">from</span> langchain.embeddings <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> RetrievalQA</span><br><span class="line"><span class="keyword">from</span> langchain.retrievers <span class="keyword">import</span> ContextualCompressionRetriever</span><br><span class="line"><span class="keyword">from</span> langchain.retrievers.document_compressors <span class="keyword">import</span> LLMChainExtractor</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 加载文档</span></span><br><span class="line">loader = TextLoader(<span class="string">&quot;knowledge_base.txt&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">documents = loader.load()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 文档分割</span></span><br><span class="line">text_splitter = RecursiveCharacterTextSplitter(</span><br><span class="line">    chunk_size=<span class="number">1000</span>,</span><br><span class="line">    chunk_overlap=<span class="number">200</span>,</span><br><span class="line">    length_function=<span class="built_in">len</span></span><br><span class="line">)</span><br><span class="line">splits = text_splitter.split_documents(documents)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 创建向量存储</span></span><br><span class="line">embeddings = OpenAIEmbeddings()</span><br><span class="line">vectorstore = Chroma.from_documents(</span><br><span class="line">    documents=splits,</span><br><span class="line">    embedding=embeddings,</span><br><span class="line">    persist_directory=<span class="string">&quot;./chroma_db&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 创建检索器</span></span><br><span class="line">retriever = vectorstore.as_retriever(</span><br><span class="line">    search_type=<span class="string">&quot;similarity&quot;</span>,</span><br><span class="line">    search_kwargs=&#123;<span class="string">&quot;k&quot;</span>: <span class="number">4</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 添加压缩检索（可选）</span></span><br><span class="line">compressor = LLMChainExtractor.from_llm(llm)</span><br><span class="line">compression_retriever = ContextualCompressionRetriever(</span><br><span class="line">    base_compressor=compressor,</span><br><span class="line">    base_retriever=retriever</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 创建QA链</span></span><br><span class="line">qa_chain = RetrievalQA.from_chain_type(</span><br><span class="line">    llm=llm,</span><br><span class="line">    chain_type=<span class="string">&quot;stuff&quot;</span>,</span><br><span class="line">    retriever=compression_retriever,</span><br><span class="line">    return_source_documents=<span class="literal">True</span>,</span><br><span class="line">    verbose=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. 查询</span></span><br><span class="line">query = <span class="string">&quot;什么是机器学习？&quot;</span></span><br><span class="line">result = qa_chain(&#123;<span class="string">&quot;query&quot;</span>: query&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;问题: <span class="subst">&#123;query&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;答案: <span class="subst">&#123;result[<span class="string">&#x27;result&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;\n来源文档:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(result[<span class="string">&#x27;source_documents&#x27;</span>]):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;文档 <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>: <span class="subst">&#123;doc.page_content[:<span class="number">200</span>]&#125;</span>...&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="2-高级RAG：多模态检索"><a href="#2-高级RAG：多模态检索" class="headerlink" title="2. 高级RAG：多模态检索"></a>2. 高级RAG：多模态检索</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.schema <span class="keyword">import</span> Document</span><br><span class="line"><span class="keyword">from</span> langchain.retrievers <span class="keyword">import</span> EnsembleRetriever</span><br><span class="line"><span class="keyword">from</span> langchain.retrievers <span class="keyword">import</span> BM25Retriever</span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"></span><br><span class="line"><span class="comment"># 中文分词函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chinese_tokenizer</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(jieba.cut(text))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建BM25检索器（关键词检索）</span></span><br><span class="line">bm25_retriever = BM25Retriever.from_documents(</span><br><span class="line">    splits,</span><br><span class="line">    preprocess_func=chinese_tokenizer</span><br><span class="line">)</span><br><span class="line">bm25_retriever.k = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建混合检索器</span></span><br><span class="line">ensemble_retriever = EnsembleRetriever(</span><br><span class="line">    retrievers=[vectorstore.as_retriever(), bm25_retriever],</span><br><span class="line">    weights=[<span class="number">0.7</span>, <span class="number">0.3</span>]  <span class="comment"># 向量检索权重0.7，关键词检索权重0.3</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用混合检索器</span></span><br><span class="line">hybrid_qa_chain = RetrievalQA.from_chain_type(</span><br><span class="line">    llm=llm,</span><br><span class="line">    chain_type=<span class="string">&quot;stuff&quot;</span>,</span><br><span class="line">    retriever=ensemble_retriever,</span><br><span class="line">    return_source_documents=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">result = hybrid_qa_chain(&#123;<span class="string">&quot;query&quot;</span>: <span class="string">&quot;深度学习的应用领域&quot;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(result[<span class="string">&#x27;result&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h3 id="🔧-自定义组件"><a href="#🔧-自定义组件" class="headerlink" title="🔧 自定义组件"></a>🔧 自定义组件</h3><h4 id="1-自定义LLM"><a href="#1-自定义LLM" class="headerlink" title="1. 自定义LLM"></a>1. 自定义LLM</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.llms.base <span class="keyword">import</span> LLM</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span>, <span class="type">List</span>, <span class="type">Any</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomLLM</span>(<span class="title class_ inherited__">LLM</span>):</span><br><span class="line">    api_url: <span class="built_in">str</span></span><br><span class="line">    api_key: <span class="built_in">str</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_llm_type</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;custom&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_call</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        prompt: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        stop: <span class="type">Optional</span>[<span class="type">List</span>[<span class="built_in">str</span>]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        run_manager: <span class="type">Optional</span>[<span class="type">Any</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        **kwargs: <span class="type">Any</span>,</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="comment"># 自定义API调用逻辑</span></span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">&quot;Authorization&quot;</span>: <span class="string">f&quot;Bearer <span class="subst">&#123;self.api_key&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;prompt&quot;</span>: prompt,</span><br><span class="line">            <span class="string">&quot;max_tokens&quot;</span>: kwargs.get(<span class="string">&quot;max_tokens&quot;</span>, <span class="number">100</span>),</span><br><span class="line">            <span class="string">&quot;temperature&quot;</span>: kwargs.get(<span class="string">&quot;temperature&quot;</span>, <span class="number">0.7</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        response = requests.post(<span class="variable language_">self</span>.api_url, headers=headers, json=data)</span><br><span class="line">        <span class="keyword">return</span> response.json().get(<span class="string">&quot;text&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_identifying_params</span>(<span class="params">self</span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;api_url&quot;</span>: <span class="variable language_">self</span>.api_url&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用自定义LLM</span></span><br><span class="line">custom_llm = CustomLLM(</span><br><span class="line">    api_url=<span class="string">&quot;https://your-api-endpoint.com/generate&quot;</span>,</span><br><span class="line">    api_key=<span class="string">&quot;your-api-key&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="2-自定义工具"><a href="#2-自定义工具" class="headerlink" title="2. 自定义工具"></a>2. 自定义工具</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.tools <span class="keyword">import</span> BaseTool</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span>, <span class="type">Type</span></span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WeatherInput</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    city: <span class="built_in">str</span> = Field(description=<span class="string">&quot;城市名称&quot;</span>)</span><br><span class="line">    date: <span class="type">Optional</span>[<span class="built_in">str</span>] = Field(description=<span class="string">&quot;日期，格式：YYYY-MM-DD&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WeatherTool</span>(<span class="title class_ inherited__">BaseTool</span>):</span><br><span class="line">    name = <span class="string">&quot;weather_query&quot;</span></span><br><span class="line">    description = <span class="string">&quot;查询指定城市和日期的天气信息&quot;</span></span><br><span class="line">    args_schema: <span class="type">Type</span>[BaseModel] = WeatherInput</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_run</span>(<span class="params">self, city: <span class="built_in">str</span>, date: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="comment"># 实际的天气查询逻辑</span></span><br><span class="line">        <span class="keyword">if</span> date:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;city&#125;</span>在<span class="subst">&#123;date&#125;</span>的天气：晴朗，温度20-25°C&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;city&#125;</span>今天天气：晴朗，温度20-25°C&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">_arun</span>(<span class="params">self, city: <span class="built_in">str</span>, date: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="comment"># 异步版本</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._run(city, date)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用自定义工具</span></span><br><span class="line">weather_tool = WeatherTool()</span><br><span class="line">result = weather_tool.run(&#123;<span class="string">&quot;city&quot;</span>: <span class="string">&quot;北京&quot;</span>, <span class="string">&quot;date&quot;</span>: <span class="string">&quot;2024-01-15&quot;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h2 id="🦙-LlamaIndex：专业的RAG开发框架"><a href="#🦙-LlamaIndex：专业的RAG开发框架" class="headerlink" title="🦙 LlamaIndex：专业的RAG开发框架"></a>🦙 LlamaIndex：专业的RAG开发框架</h2><p><strong>官方网站</strong>：<a target="_blank" rel="noopener" href="https://llamaindex.ai/">https://llamaindex.ai</a><br><strong>GitHub</strong>：<a target="_blank" rel="noopener" href="https://github.com/run-llama/llama_index">https://github.com/run-llama/llama_index</a></p>
<p>LlamaIndex专注于数据索引和检索，是构建RAG应用的最佳选择。</p>
<h3 id="🎯-核心优势"><a href="#🎯-核心优势" class="headerlink" title="🎯 核心优势"></a>🎯 核心优势</h3><ul>
<li><strong>数据连接器</strong>：支持100+种数据源</li>
<li><strong>索引结构</strong>：多种高效的索引算法</li>
<li><strong>查询引擎</strong>：智能的查询处理</li>
<li><strong>评估工具</strong>：完整的RAG评估体系</li>
</ul>
<h3 id="🚀-快速开始"><a href="#🚀-快速开始" class="headerlink" title="🚀 快速开始"></a>🚀 快速开始</h3><h4 id="1-安装和配置"><a href="#1-安装和配置" class="headerlink" title="1. 安装和配置"></a>1. 安装和配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装核心包</span></span><br><span class="line">pip install llama-index</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装特定集成</span></span><br><span class="line">pip install llama-index-llms-openai</span><br><span class="line">pip install llama-index-embeddings-openai</span><br><span class="line">pip install llama-index-vector-stores-chroma</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装数据加载器</span></span><br><span class="line">pip install llama-index-readers-file</span><br><span class="line">pip install llama-index-readers-web</span><br></pre></td></tr></table></figure>

<h4 id="2-基础使用"><a href="#2-基础使用" class="headerlink" title="2. 基础使用"></a>2. 基础使用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> VectorStoreIndex, SimpleDirectoryReader</span><br><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> Settings</span><br><span class="line"><span class="keyword">from</span> llama_index.llms.openai <span class="keyword">import</span> OpenAI</span><br><span class="line"><span class="keyword">from</span> llama_index.embeddings.openai <span class="keyword">import</span> OpenAIEmbedding</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置全局设置</span></span><br><span class="line">Settings.llm = OpenAI(model=<span class="string">&quot;gpt-4-turbo&quot;</span>, api_key=<span class="string">&quot;your-api-key&quot;</span>)</span><br><span class="line">Settings.embed_model = OpenAIEmbedding(api_key=<span class="string">&quot;your-api-key&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载文档</span></span><br><span class="line">documents = SimpleDirectoryReader(<span class="string">&quot;./data&quot;</span>).load_data()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建索引</span></span><br><span class="line">index = VectorStoreIndex.from_documents(documents)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建查询引擎</span></span><br><span class="line">query_engine = index.as_query_engine()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询</span></span><br><span class="line">response = query_engine.query(<span class="string">&quot;什么是人工智能？&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure>

<h3 id="📊-高级索引结构"><a href="#📊-高级索引结构" class="headerlink" title="📊 高级索引结构"></a>📊 高级索引结构</h3><h4 id="1-层次索引"><a href="#1-层次索引" class="headerlink" title="1. 层次索引"></a>1. 层次索引</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> TreeIndex</span><br><span class="line"><span class="keyword">from</span> llama_index.core.node_parser <span class="keyword">import</span> SentenceSplitter</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建节点解析器</span></span><br><span class="line">node_parser = SentenceSplitter(</span><br><span class="line">    chunk_size=<span class="number">1024</span>,</span><br><span class="line">    chunk_overlap=<span class="number">20</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析文档为节点</span></span><br><span class="line">nodes = node_parser.get_nodes_from_documents(documents)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建树形索引</span></span><br><span class="line">tree_index = TreeIndex(nodes)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建查询引擎</span></span><br><span class="line">tree_query_engine = tree_index.as_query_engine(</span><br><span class="line">    retriever_mode=<span class="string">&quot;select_leaf_embedding&quot;</span>,</span><br><span class="line">    response_mode=<span class="string">&quot;tree_summarize&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">response = tree_query_engine.query(<span class="string">&quot;总结文档的主要内容&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure>

<h4 id="2-关键词索引"><a href="#2-关键词索引" class="headerlink" title="2. 关键词索引"></a>2. 关键词索引</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> KeywordTableIndex</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建关键词索引</span></span><br><span class="line">keyword_index = KeywordTableIndex.from_documents(documents)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询</span></span><br><span class="line">keyword_query_engine = keyword_index.as_query_engine()</span><br><span class="line">response = keyword_query_engine.query(<span class="string">&quot;机器学习算法&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure>

<h4 id="3-知识图谱索引"><a href="#3-知识图谱索引" class="headerlink" title="3. 知识图谱索引"></a>3. 知识图谱索引</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> KnowledgeGraphIndex</span><br><span class="line"><span class="keyword">from</span> llama_index.core.graph_stores <span class="keyword">import</span> SimpleGraphStore</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建图存储</span></span><br><span class="line">graph_store = SimpleGraphStore()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建知识图谱索引</span></span><br><span class="line">kg_index = KnowledgeGraphIndex.from_documents(</span><br><span class="line">    documents,</span><br><span class="line">    graph_store=graph_store,</span><br><span class="line">    max_triplets_per_chunk=<span class="number">2</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询</span></span><br><span class="line">kg_query_engine = kg_index.as_query_engine(</span><br><span class="line">    include_text=<span class="literal">True</span>,</span><br><span class="line">    response_mode=<span class="string">&quot;tree_summarize&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">response = kg_query_engine.query(<span class="string">&quot;人工智能和机器学习的关系&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure>

<h3 id="🔍-高级查询技术"><a href="#🔍-高级查询技术" class="headerlink" title="🔍 高级查询技术"></a>🔍 高级查询技术</h3><h4 id="1-多模态查询"><a href="#1-多模态查询" class="headerlink" title="1. 多模态查询"></a>1. 多模态查询</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core.query_engine <span class="keyword">import</span> RouterQueryEngine</span><br><span class="line"><span class="keyword">from</span> llama_index.core.selectors <span class="keyword">import</span> LLMSingleSelector</span><br><span class="line"><span class="keyword">from</span> llama_index.core.tools <span class="keyword">import</span> QueryEngineTool</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建多个查询引擎</span></span><br><span class="line">vector_tool = QueryEngineTool.from_defaults(</span><br><span class="line">    query_engine=query_engine,</span><br><span class="line">    description=<span class="string">&quot;用于回答关于文档内容的具体问题&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">tree_tool = QueryEngineTool.from_defaults(</span><br><span class="line">    query_engine=tree_query_engine,</span><br><span class="line">    description=<span class="string">&quot;用于总结和概括文档内容&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">keyword_tool = QueryEngineTool.from_defaults(</span><br><span class="line">    query_engine=keyword_query_engine,</span><br><span class="line">    description=<span class="string">&quot;用于基于关键词的精确搜索&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建路由查询引擎</span></span><br><span class="line">router_query_engine = RouterQueryEngine(</span><br><span class="line">    selector=LLMSingleSelector.from_defaults(),</span><br><span class="line">    query_engine_tools=[</span><br><span class="line">        vector_tool,</span><br><span class="line">        tree_tool,</span><br><span class="line">        keyword_tool</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 智能路由查询</span></span><br><span class="line">response = router_query_engine.query(<span class="string">&quot;请总结人工智能的发展历程&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure>

<h4 id="2-子问题查询"><a href="#2-子问题查询" class="headerlink" title="2. 子问题查询"></a>2. 子问题查询</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core.query_engine <span class="keyword">import</span> SubQuestionQueryEngine</span><br><span class="line"><span class="keyword">from</span> llama_index.core.tools <span class="keyword">import</span> QueryEngineTool</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建子问题查询引擎</span></span><br><span class="line">query_engine_tools = [</span><br><span class="line">    QueryEngineTool(</span><br><span class="line">        query_engine=query_engine,</span><br><span class="line">        metadata=&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;ai_docs&quot;</span>, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;AI相关文档&quot;</span>&#125;</span><br><span class="line">    )</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">sub_question_engine = SubQuestionQueryEngine.from_defaults(</span><br><span class="line">    query_engine_tools=query_engine_tools</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复杂问题分解查询</span></span><br><span class="line">complex_query = <span class="string">&quot;比较监督学习和无监督学习的优缺点，并给出应用场景&quot;</span></span><br><span class="line">response = sub_question_engine.query(complex_query)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure>

<h3 id="📈-RAG评估"><a href="#📈-RAG评估" class="headerlink" title="📈 RAG评估"></a>📈 RAG评估</h3><h4 id="1-评估指标"><a href="#1-评估指标" class="headerlink" title="1. 评估指标"></a>1. 评估指标</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core.evaluation <span class="keyword">import</span> (</span><br><span class="line">    FaithfulnessEvaluator,</span><br><span class="line">    RelevancyEvaluator,</span><br><span class="line">    CorrectnessEvaluator</span><br><span class="line">)</span><br><span class="line"><span class="keyword">from</span> llama_index.core.evaluation <span class="keyword">import</span> BatchEvalRunner</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建评估器</span></span><br><span class="line">faithfulness_evaluator = FaithfulnessEvaluator()</span><br><span class="line">relevancy_evaluator = RelevancyEvaluator()</span><br><span class="line">correctness_evaluator = CorrectnessEvaluator()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 准备评估数据</span></span><br><span class="line">eval_questions = [</span><br><span class="line">    <span class="string">&quot;什么是机器学习？&quot;</span>,</span><br><span class="line">    <span class="string">&quot;深度学习有哪些应用？&quot;</span>,</span><br><span class="line">    <span class="string">&quot;如何选择合适的算法？&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 批量评估</span></span><br><span class="line">runner = BatchEvalRunner(</span><br><span class="line">    &#123;<span class="string">&quot;faithfulness&quot;</span>: faithfulness_evaluator,</span><br><span class="line">     <span class="string">&quot;relevancy&quot;</span>: relevancy_evaluator,</span><br><span class="line">     <span class="string">&quot;correctness&quot;</span>: correctness_evaluator&#125;,</span><br><span class="line">    workers=<span class="number">2</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">eval_results = <span class="keyword">await</span> runner.aevaluate_queries(</span><br><span class="line">    query_engine, </span><br><span class="line">    queries=eval_questions</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看结果</span></span><br><span class="line"><span class="keyword">for</span> query, result <span class="keyword">in</span> eval_results.items():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Query: <span class="subst">&#123;query&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> metric, score <span class="keyword">in</span> result.items():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;metric&#125;</span>: <span class="subst">&#123;score.score&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="2-自定义评估"><a href="#2-自定义评估" class="headerlink" title="2. 自定义评估"></a>2. 自定义评估</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core.evaluation <span class="keyword">import</span> BaseEvaluator</span><br><span class="line"><span class="keyword">from</span> llama_index.core.evaluation.eval_utils <span class="keyword">import</span> get_responses</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomEvaluator</span>(<span class="title class_ inherited__">BaseEvaluator</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_prompts</span>(<span class="params">self</span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;eval_template&quot;</span>: (</span><br><span class="line">                <span class="string">&quot;请评估以下回答的质量（1-5分）：\n&quot;</span></span><br><span class="line">                <span class="string">&quot;问题: &#123;query&#125;\n&quot;</span></span><br><span class="line">                <span class="string">&quot;回答: &#123;response&#125;\n&quot;</span></span><br><span class="line">                <span class="string">&quot;评分（1-5）:&quot;</span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_prompt_modules</span>(<span class="params">self</span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">aevaluate</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        query: <span class="built_in">str</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        response: <span class="built_in">str</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        contexts: <span class="built_in">list</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        **kwargs</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">        eval_response = <span class="keyword">await</span> <span class="variable language_">self</span>.llm.apredict(</span><br><span class="line">            <span class="variable language_">self</span>.eval_template,</span><br><span class="line">            query=query,</span><br><span class="line">            response=response</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 提取分数</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            score = <span class="built_in">float</span>(eval_response.strip())</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            score = <span class="number">0.0</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;score&quot;</span>: score, <span class="string">&quot;feedback&quot;</span>: eval_response&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用自定义评估器</span></span><br><span class="line">custom_evaluator = CustomEvaluator()</span><br><span class="line">result = <span class="keyword">await</span> custom_evaluator.aevaluate(</span><br><span class="line">    query=<span class="string">&quot;什么是机器学习？&quot;</span>,</span><br><span class="line">    response=<span class="string">&quot;机器学习是人工智能的一个分支...&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h2 id="🗄️-向量数据库实战"><a href="#🗄️-向量数据库实战" class="headerlink" title="🗄️ 向量数据库实战"></a>🗄️ 向量数据库实战</h2><h3 id="🎨-Chroma：轻量级向量数据库"><a href="#🎨-Chroma：轻量级向量数据库" class="headerlink" title="🎨 Chroma：轻量级向量数据库"></a>🎨 Chroma：轻量级向量数据库</h3><h4 id="1-基础使用"><a href="#1-基础使用" class="headerlink" title="1. 基础使用"></a>1. 基础使用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> chromadb</span><br><span class="line"><span class="keyword">from</span> chromadb.config <span class="keyword">import</span> Settings</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建客户端</span></span><br><span class="line">client = chromadb.Client(Settings(</span><br><span class="line">    chroma_db_impl=<span class="string">&quot;duckdb+parquet&quot;</span>,</span><br><span class="line">    persist_directory=<span class="string">&quot;./chroma_db&quot;</span></span><br><span class="line">))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建集合</span></span><br><span class="line">collection = client.create_collection(</span><br><span class="line">    name=<span class="string">&quot;my_collection&quot;</span>,</span><br><span class="line">    metadata=&#123;<span class="string">&quot;hnsw:space&quot;</span>: <span class="string">&quot;cosine&quot;</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加文档</span></span><br><span class="line">documents = [</span><br><span class="line">    <span class="string">&quot;机器学习是人工智能的一个重要分支&quot;</span>,</span><br><span class="line">    <span class="string">&quot;深度学习使用多层神经网络&quot;</span>,</span><br><span class="line">    <span class="string">&quot;自然语言处理处理人类语言&quot;</span>,</span><br><span class="line">    <span class="string">&quot;计算机视觉让机器理解图像&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">ids = [<span class="string">f&quot;doc_<span class="subst">&#123;i&#125;</span>&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(documents))]</span><br><span class="line">metadatas = [&#123;<span class="string">&quot;topic&quot;</span>: <span class="string">&quot;AI&quot;</span>, <span class="string">&quot;index&quot;</span>: i&#125; <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(documents))]</span><br><span class="line"></span><br><span class="line">collection.add(</span><br><span class="line">    documents=documents,</span><br><span class="line">    ids=ids,</span><br><span class="line">    metadatas=metadatas</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询</span></span><br><span class="line">results = collection.query(</span><br><span class="line">    query_texts=[<span class="string">&quot;什么是深度学习？&quot;</span>],</span><br><span class="line">    n_results=<span class="number">2</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;查询结果:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(results[<span class="string">&#x27;documents&#x27;</span>][<span class="number">0</span>]):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>. <span class="subst">&#123;doc&#125;</span> (距离: <span class="subst">&#123;results[<span class="string">&#x27;distances&#x27;</span>][<span class="number">0</span>][i]:<span class="number">.3</span>f&#125;</span>)&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="2-高级功能"><a href="#2-高级功能" class="headerlink" title="2. 高级功能"></a>2. 高级功能</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> chromadb.utils <span class="keyword">import</span> embedding_functions</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用自定义嵌入函数</span></span><br><span class="line">openai_ef = embedding_functions.OpenAIEmbeddingFunction(</span><br><span class="line">    api_key=<span class="string">&quot;your-api-key&quot;</span>,</span><br><span class="line">    model_name=<span class="string">&quot;text-embedding-ada-002&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建带自定义嵌入的集合</span></span><br><span class="line">advanced_collection = client.create_collection(</span><br><span class="line">    name=<span class="string">&quot;advanced_collection&quot;</span>,</span><br><span class="line">    embedding_function=openai_ef</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 批量操作</span></span><br><span class="line">batch_size = <span class="number">100</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(large_documents), batch_size):</span><br><span class="line">    batch_docs = large_documents[i:i+batch_size]</span><br><span class="line">    batch_ids = [<span class="string">f&quot;doc_<span class="subst">&#123;j&#125;</span>&quot;</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i, <span class="built_in">min</span>(i+batch_size, <span class="built_in">len</span>(large_documents)))]</span><br><span class="line">    </span><br><span class="line">    advanced_collection.add(</span><br><span class="line">        documents=batch_docs,</span><br><span class="line">        ids=batch_ids</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复杂查询</span></span><br><span class="line">complex_results = advanced_collection.query(</span><br><span class="line">    query_texts=[<span class="string">&quot;机器学习算法&quot;</span>],</span><br><span class="line">    n_results=<span class="number">5</span>,</span><br><span class="line">    where=&#123;<span class="string">&quot;topic&quot;</span>: <span class="string">&quot;AI&quot;</span>&#125;,</span><br><span class="line">    include=[<span class="string">&quot;documents&quot;</span>, <span class="string">&quot;distances&quot;</span>, <span class="string">&quot;metadatas&quot;</span>]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="📌-Pinecone：企业级向量数据库"><a href="#📌-Pinecone：企业级向量数据库" class="headerlink" title="📌 Pinecone：企业级向量数据库"></a>📌 Pinecone：企业级向量数据库</h3><h4 id="1-基础配置"><a href="#1-基础配置" class="headerlink" title="1. 基础配置"></a>1. 基础配置</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pinecone</span><br><span class="line"><span class="keyword">from</span> pinecone <span class="keyword">import</span> Pinecone, ServerlessSpec</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化Pinecone</span></span><br><span class="line">pc = Pinecone(api_key=<span class="string">&quot;your-api-key&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建索引</span></span><br><span class="line">index_name = <span class="string">&quot;ai-knowledge-base&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> index_name <span class="keyword">not</span> <span class="keyword">in</span> pc.list_indexes().names():</span><br><span class="line">    pc.create_index(</span><br><span class="line">        name=index_name,</span><br><span class="line">        dimension=<span class="number">1536</span>,  <span class="comment"># OpenAI embedding维度</span></span><br><span class="line">        metric=<span class="string">&quot;cosine&quot;</span>,</span><br><span class="line">        spec=ServerlessSpec(</span><br><span class="line">            cloud=<span class="string">&quot;aws&quot;</span>,</span><br><span class="line">            region=<span class="string">&quot;us-east-1&quot;</span></span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接索引</span></span><br><span class="line">index = pc.Index(index_name)</span><br></pre></td></tr></table></figure>

<h4 id="2-数据操作"><a href="#2-数据操作" class="headerlink" title="2. 数据操作"></a>2. 数据操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> openai</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_embeddings</span>(<span class="params">texts: <span class="type">List</span>[<span class="built_in">str</span>]</span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">float</span>]]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;获取文本嵌入&quot;&quot;&quot;</span></span><br><span class="line">    response = openai.Embedding.create(</span><br><span class="line">        <span class="built_in">input</span>=texts,</span><br><span class="line">        model=<span class="string">&quot;text-embedding-ada-002&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> [item[<span class="string">&#x27;embedding&#x27;</span>] <span class="keyword">for</span> item <span class="keyword">in</span> response[<span class="string">&#x27;data&#x27;</span>]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 准备数据</span></span><br><span class="line">documents = [</span><br><span class="line">    <span class="string">&quot;人工智能是模拟人类智能的技术&quot;</span>,</span><br><span class="line">    <span class="string">&quot;机器学习让计算机从数据中学习&quot;</span>,</span><br><span class="line">    <span class="string">&quot;深度学习是机器学习的子集&quot;</span>,</span><br><span class="line">    <span class="string">&quot;神经网络是深度学习的基础&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取嵌入</span></span><br><span class="line">embeddings = get_embeddings(documents)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 准备向量数据</span></span><br><span class="line">vectors = []</span><br><span class="line"><span class="keyword">for</span> i, (doc, embedding) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(documents, embeddings)):</span><br><span class="line">    vectors.append(&#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="string">f&quot;doc_<span class="subst">&#123;i&#125;</span>&quot;</span>,</span><br><span class="line">        <span class="string">&quot;values&quot;</span>: embedding,</span><br><span class="line">        <span class="string">&quot;metadata&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;text&quot;</span>: doc,</span><br><span class="line">            <span class="string">&quot;category&quot;</span>: <span class="string">&quot;AI&quot;</span>,</span><br><span class="line">            <span class="string">&quot;timestamp&quot;</span>: <span class="string">&quot;2024-01-01&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 批量插入</span></span><br><span class="line">index.upsert(vectors=vectors)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询</span></span><br><span class="line">query_text = <span class="string">&quot;什么是机器学习？&quot;</span></span><br><span class="line">query_embedding = get_embeddings([query_text])[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">results = index.query(</span><br><span class="line">    vector=query_embedding,</span><br><span class="line">    top_k=<span class="number">3</span>,</span><br><span class="line">    include_metadata=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;查询结果:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">match</span> <span class="keyword">in</span> results[<span class="string">&#x27;matches&#x27;</span>]:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;相似度: <span class="subst">&#123;<span class="keyword">match</span>[<span class="string">&#x27;score&#x27;</span>]:<span class="number">.3</span>f&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;文本: <span class="subst">&#123;<span class="keyword">match</span>[<span class="string">&#x27;metadata&#x27;</span>][<span class="string">&#x27;text&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="3-高级查询"><a href="#3-高级查询" class="headerlink" title="3. 高级查询"></a>3. 高级查询</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 混合查询（向量+元数据过滤）</span></span><br><span class="line">filtered_results = index.query(</span><br><span class="line">    vector=query_embedding,</span><br><span class="line">    top_k=<span class="number">5</span>,</span><br><span class="line">    <span class="built_in">filter</span>=&#123;</span><br><span class="line">        <span class="string">&quot;category&quot;</span>: &#123;<span class="string">&quot;$eq&quot;</span>: <span class="string">&quot;AI&quot;</span>&#125;,</span><br><span class="line">        <span class="string">&quot;timestamp&quot;</span>: &#123;<span class="string">&quot;$gte&quot;</span>: <span class="string">&quot;2024-01-01&quot;</span>&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    include_metadata=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 命名空间查询</span></span><br><span class="line">index.query(</span><br><span class="line">    vector=query_embedding,</span><br><span class="line">    top_k=<span class="number">3</span>,</span><br><span class="line">    namespace=<span class="string">&quot;production&quot;</span>,</span><br><span class="line">    include_metadata=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 批量查询</span></span><br><span class="line">query_vectors = get_embeddings([</span><br><span class="line">    <span class="string">&quot;深度学习的应用&quot;</span>,</span><br><span class="line">    <span class="string">&quot;神经网络结构&quot;</span></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">batch_results = index.query(</span><br><span class="line">    vector=query_vectors,</span><br><span class="line">    top_k=<span class="number">2</span>,</span><br><span class="line">    include_metadata=<span class="literal">True</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="🎨-UI框架：Gradio和Streamlit"><a href="#🎨-UI框架：Gradio和Streamlit" class="headerlink" title="🎨 UI框架：Gradio和Streamlit"></a>🎨 UI框架：Gradio和Streamlit</h2><h3 id="🚀-Gradio：快速AI应用原型"><a href="#🚀-Gradio：快速AI应用原型" class="headerlink" title="🚀 Gradio：快速AI应用原型"></a>🚀 Gradio：快速AI应用原型</h3><h4 id="1-基础界面"><a href="#1-基础界面" class="headerlink" title="1. 基础界面"></a>1. 基础界面</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gradio <span class="keyword">as</span> gr</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> pipeline</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建文本生成管道</span></span><br><span class="line">generator = pipeline(<span class="string">&quot;text-generation&quot;</span>, model=<span class="string">&quot;gpt2&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_text</span>(<span class="params">prompt, max_length, temperature</span>):</span><br><span class="line">    result = generator(</span><br><span class="line">        prompt,</span><br><span class="line">        max_length=max_length,</span><br><span class="line">        temperature=temperature,</span><br><span class="line">        num_return_sequences=<span class="number">1</span>,</span><br><span class="line">        pad_token_id=generator.tokenizer.eos_token_id</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> result[<span class="number">0</span>][<span class="string">&#x27;generated_text&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建界面</span></span><br><span class="line">iface = gr.Interface(</span><br><span class="line">    fn=generate_text,</span><br><span class="line">    inputs=[</span><br><span class="line">        gr.Textbox(label=<span class="string">&quot;输入提示&quot;</span>, placeholder=<span class="string">&quot;请输入文本...&quot;</span>),</span><br><span class="line">        gr.Slider(<span class="number">10</span>, <span class="number">100</span>, value=<span class="number">50</span>, label=<span class="string">&quot;最大长度&quot;</span>),</span><br><span class="line">        gr.Slider(<span class="number">0.1</span>, <span class="number">2.0</span>, value=<span class="number">0.7</span>, label=<span class="string">&quot;创造性&quot;</span>)</span><br><span class="line">    ],</span><br><span class="line">    outputs=gr.Textbox(label=<span class="string">&quot;生成的文本&quot;</span>),</span><br><span class="line">    title=<span class="string">&quot;AI文本生成器&quot;</span>,</span><br><span class="line">    description=<span class="string">&quot;使用GPT-2生成文本&quot;</span>,</span><br><span class="line">    examples=[</span><br><span class="line">        [<span class="string">&quot;人工智能的未来&quot;</span>, <span class="number">50</span>, <span class="number">0.7</span>],</span><br><span class="line">        [<span class="string">&quot;机器学习算法&quot;</span>, <span class="number">80</span>, <span class="number">0.5</span>]</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">iface.launch()</span><br></pre></td></tr></table></figure>

<h4 id="2-多功能应用"><a href="#2-多功能应用" class="headerlink" title="2. 多功能应用"></a>2. 多功能应用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gradio <span class="keyword">as</span> gr</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多个AI功能</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">text_generation</span>(<span class="params">prompt</span>):</span><br><span class="line">    <span class="comment"># 文本生成逻辑</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;生成的文本基于: <span class="subst">&#123;prompt&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">image_classification</span>(<span class="params">image</span>):</span><br><span class="line">    <span class="comment"># 图像分类逻辑</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;猫&quot;</span>: <span class="number">0.8</span>, <span class="string">&quot;狗&quot;</span>: <span class="number">0.2</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sentiment_analysis</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="comment"># 情感分析逻辑</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;正面&quot;</span>: <span class="number">0.7</span>, <span class="string">&quot;负面&quot;</span>: <span class="number">0.3</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建多标签页界面</span></span><br><span class="line"><span class="keyword">with</span> gr.Blocks(title=<span class="string">&quot;AI工具箱&quot;</span>) <span class="keyword">as</span> demo:</span><br><span class="line">    gr.Markdown(<span class="string">&quot;# 🤖 AI工具箱&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> gr.Tab(<span class="string">&quot;文本生成&quot;</span>):</span><br><span class="line">        <span class="keyword">with</span> gr.Row():</span><br><span class="line">            text_input = gr.Textbox(label=<span class="string">&quot;输入提示&quot;</span>)</span><br><span class="line">            text_output = gr.Textbox(label=<span class="string">&quot;生成结果&quot;</span>)</span><br><span class="line">        text_btn = gr.Button(<span class="string">&quot;生成&quot;</span>)</span><br><span class="line">        text_btn.click(text_generation, text_input, text_output)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> gr.Tab(<span class="string">&quot;图像分类&quot;</span>):</span><br><span class="line">        <span class="keyword">with</span> gr.Row():</span><br><span class="line">            image_input = gr.Image(label=<span class="string">&quot;上传图像&quot;</span>)</span><br><span class="line">            image_output = gr.Label(label=<span class="string">&quot;分类结果&quot;</span>)</span><br><span class="line">        image_btn = gr.Button(<span class="string">&quot;分类&quot;</span>)</span><br><span class="line">        image_btn.click(image_classification, image_input, image_output)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> gr.Tab(<span class="string">&quot;情感分析&quot;</span>):</span><br><span class="line">        <span class="keyword">with</span> gr.Row():</span><br><span class="line">            sentiment_input = gr.Textbox(label=<span class="string">&quot;输入文本&quot;</span>)</span><br><span class="line">            sentiment_output = gr.Label(label=<span class="string">&quot;情感分析&quot;</span>)</span><br><span class="line">        sentiment_btn = gr.Button(<span class="string">&quot;分析&quot;</span>)</span><br><span class="line">        sentiment_btn.click(sentiment_analysis, sentiment_input, sentiment_output)</span><br><span class="line"></span><br><span class="line">demo.launch(share=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h3 id="📊-Streamlit：数据驱动的AI应用"><a href="#📊-Streamlit：数据驱动的AI应用" class="headerlink" title="📊 Streamlit：数据驱动的AI应用"></a>📊 Streamlit：数据驱动的AI应用</h3><h4 id="1-基础应用"><a href="#1-基础应用" class="headerlink" title="1. 基础应用"></a>1. 基础应用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> plotly.express <span class="keyword">as</span> px</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> pipeline</span><br><span class="line"></span><br><span class="line"><span class="comment"># 页面配置</span></span><br><span class="line">st.set_page_config(</span><br><span class="line">    page_title=<span class="string">&quot;AI数据分析平台&quot;</span>,</span><br><span class="line">    page_icon=<span class="string">&quot;🤖&quot;</span>,</span><br><span class="line">    layout=<span class="string">&quot;wide&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 标题</span></span><br><span class="line">st.title(<span class="string">&quot;🤖 AI数据分析平台&quot;</span>)</span><br><span class="line">st.markdown(<span class="string">&quot;---&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 侧边栏</span></span><br><span class="line"><span class="keyword">with</span> st.sidebar:</span><br><span class="line">    st.header(<span class="string">&quot;配置选项&quot;</span>)</span><br><span class="line">    model_choice = st.selectbox(</span><br><span class="line">        <span class="string">&quot;选择模型&quot;</span>,</span><br><span class="line">        [<span class="string">&quot;sentiment-analysis&quot;</span>, <span class="string">&quot;text-classification&quot;</span>, <span class="string">&quot;summarization&quot;</span>]</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    confidence_threshold = st.slider(</span><br><span class="line">        <span class="string">&quot;置信度阈值&quot;</span>,</span><br><span class="line">        <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.5</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主要内容</span></span><br><span class="line">col1, col2 = st.columns([<span class="number">2</span>, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> col1:</span><br><span class="line">    st.header(<span class="string">&quot;文本分析&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 文本输入</span></span><br><span class="line">    user_input = st.text_area(</span><br><span class="line">        <span class="string">&quot;输入要分析的文本&quot;</span>,</span><br><span class="line">        height=<span class="number">150</span>,</span><br><span class="line">        placeholder=<span class="string">&quot;请输入文本...&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> st.button(<span class="string">&quot;开始分析&quot;</span>, <span class="built_in">type</span>=<span class="string">&quot;primary&quot;</span>):</span><br><span class="line">        <span class="keyword">if</span> user_input:</span><br><span class="line">            <span class="comment"># 创建分析管道</span></span><br><span class="line">            classifier = pipeline(model_choice)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 执行分析</span></span><br><span class="line">            <span class="keyword">with</span> st.spinner(<span class="string">&quot;分析中...&quot;</span>):</span><br><span class="line">                results = classifier(user_input)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 显示结果</span></span><br><span class="line">            st.success(<span class="string">&quot;分析完成！&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 结果可视化</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(results, <span class="built_in">list</span>) <span class="keyword">and</span> <span class="built_in">len</span>(results) &gt; <span class="number">0</span>:</span><br><span class="line">                result = results[<span class="number">0</span>]</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 创建数据框</span></span><br><span class="line">                df = pd.DataFrame([</span><br><span class="line">                    &#123;<span class="string">&quot;标签&quot;</span>: result[<span class="string">&#x27;label&#x27;</span>], <span class="string">&quot;置信度&quot;</span>: result[<span class="string">&#x27;score&#x27;</span>]&#125;</span><br><span class="line">                ])</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 显示表格</span></span><br><span class="line">                st.dataframe(df, use_container_width=<span class="literal">True</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 显示图表</span></span><br><span class="line">                fig = px.bar(</span><br><span class="line">                    df, </span><br><span class="line">                    x=<span class="string">&quot;标签&quot;</span>, </span><br><span class="line">                    y=<span class="string">&quot;置信度&quot;</span>,</span><br><span class="line">                    title=<span class="string">&quot;分析结果&quot;</span></span><br><span class="line">                )</span><br><span class="line">                st.plotly_chart(fig, use_container_width=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            st.warning(<span class="string">&quot;请输入要分析的文本&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> col2:</span><br><span class="line">    st.header(<span class="string">&quot;统计信息&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> user_input:</span><br><span class="line">        <span class="comment"># 文本统计</span></span><br><span class="line">        word_count = <span class="built_in">len</span>(user_input.split())</span><br><span class="line">        char_count = <span class="built_in">len</span>(user_input)</span><br><span class="line">        </span><br><span class="line">        st.metric(<span class="string">&quot;字符数&quot;</span>, char_count)</span><br><span class="line">        st.metric(<span class="string">&quot;单词数&quot;</span>, word_count)</span><br><span class="line">        st.metric(<span class="string">&quot;平均词长&quot;</span>, <span class="string">f&quot;<span class="subst">&#123;char_count/word_count:<span class="number">.1</span>f&#125;</span>&quot;</span> <span class="keyword">if</span> word_count &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&quot;0&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 历史记录</span></span><br><span class="line">    st.header(<span class="string">&quot;使用历史&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;history&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> st.session_state:</span><br><span class="line">        st.session_state.history = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> user_input <span class="keyword">and</span> st.button(<span class="string">&quot;保存到历史&quot;</span>):</span><br><span class="line">        st.session_state.history.append(&#123;</span><br><span class="line">            <span class="string">&quot;时间&quot;</span>: pd.Timestamp.now().strftime(<span class="string">&quot;%H:%M:%S&quot;</span>),</span><br><span class="line">            <span class="string">&quot;文本&quot;</span>: user_input[:<span class="number">50</span>] + <span class="string">&quot;...&quot;</span> <span class="keyword">if</span> <span class="built_in">len</span>(user_input) &gt; <span class="number">50</span> <span class="keyword">else</span> user_input</span><br><span class="line">        &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> st.session_state.history:</span><br><span class="line">        history_df = pd.DataFrame(st.session_state.history)</span><br><span class="line">        st.dataframe(history_df, use_container_width=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h4 id="2-高级功能-1"><a href="#2-高级功能-1" class="headerlink" title="2. 高级功能"></a>2. 高级功能</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">from</span> streamlit_chat <span class="keyword">import</span> message</span><br><span class="line"><span class="keyword">from</span> streamlit_option_menu <span class="keyword">import</span> option_menu</span><br><span class="line"><span class="keyword">import</span> plotly.graph_objects <span class="keyword">as</span> go</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多页面应用</span></span><br><span class="line"><span class="keyword">with</span> st.sidebar:</span><br><span class="line">    selected = option_menu(</span><br><span class="line">        <span class="string">&quot;主菜单&quot;</span>,</span><br><span class="line">        [<span class="string">&quot;聊天机器人&quot;</span>, <span class="string">&quot;数据分析&quot;</span>, <span class="string">&quot;模型训练&quot;</span>, <span class="string">&quot;设置&quot;</span>],</span><br><span class="line">        icons=[<span class="string">&quot;chat&quot;</span>, <span class="string">&quot;graph-up&quot;</span>, <span class="string">&quot;cpu&quot;</span>, <span class="string">&quot;gear&quot;</span>],</span><br><span class="line">        menu_icon=<span class="string">&quot;cast&quot;</span>,</span><br><span class="line">        default_index=<span class="number">0</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> selected == <span class="string">&quot;聊天机器人&quot;</span>:</span><br><span class="line">    st.header(<span class="string">&quot;🤖 AI聊天助手&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 初始化聊天历史</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;messages&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> st.session_state:</span><br><span class="line">        st.session_state.messages = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示聊天历史</span></span><br><span class="line">    <span class="keyword">for</span> i, msg <span class="keyword">in</span> <span class="built_in">enumerate</span>(st.session_state.messages):</span><br><span class="line">        message(msg[<span class="string">&quot;content&quot;</span>], is_user=msg[<span class="string">&quot;role&quot;</span>] == <span class="string">&quot;user&quot;</span>, key=<span class="string">f&quot;msg_<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 用户输入</span></span><br><span class="line">    user_input = st.chat_input(<span class="string">&quot;输入消息...&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> user_input:</span><br><span class="line">        <span class="comment"># 添加用户消息</span></span><br><span class="line">        st.session_state.messages.append(&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: user_input&#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 生成AI回复（这里应该调用实际的AI模型）</span></span><br><span class="line">        ai_response = <span class="string">f&quot;我理解您说的：<span class="subst">&#123;user_input&#125;</span>。这是一个示例回复。&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 添加AI回复</span></span><br><span class="line">        st.session_state.messages.append(&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: ai_response&#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 重新运行以更新界面</span></span><br><span class="line">        st.rerun()</span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> selected == <span class="string">&quot;数据分析&quot;</span>:</span><br><span class="line">    st.header(<span class="string">&quot;📊 数据分析&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 文件上传</span></span><br><span class="line">    uploaded_file = st.file_uploader(</span><br><span class="line">        <span class="string">&quot;上传CSV文件&quot;</span>,</span><br><span class="line">        <span class="built_in">type</span>=[<span class="string">&quot;csv&quot;</span>],</span><br><span class="line">        <span class="built_in">help</span>=<span class="string">&quot;请上传要分析的CSV文件&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> uploaded_file:</span><br><span class="line">        <span class="comment"># 读取数据</span></span><br><span class="line">        df = pd.read_csv(uploaded_file)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 显示数据预览</span></span><br><span class="line">        st.subheader(<span class="string">&quot;数据预览&quot;</span>)</span><br><span class="line">        st.dataframe(df.head(), use_container_width=<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 数据统计</span></span><br><span class="line">        col1, col2, col3 = st.columns(<span class="number">3</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> col1:</span><br><span class="line">            st.metric(<span class="string">&quot;行数&quot;</span>, <span class="built_in">len</span>(df))</span><br><span class="line">        <span class="keyword">with</span> col2:</span><br><span class="line">            st.metric(<span class="string">&quot;列数&quot;</span>, <span class="built_in">len</span>(df.columns))</span><br><span class="line">        <span class="keyword">with</span> col3:</span><br><span class="line">            st.metric(<span class="string">&quot;缺失值&quot;</span>, df.isnull().<span class="built_in">sum</span>().<span class="built_in">sum</span>())</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 选择列进行分析</span></span><br><span class="line">        numeric_columns = df.select_dtypes(include=[np.number]).columns.tolist()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> numeric_columns:</span><br><span class="line">            selected_column = st.selectbox(<span class="string">&quot;选择要分析的列&quot;</span>, numeric_columns)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 创建图表</span></span><br><span class="line">            fig = go.Figure()</span><br><span class="line">            fig.add_trace(go.Histogram(x=df[selected_column], name=selected_column))</span><br><span class="line">            fig.update_layout(title=<span class="string">f&quot;<span class="subst">&#123;selected_column&#125;</span> 分布图&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            st.plotly_chart(fig, use_container_width=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> selected == <span class="string">&quot;模型训练&quot;</span>:</span><br><span class="line">    st.header(<span class="string">&quot;🧠 模型训练&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 训练参数配置</span></span><br><span class="line">    <span class="keyword">with</span> st.expander(<span class="string">&quot;训练参数&quot;</span>, expanded=<span class="literal">True</span>):</span><br><span class="line">        col1, col2 = st.columns(<span class="number">2</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> col1:</span><br><span class="line">            epochs = st.number_input(<span class="string">&quot;训练轮数&quot;</span>, min_value=<span class="number">1</span>, max_value=<span class="number">100</span>, value=<span class="number">10</span>)</span><br><span class="line">            batch_size = st.selectbox(<span class="string">&quot;批次大小&quot;</span>, [<span class="number">16</span>, <span class="number">32</span>, <span class="number">64</span>, <span class="number">128</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> col2:</span><br><span class="line">            learning_rate = st.number_input(<span class="string">&quot;学习率&quot;</span>, min_value=<span class="number">0.0001</span>, max_value=<span class="number">0.1</span>, value=<span class="number">0.001</span>, <span class="built_in">format</span>=<span class="string">&quot;%.4f&quot;</span>)</span><br><span class="line">            model_type = st.selectbox(<span class="string">&quot;模型类型&quot;</span>, [<span class="string">&quot;BERT&quot;</span>, <span class="string">&quot;RoBERTa&quot;</span>, <span class="string">&quot;DistilBERT&quot;</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 训练进度</span></span><br><span class="line">    <span class="keyword">if</span> st.button(<span class="string">&quot;开始训练&quot;</span>, <span class="built_in">type</span>=<span class="string">&quot;primary&quot;</span>):</span><br><span class="line">        progress_bar = st.progress(<span class="number">0</span>)</span><br><span class="line">        status_text = st.empty()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(epochs):</span><br><span class="line">            <span class="comment"># 模拟训练过程</span></span><br><span class="line">            progress = (i + <span class="number">1</span>) / epochs</span><br><span class="line">            progress_bar.progress(progress)</span><br><span class="line">            status_text.text(<span class="string">f&quot;训练进度: <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>/<span class="subst">&#123;epochs&#125;</span> 轮&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 模拟训练时间</span></span><br><span class="line">            <span class="keyword">import</span> time</span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        </span><br><span class="line">        st.success(<span class="string">&quot;训练完成！&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> selected == <span class="string">&quot;设置&quot;</span>:</span><br><span class="line">    st.header(<span class="string">&quot;⚙️ 系统设置&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># API配置</span></span><br><span class="line">    <span class="keyword">with</span> st.expander(<span class="string">&quot;API配置&quot;</span>):</span><br><span class="line">        api_key = st.text_input(<span class="string">&quot;OpenAI API Key&quot;</span>, <span class="built_in">type</span>=<span class="string">&quot;password&quot;</span>)</span><br><span class="line">        api_base = st.text_input(<span class="string">&quot;API Base URL&quot;</span>, value=<span class="string">&quot;https://api.openai.com/v1&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 模型配置</span></span><br><span class="line">    <span class="keyword">with</span> st.expander(<span class="string">&quot;模型配置&quot;</span>):</span><br><span class="line">        default_model = st.selectbox(</span><br><span class="line">            <span class="string">&quot;默认模型&quot;</span>,</span><br><span class="line">            [<span class="string">&quot;gpt-3.5-turbo&quot;</span>, <span class="string">&quot;gpt-4&quot;</span>, <span class="string">&quot;claude-3-sonnet&quot;</span>]</span><br><span class="line">        )</span><br><span class="line">        max_tokens = st.number_input(<span class="string">&quot;最大Token数&quot;</span>, min_value=<span class="number">100</span>, max_value=<span class="number">4000</span>, value=<span class="number">1000</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存设置</span></span><br><span class="line">    <span class="keyword">if</span> st.button(<span class="string">&quot;保存设置&quot;</span>):</span><br><span class="line">        st.success(<span class="string">&quot;设置已保存！&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="🔧-实战项目：构建完整的RAG应用"><a href="#🔧-实战项目：构建完整的RAG应用" class="headerlink" title="🔧 实战项目：构建完整的RAG应用"></a>🔧 实战项目：构建完整的RAG应用</h2><h3 id="📋-项目架构"><a href="#📋-项目架构" class="headerlink" title="📋 项目架构"></a>📋 项目架构</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 项目结构</span></span><br><span class="line">project_structure = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">rag_app/</span></span><br><span class="line"><span class="string">├── app.py                 # Streamlit主应用</span></span><br><span class="line"><span class="string">├── components/</span></span><br><span class="line"><span class="string">│   ├── __init__.py</span></span><br><span class="line"><span class="string">│   ├── document_loader.py # 文档加载器</span></span><br><span class="line"><span class="string">│   ├── vector_store.py    # 向量存储</span></span><br><span class="line"><span class="string">│   ├── retriever.py       # 检索器</span></span><br><span class="line"><span class="string">│   └── generator.py       # 生成器</span></span><br><span class="line"><span class="string">├── config/</span></span><br><span class="line"><span class="string">│   ├── __init__.py</span></span><br><span class="line"><span class="string">│   └── settings.py        # 配置文件</span></span><br><span class="line"><span class="string">├── data/</span></span><br><span class="line"><span class="string">│   └── documents/         # 文档存储</span></span><br><span class="line"><span class="string">├── requirements.txt       # 依赖包</span></span><br><span class="line"><span class="string">└── README.md             # 项目说明</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="🏗️-核心组件实现"><a href="#🏗️-核心组件实现" class="headerlink" title="🏗️ 核心组件实现"></a>🏗️ 核心组件实现</h3><h4 id="1-配置管理"><a href="#1-配置管理" class="headerlink" title="1. 配置管理"></a>1. 配置管理</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/settings.py</span></span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseSettings</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Settings</span>(<span class="title class_ inherited__">BaseSettings</span>):</span><br><span class="line">    <span class="comment"># API配置</span></span><br><span class="line">    openai_api_key: <span class="built_in">str</span></span><br><span class="line">    anthropic_api_key: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 模型配置</span></span><br><span class="line">    embedding_model: <span class="built_in">str</span> = <span class="string">&quot;text-embedding-ada-002&quot;</span></span><br><span class="line">    llm_model: <span class="built_in">str</span> = <span class="string">&quot;gpt-4-turbo&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 向量数据库配置</span></span><br><span class="line">    vector_db_type: <span class="built_in">str</span> = <span class="string">&quot;chroma&quot;</span>  <span class="comment"># chroma, pinecone</span></span><br><span class="line">    chroma_persist_directory: <span class="built_in">str</span> = <span class="string">&quot;./chroma_db&quot;</span></span><br><span class="line">    pinecone_index_name: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检索配置</span></span><br><span class="line">    chunk_size: <span class="built_in">int</span> = <span class="number">1000</span></span><br><span class="line">    chunk_overlap: <span class="built_in">int</span> = <span class="number">200</span></span><br><span class="line">    top_k: <span class="built_in">int</span> = <span class="number">4</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 生成配置</span></span><br><span class="line">    max_tokens: <span class="built_in">int</span> = <span class="number">1000</span></span><br><span class="line">    temperature: <span class="built_in">float</span> = <span class="number">0.7</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Config</span>:</span><br><span class="line">        env_file = <span class="string">&quot;.env&quot;</span></span><br><span class="line"></span><br><span class="line">settings = Settings()</span><br></pre></td></tr></table></figure>

<h4 id="2-文档加载器"><a href="#2-文档加载器" class="headerlink" title="2. 文档加载器"></a>2. 文档加载器</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># components/document_loader.py</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Union</span></span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> langchain.document_loaders <span class="keyword">import</span> (</span><br><span class="line">    TextLoader,</span><br><span class="line">    PyPDFLoader,</span><br><span class="line">    UnstructuredWordDocumentLoader,</span><br><span class="line">    CSVLoader</span><br><span class="line">)</span><br><span class="line"><span class="keyword">from</span> langchain.schema <span class="keyword">import</span> Document</span><br><span class="line"><span class="keyword">from</span> langchain.text_splitter <span class="keyword">import</span> RecursiveCharacterTextSplitter</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DocumentLoader</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, chunk_size: <span class="built_in">int</span> = <span class="number">1000</span>, chunk_overlap: <span class="built_in">int</span> = <span class="number">200</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.text_splitter = RecursiveCharacterTextSplitter(</span><br><span class="line">            chunk_size=chunk_size,</span><br><span class="line">            chunk_overlap=chunk_overlap,</span><br><span class="line">            length_function=<span class="built_in">len</span></span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load_file</span>(<span class="params">self, file_path: <span class="type">Union</span>[<span class="built_in">str</span>, Path]</span>) -&gt; <span class="type">List</span>[Document]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;加载单个文件&quot;&quot;&quot;</span></span><br><span class="line">        file_path = Path(file_path)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> file_path.suffix.lower() == <span class="string">&#x27;.txt&#x27;</span>:</span><br><span class="line">            loader = TextLoader(<span class="built_in">str</span>(file_path), encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> file_path.suffix.lower() == <span class="string">&#x27;.pdf&#x27;</span>:</span><br><span class="line">            loader = PyPDFLoader(<span class="built_in">str</span>(file_path))</span><br><span class="line">        <span class="keyword">elif</span> file_path.suffix.lower() <span class="keyword">in</span> [<span class="string">&#x27;.doc&#x27;</span>, <span class="string">&#x27;.docx&#x27;</span>]:</span><br><span class="line">            loader = UnstructuredWordDocumentLoader(<span class="built_in">str</span>(file_path))</span><br><span class="line">        <span class="keyword">elif</span> file_path.suffix.lower() == <span class="string">&#x27;.csv&#x27;</span>:</span><br><span class="line">            loader = CSVLoader(<span class="built_in">str</span>(file_path))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;不支持的文件类型: <span class="subst">&#123;file_path.suffix&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        documents = loader.load()</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.text_splitter.split_documents(documents)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load_directory</span>(<span class="params">self, directory_path: <span class="type">Union</span>[<span class="built_in">str</span>, Path]</span>) -&gt; <span class="type">List</span>[Document]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;加载目录中的所有文件&quot;&quot;&quot;</span></span><br><span class="line">        directory_path = Path(directory_path)</span><br><span class="line">        all_documents = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> file_path <span class="keyword">in</span> directory_path.rglob(<span class="string">&#x27;*&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> file_path.is_file() <span class="keyword">and</span> file_path.suffix.lower() <span class="keyword">in</span> [<span class="string">&#x27;.txt&#x27;</span>, <span class="string">&#x27;.pdf&#x27;</span>, <span class="string">&#x27;.doc&#x27;</span>, <span class="string">&#x27;.docx&#x27;</span>, <span class="string">&#x27;.csv&#x27;</span>]:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    documents = <span class="variable language_">self</span>.load_file(file_path)</span><br><span class="line">                    all_documents.extend(documents)</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;加载文件 <span class="subst">&#123;file_path&#125;</span> 时出错: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> all_documents</span><br></pre></td></tr></table></figure>

<h4 id="3-向量存储管理"><a href="#3-向量存储管理" class="headerlink" title="3. 向量存储管理"></a>3. 向量存储管理</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># components/vector_store.py</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Optional</span></span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"><span class="keyword">from</span> langchain.schema <span class="keyword">import</span> Document</span><br><span class="line"><span class="keyword">from</span> langchain.vectorstores <span class="keyword">import</span> Chroma</span><br><span class="line"><span class="keyword">from</span> langchain.embeddings <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"><span class="keyword">import</span> chromadb</span><br><span class="line"><span class="keyword">from</span> config.settings <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VectorStoreBase</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_documents</span>(<span class="params">self, documents: <span class="type">List</span>[Document]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">similarity_search</span>(<span class="params">self, query: <span class="built_in">str</span>, k: <span class="built_in">int</span> = <span class="number">4</span></span>) -&gt; <span class="type">List</span>[Document]:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete_collection</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChromaVectorStore</span>(<span class="title class_ inherited__">VectorStoreBase</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, collection_name: <span class="built_in">str</span> = <span class="string">&quot;default&quot;</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.embeddings = OpenAIEmbeddings(</span><br><span class="line">            model=settings.embedding_model,</span><br><span class="line">            openai_api_key=settings.openai_api_key</span><br><span class="line">        )</span><br><span class="line">        <span class="variable language_">self</span>.collection_name = collection_name</span><br><span class="line">        <span class="variable language_">self</span>.vectorstore = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>._initialize_store()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_initialize_store</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;初始化向量存储&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.vectorstore = Chroma(</span><br><span class="line">            collection_name=<span class="variable language_">self</span>.collection_name,</span><br><span class="line">            embedding_function=<span class="variable language_">self</span>.embeddings,</span><br><span class="line">            persist_directory=settings.chroma_persist_directory</span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_documents</span>(<span class="params">self, documents: <span class="type">List</span>[Document]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;添加文档到向量存储&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> documents:</span><br><span class="line">            <span class="variable language_">self</span>.vectorstore.add_documents(documents)</span><br><span class="line">            <span class="variable language_">self</span>.vectorstore.persist()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">similarity_search</span>(<span class="params">self, query: <span class="built_in">str</span>, k: <span class="built_in">int</span> = <span class="number">4</span></span>) -&gt; <span class="type">List</span>[Document]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;相似性搜索&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.vectorstore.similarity_search(query, k=k)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete_collection</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;删除集合&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.vectorstore.delete_collection()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VectorStoreFactory</span>:</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_vector_store</span>(<span class="params">store_type: <span class="built_in">str</span> = <span class="string">&quot;chroma&quot;</span>, **kwargs</span>) -&gt; VectorStoreBase:</span><br><span class="line">        <span class="keyword">if</span> store_type == <span class="string">&quot;chroma&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> ChromaVectorStore(**kwargs)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;不支持的向量存储类型: <span class="subst">&#123;store_type&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="4-检索器"><a href="#4-检索器" class="headerlink" title="4. 检索器"></a>4. 检索器</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># components/retriever.py</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Any</span></span><br><span class="line"><span class="keyword">from</span> langchain.schema <span class="keyword">import</span> Document</span><br><span class="line"><span class="keyword">from</span> langchain.retrievers <span class="keyword">import</span> ContextualCompressionRetriever</span><br><span class="line"><span class="keyword">from</span> langchain.retrievers.document_compressors <span class="keyword">import</span> LLMChainExtractor</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> components.vector_store <span class="keyword">import</span> VectorStoreBase</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdvancedRetriever</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, vector_store: VectorStoreBase, use_compression: <span class="built_in">bool</span> = <span class="literal">True</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.vector_store = vector_store</span><br><span class="line">        <span class="variable language_">self</span>.use_compression = use_compression</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> use_compression:</span><br><span class="line">            <span class="variable language_">self</span>.llm = ChatOpenAI(</span><br><span class="line">                model=settings.llm_model,</span><br><span class="line">                api_key=settings.openai_api_key,</span><br><span class="line">                temperature=<span class="number">0</span></span><br><span class="line">            )</span><br><span class="line">            <span class="variable language_">self</span>.compressor = LLMChainExtractor.from_llm(<span class="variable language_">self</span>.llm)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">retrieve</span>(<span class="params">self, query: <span class="built_in">str</span>, k: <span class="built_in">int</span> = <span class="literal">None</span></span>) -&gt; <span class="type">List</span>[Document]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;检索相关文档&quot;&quot;&quot;</span></span><br><span class="line">        k = k <span class="keyword">or</span> settings.top_k</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 基础检索</span></span><br><span class="line">        base_retriever = <span class="variable language_">self</span>.vector_store.vectorstore.as_retriever(</span><br><span class="line">            search_kwargs=&#123;<span class="string">&quot;k&quot;</span>: k&#125;</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.use_compression:</span><br><span class="line">            <span class="comment"># 使用压缩检索器</span></span><br><span class="line">            compression_retriever = ContextualCompressionRetriever(</span><br><span class="line">                base_compressor=<span class="variable language_">self</span>.compressor,</span><br><span class="line">                base_retriever=base_retriever</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">return</span> compression_retriever.get_relevant_documents(query)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> base_retriever.get_relevant_documents(query)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">retrieve_with_scores</span>(<span class="params">self, query: <span class="built_in">str</span>, k: <span class="built_in">int</span> = <span class="literal">None</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">tuple</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;检索文档并返回相似度分数&quot;&quot;&quot;</span></span><br><span class="line">        k = k <span class="keyword">or</span> settings.top_k</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.vector_store.vectorstore.similarity_search_with_score(query, k=k)</span><br></pre></td></tr></table></figure>

<h4 id="5-生成器"><a href="#5-生成器" class="headerlink" title="5. 生成器"></a>5. 生成器</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># components/generator.py</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Any</span>, <span class="type">Optional</span></span><br><span class="line"><span class="keyword">from</span> langchain.schema <span class="keyword">import</span> Document</span><br><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> RetrievalQA</span><br><span class="line"><span class="keyword">from</span> langchain.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> components.retriever <span class="keyword">import</span> AdvancedRetriever</span><br><span class="line"><span class="keyword">from</span> config.settings <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RAGGenerator</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, retriever: AdvancedRetriever</span>):</span><br><span class="line">        <span class="variable language_">self</span>.retriever = retriever</span><br><span class="line">        <span class="variable language_">self</span>.llm = ChatOpenAI(</span><br><span class="line">            model=settings.llm_model,</span><br><span class="line">            api_key=settings.openai_api_key,</span><br><span class="line">            temperature=settings.temperature,</span><br><span class="line">            max_tokens=settings.max_tokens</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 自定义提示词模板</span></span><br><span class="line">        <span class="variable language_">self</span>.prompt_template = PromptTemplate(</span><br><span class="line">            input_variables=[<span class="string">&quot;context&quot;</span>, <span class="string">&quot;question&quot;</span>],</span><br><span class="line">            template=<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            基于以下上下文信息回答问题。如果上下文中没有相关信息，请说明无法从提供的信息中找到答案。</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            上下文信息：</span></span><br><span class="line"><span class="string">            &#123;context&#125;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            问题：&#123;question&#125;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            回答：</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 创建QA链</span></span><br><span class="line">        <span class="variable language_">self</span>.qa_chain = RetrievalQA.from_chain_type(</span><br><span class="line">            llm=<span class="variable language_">self</span>.llm,</span><br><span class="line">            chain_type=<span class="string">&quot;stuff&quot;</span>,</span><br><span class="line">            retriever=<span class="variable language_">self</span>.retriever.vector_store.vectorstore.as_retriever(),</span><br><span class="line">            chain_type_kwargs=&#123;<span class="string">&quot;prompt&quot;</span>: <span class="variable language_">self</span>.prompt_template&#125;,</span><br><span class="line">            return_source_documents=<span class="literal">True</span></span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_answer</span>(<span class="params">self, question: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;生成答案&quot;&quot;&quot;</span></span><br><span class="line">        result = <span class="variable language_">self</span>.qa_chain(&#123;<span class="string">&quot;query&quot;</span>: question&#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;answer&quot;</span>: result[<span class="string">&quot;result&quot;</span>],</span><br><span class="line">            <span class="string">&quot;source_documents&quot;</span>: result[<span class="string">&quot;source_documents&quot;</span>],</span><br><span class="line">            <span class="string">&quot;question&quot;</span>: question</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_streaming_answer</span>(<span class="params">self, question: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;流式生成答案&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 检索相关文档</span></span><br><span class="line">        docs = <span class="variable language_">self</span>.retriever.retrieve(question)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 构建上下文</span></span><br><span class="line">        context = <span class="string">&quot;\n\n&quot;</span>.join([doc.page_content <span class="keyword">for</span> doc <span class="keyword">in</span> docs])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 构建提示词</span></span><br><span class="line">        prompt = <span class="variable language_">self</span>.prompt_template.<span class="built_in">format</span>(context=context, question=question)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 流式生成</span></span><br><span class="line">        <span class="keyword">for</span> chunk <span class="keyword">in</span> <span class="variable language_">self</span>.llm.stream(prompt):</span><br><span class="line">            <span class="keyword">yield</span> chunk.content</span><br></pre></td></tr></table></figure>

<h3 id="🖥️-Streamlit应用界面"><a href="#🖥️-Streamlit应用界面" class="headerlink" title="🖥️ Streamlit应用界面"></a>🖥️ Streamlit应用界面</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app.py</span></span><br><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> components.document_loader <span class="keyword">import</span> DocumentLoader</span><br><span class="line"><span class="keyword">from</span> components.vector_store <span class="keyword">import</span> VectorStoreFactory</span><br><span class="line"><span class="keyword">from</span> components.retriever <span class="keyword">import</span> AdvancedRetriever</span><br><span class="line"><span class="keyword">from</span> components.generator <span class="keyword">import</span> RAGGenerator</span><br><span class="line"><span class="keyword">from</span> config.settings <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line"><span class="comment"># 页面配置</span></span><br><span class="line">st.set_page_config(</span><br><span class="line">    page_title=<span class="string">&quot;智能文档问答系统&quot;</span>,</span><br><span class="line">    page_icon=<span class="string">&quot;🤖&quot;</span>,</span><br><span class="line">    layout=<span class="string">&quot;wide&quot;</span>,</span><br><span class="line">    initial_sidebar_state=<span class="string">&quot;expanded&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化会话状态</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;vector_store&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> st.session_state:</span><br><span class="line">    st.session_state.vector_store = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;rag_generator&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> st.session_state:</span><br><span class="line">    st.session_state.rag_generator = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;chat_history&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> st.session_state:</span><br><span class="line">    st.session_state.chat_history = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># 侧边栏配置</span></span><br><span class="line"><span class="keyword">with</span> st.sidebar:</span><br><span class="line">    st.header(<span class="string">&quot;📁 文档管理&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 文件上传</span></span><br><span class="line">    uploaded_files = st.file_uploader(</span><br><span class="line">        <span class="string">&quot;上传文档&quot;</span>,</span><br><span class="line">        <span class="built_in">type</span>=[<span class="string">&quot;txt&quot;</span>, <span class="string">&quot;pdf&quot;</span>, <span class="string">&quot;docx&quot;</span>, <span class="string">&quot;csv&quot;</span>],</span><br><span class="line">        accept_multiple_files=<span class="literal">True</span>,</span><br><span class="line">        <span class="built_in">help</span>=<span class="string">&quot;支持TXT、PDF、DOCX、CSV格式&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 处理上传的文件</span></span><br><span class="line">    <span class="keyword">if</span> uploaded_files <span class="keyword">and</span> st.button(<span class="string">&quot;处理文档&quot;</span>, <span class="built_in">type</span>=<span class="string">&quot;primary&quot;</span>):</span><br><span class="line">        <span class="keyword">with</span> st.spinner(<span class="string">&quot;正在处理文档...&quot;</span>):</span><br><span class="line">            <span class="comment"># 保存上传的文件</span></span><br><span class="line">            docs_dir = Path(<span class="string">&quot;./temp_docs&quot;</span>)</span><br><span class="line">            docs_dir.mkdir(exist_ok=<span class="literal">True</span>)</span><br><span class="line">            </span><br><span class="line">            saved_files = []</span><br><span class="line">            <span class="keyword">for</span> uploaded_file <span class="keyword">in</span> uploaded_files:</span><br><span class="line">                file_path = docs_dir / uploaded_file.name</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    f.write(uploaded_file.getbuffer())</span><br><span class="line">                saved_files.append(file_path)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 加载文档</span></span><br><span class="line">            loader = DocumentLoader(</span><br><span class="line">                chunk_size=settings.chunk_size,</span><br><span class="line">                chunk_overlap=settings.chunk_overlap</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            all_documents = []</span><br><span class="line">            <span class="keyword">for</span> file_path <span class="keyword">in</span> saved_files:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    documents = loader.load_file(file_path)</span><br><span class="line">                    all_documents.extend(documents)</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    st.error(<span class="string">f&quot;处理文件 <span class="subst">&#123;file_path.name&#125;</span> 时出错: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> all_documents:</span><br><span class="line">                <span class="comment"># 创建向量存储</span></span><br><span class="line">                vector_store = VectorStoreFactory.create_vector_store(</span><br><span class="line">                    store_type=settings.vector_db_type,</span><br><span class="line">                    collection_name=<span class="string">&quot;uploaded_docs&quot;</span></span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 添加文档到向量存储</span></span><br><span class="line">                vector_store.add_documents(all_documents)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 创建检索器和生成器</span></span><br><span class="line">                retriever = AdvancedRetriever(vector_store)</span><br><span class="line">                rag_generator = RAGGenerator(retriever)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 保存到会话状态</span></span><br><span class="line">                st.session_state.vector_store = vector_store</span><br><span class="line">                st.session_state.rag_generator = rag_generator</span><br><span class="line">                </span><br><span class="line">                st.success(<span class="string">f&quot;成功处理 <span class="subst">&#123;<span class="built_in">len</span>(all_documents)&#125;</span> 个文档片段！&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 清理临时文件</span></span><br><span class="line">            <span class="keyword">for</span> file_path <span class="keyword">in</span> saved_files:</span><br><span class="line">                file_path.unlink()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 系统配置</span></span><br><span class="line">    st.header(<span class="string">&quot;⚙️ 系统配置&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检索参数</span></span><br><span class="line">    top_k = st.slider(<span class="string">&quot;检索文档数量&quot;</span>, <span class="number">1</span>, <span class="number">10</span>, settings.top_k)</span><br><span class="line">    temperature = st.slider(<span class="string">&quot;生成温度&quot;</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, settings.temperature, <span class="number">0.1</span>)</span><br><span class="line">    max_tokens = st.number_input(<span class="string">&quot;最大Token数&quot;</span>, <span class="number">100</span>, <span class="number">2000</span>, settings.max_tokens)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 清除历史</span></span><br><span class="line">    <span class="keyword">if</span> st.button(<span class="string">&quot;清除对话历史&quot;</span>):</span><br><span class="line">        st.session_state.chat_history = []</span><br><span class="line">        st.rerun()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主界面</span></span><br><span class="line">st.title(<span class="string">&quot;🤖 智能文档问答系统&quot;</span>)</span><br><span class="line">st.markdown(<span class="string">&quot;基于RAG技术的智能文档问答，支持多种文档格式&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否已加载文档</span></span><br><span class="line"><span class="keyword">if</span> st.session_state.rag_generator <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    st.info(<span class="string">&quot;👈 请先在侧边栏上传文档&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示示例</span></span><br><span class="line">    <span class="keyword">with</span> st.expander(<span class="string">&quot;💡 使用说明&quot;</span>, expanded=<span class="literal">True</span>):</span><br><span class="line">        st.markdown(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        ### 如何使用：</span></span><br><span class="line"><span class="string">        1. **上传文档**：在左侧侧边栏上传您的文档文件</span></span><br><span class="line"><span class="string">        2. **处理文档**：点击&quot;处理文档&quot;按钮，系统会自动分析和索引文档内容</span></span><br><span class="line"><span class="string">        3. **开始问答**：在下方输入框中输入您的问题</span></span><br><span class="line"><span class="string">        4. **查看答案**：系统会基于文档内容生成准确的答案</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        ### 支持的文档格式：</span></span><br><span class="line"><span class="string">        - 📄 TXT文本文件</span></span><br><span class="line"><span class="string">        - 📕 PDF文档</span></span><br><span class="line"><span class="string">        - 📘 Word文档（DOCX）</span></span><br><span class="line"><span class="string">        - 📊 CSV数据文件</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        ### 功能特点：</span></span><br><span class="line"><span class="string">        - 🔍 智能检索：基于语义相似度检索相关内容</span></span><br><span class="line"><span class="string">        - 🧠 上下文理解：结合多个文档片段生成综合答案</span></span><br><span class="line"><span class="string">        - 📚 来源追踪：显示答案的具体来源文档</span></span><br><span class="line"><span class="string">        - 💬 对话记忆：支持多轮对话上下文</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># 对话界面</span></span><br><span class="line">    st.header(<span class="string">&quot;💬 智能问答&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示对话历史</span></span><br><span class="line">    <span class="keyword">for</span> i, (question, answer, sources) <span class="keyword">in</span> <span class="built_in">enumerate</span>(st.session_state.chat_history):</span><br><span class="line">        <span class="keyword">with</span> st.container():</span><br><span class="line">            st.markdown(<span class="string">f&quot;**🙋 问题 <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>：** <span class="subst">&#123;question&#125;</span>&quot;</span>)</span><br><span class="line">            st.markdown(<span class="string">f&quot;**🤖 回答：** <span class="subst">&#123;answer&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> sources:</span><br><span class="line">                <span class="keyword">with</span> st.expander(<span class="string">f&quot;📚 参考来源 (<span class="subst">&#123;<span class="built_in">len</span>(sources)&#125;</span>个文档片段)&quot;</span>):</span><br><span class="line">                    <span class="keyword">for</span> j, source <span class="keyword">in</span> <span class="built_in">enumerate</span>(sources):</span><br><span class="line">                        st.markdown(<span class="string">f&quot;**片段 <span class="subst">&#123;j+<span class="number">1</span>&#125;</span>：**&quot;</span>)</span><br><span class="line">                        st.text(source.page_content[:<span class="number">300</span>] + <span class="string">&quot;...&quot;</span> <span class="keyword">if</span> <span class="built_in">len</span>(source.page_content) &gt; <span class="number">300</span> <span class="keyword">else</span> source.page_content)</span><br><span class="line">                        <span class="keyword">if</span> <span class="built_in">hasattr</span>(source, <span class="string">&#x27;metadata&#x27;</span>) <span class="keyword">and</span> source.metadata:</span><br><span class="line">                            st.caption(<span class="string">f&quot;来源：<span class="subst">&#123;source.metadata&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            st.markdown(<span class="string">&quot;---&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 问题输入</span></span><br><span class="line">    question = st.text_input(</span><br><span class="line">        <span class="string">&quot;请输入您的问题：&quot;</span>,</span><br><span class="line">        placeholder=<span class="string">&quot;例如：文档中提到了哪些关键技术？&quot;</span>,</span><br><span class="line">        key=<span class="string">&quot;question_input&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    col1, col2 = st.columns([<span class="number">1</span>, <span class="number">4</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> col1:</span><br><span class="line">        ask_button = st.button(<span class="string">&quot;🚀 提问&quot;</span>, <span class="built_in">type</span>=<span class="string">&quot;primary&quot;</span>, use_container_width=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> col2:</span><br><span class="line">        stream_mode = st.checkbox(<span class="string">&quot;流式输出&quot;</span>, value=<span class="literal">False</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ask_button <span class="keyword">and</span> question:</span><br><span class="line">        <span class="keyword">with</span> st.spinner(<span class="string">&quot;正在思考中...&quot;</span>):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> stream_mode:</span><br><span class="line">                    <span class="comment"># 流式输出</span></span><br><span class="line">                    answer_placeholder = st.empty()</span><br><span class="line">                    answer_text = <span class="string">&quot;&quot;</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">for</span> chunk <span class="keyword">in</span> st.session_state.rag_generator.generate_streaming_answer(question):</span><br><span class="line">                        answer_text += chunk</span><br><span class="line">                        answer_placeholder.markdown(<span class="string">f&quot;**🤖 回答：** <span class="subst">&#123;answer_text&#125;</span>&quot;</span>)</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># 获取来源文档</span></span><br><span class="line">                    docs = st.session_state.rag_generator.retriever.retrieve(question, k=top_k)</span><br><span class="line">                    </span><br><span class="line">                    result = &#123;</span><br><span class="line">                        <span class="string">&quot;answer&quot;</span>: answer_text,</span><br><span class="line">                        <span class="string">&quot;source_documents&quot;</span>: docs,</span><br><span class="line">                        <span class="string">&quot;question&quot;</span>: question</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># 普通输出</span></span><br><span class="line">                    result = st.session_state.rag_generator.generate_answer(question)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 添加到对话历史</span></span><br><span class="line">                st.session_state.chat_history.append((</span><br><span class="line">                    result[<span class="string">&quot;question&quot;</span>],</span><br><span class="line">                    result[<span class="string">&quot;answer&quot;</span>],</span><br><span class="line">                    result[<span class="string">&quot;source_documents&quot;</span>]</span><br><span class="line">                ))</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 重新运行以显示新的对话</span></span><br><span class="line">                st.rerun()</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                st.error(<span class="string">f&quot;生成答案时出错：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 统计信息</span></span><br><span class="line">    <span class="keyword">if</span> st.session_state.chat_history:</span><br><span class="line">        st.header(<span class="string">&quot;📊 对话统计&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        col1, col2, col3 = st.columns(<span class="number">3</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> col1:</span><br><span class="line">            st.metric(<span class="string">&quot;对话轮数&quot;</span>, <span class="built_in">len</span>(st.session_state.chat_history))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> col2:</span><br><span class="line">            total_chars = <span class="built_in">sum</span>(<span class="built_in">len</span>(answer) <span class="keyword">for</span> _, answer, _ <span class="keyword">in</span> st.session_state.chat_history)</span><br><span class="line">            st.metric(<span class="string">&quot;总回答字数&quot;</span>, total_chars)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> col3:</span><br><span class="line">            avg_sources = <span class="built_in">sum</span>(<span class="built_in">len</span>(sources) <span class="keyword">for</span> _, _, sources <span class="keyword">in</span> st.session_state.chat_history) / <span class="built_in">len</span>(st.session_state.chat_history)</span><br><span class="line">            st.metric(<span class="string">&quot;平均参考来源&quot;</span>, <span class="string">f&quot;<span class="subst">&#123;avg_sources:<span class="number">.1</span>f&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 页脚</span></span><br><span class="line">st.markdown(<span class="string">&quot;---&quot;</span>)</span><br><span class="line">st.markdown(</span><br><span class="line">    <span class="string">&quot;&lt;div style=&#x27;text-align: center; color: gray;&#x27;&gt;&quot;</span>  </span><br><span class="line">    <span class="string">&quot;🤖 智能文档问答系统 | 基于LangChain和Streamlit构建&quot;</span>  </span><br><span class="line">    <span class="string">&quot;&lt;/div&gt;&quot;</span>,</span><br><span class="line">    unsafe_allow_html=<span class="literal">True</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="📦-部署配置"><a href="#📦-部署配置" class="headerlink" title="📦 部署配置"></a>📦 部署配置</h3><h4 id="1-依赖文件"><a href="#1-依赖文件" class="headerlink" title="1. 依赖文件"></a>1. 依赖文件</h4><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># requirements.txt</span><br><span class="line">streamlit&gt;=1.28.0</span><br><span class="line">langchain&gt;=0.1.0</span><br><span class="line">langchain-openai&gt;=0.0.5</span><br><span class="line">langchain-community&gt;=0.0.10</span><br><span class="line">chromadb&gt;=0.4.0</span><br><span class="line">openai&gt;=1.10.0</span><br><span class="line">tiktoken&gt;=0.5.0</span><br><span class="line">pandas&gt;=2.0.0</span><br><span class="line">numpy&gt;=1.24.0</span><br><span class="line">plotly&gt;=5.15.0</span><br><span class="line">pydantic&gt;=2.0.0</span><br><span class="line">python-dotenv&gt;=1.0.0</span><br><span class="line">PyPDF2&gt;=3.0.0</span><br><span class="line">python-docx&gt;=0.8.11</span><br><span class="line">unstructured&gt;=0.10.0</span><br><span class="line">jieba&gt;=0.42.1</span><br></pre></td></tr></table></figure>

<h4 id="2-环境配置"><a href="#2-环境配置" class="headerlink" title="2. 环境配置"></a>2. 环境配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .env</span></span><br><span class="line">OPENAI_API_KEY=your-openai-api-key</span><br><span class="line">ANTHROPIC_API_KEY=your-anthropic-api-key</span><br><span class="line">EMBEDDING_MODEL=text-embedding-ada-002</span><br><span class="line">LLM_MODEL=gpt-4-turbo</span><br><span class="line">VECTOR_DB_TYPE=chroma</span><br><span class="line">CHROMA_PERSIST_DIRECTORY=./chroma_db</span><br><span class="line">CHUNK_SIZE=1000</span><br><span class="line">CHUNK_OVERLAP=200</span><br><span class="line">TOP_K=4</span><br><span class="line">MAX_TOKENS=1000</span><br><span class="line">TEMPERATURE=0.7</span><br></pre></td></tr></table></figure>

<h4 id="3-启动脚本"><a href="#3-启动脚本" class="headerlink" title="3. 启动脚本"></a>3. 启动脚本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># run.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建虚拟环境</span></span><br><span class="line">python -m venv venv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 激活虚拟环境</span></span><br><span class="line"><span class="built_in">source</span> venv/bin/activate  <span class="comment"># Linux/Mac</span></span><br><span class="line"><span class="comment"># venv\Scripts\activate  # Windows</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line">pip install -r requirements.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动应用</span></span><br><span class="line">streamlit run app.py --server.port 8501</span><br></pre></td></tr></table></figure>

<h2 id="🚀-最佳实践和优化建议"><a href="#🚀-最佳实践和优化建议" class="headerlink" title="🚀 最佳实践和优化建议"></a>🚀 最佳实践和优化建议</h2><h3 id="1-性能优化"><a href="#1-性能优化" class="headerlink" title="1. 性能优化"></a>1. 性能优化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 缓存优化</span></span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@functools.lru_cache(<span class="params">maxsize=<span class="number">128</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cached_embedding</span>(<span class="params">text: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">float</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;缓存嵌入计算结果&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> embeddings.embed_query(text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 批量处理</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">batch_process_documents</span>(<span class="params">documents: <span class="type">List</span>[Document], batch_size: <span class="built_in">int</span> = <span class="number">10</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;批量处理文档以提高效率&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(documents), batch_size):</span><br><span class="line">        batch = documents[i:i + batch_size]</span><br><span class="line">        <span class="keyword">yield</span> batch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 异步处理</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">async_generate_answer</span>(<span class="params">question: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;异步生成答案&quot;&quot;&quot;</span></span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line">    result = <span class="keyword">await</span> loop.run_in_executor(</span><br><span class="line">        <span class="literal">None</span>, </span><br><span class="line">        rag_generator.generate_answer, </span><br><span class="line">        question</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<h3 id="2-错误处理"><a href="#2-错误处理" class="headerlink" title="2. 错误处理"></a>2. 错误处理</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 健壮的错误处理</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RAGError</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;RAG系统自定义异常&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">safe_generate_answer</span>(<span class="params">question: <span class="built_in">str</span>, max_retries: <span class="built_in">int</span> = <span class="number">3</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;安全的答案生成，包含重试机制&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> attempt <span class="keyword">in</span> <span class="built_in">range</span>(max_retries):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> rag_generator.generate_answer(question)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">if</span> attempt == max_retries - <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">raise</span> RAGError(<span class="string">f&quot;生成答案失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            time.sleep(<span class="number">2</span> ** attempt)  <span class="comment"># 指数退避</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;answer&quot;</span>: <span class="string">&quot;抱歉，暂时无法生成答案&quot;</span>, <span class="string">&quot;source_documents&quot;</span>: []&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-监控和日志"><a href="#3-监控和日志" class="headerlink" title="3. 监控和日志"></a>3. 监控和日志</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置日志</span></span><br><span class="line">logging.basicConfig(</span><br><span class="line">    level=logging.INFO,</span><br><span class="line">    <span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>,</span><br><span class="line">    handlers=[</span><br><span class="line">        logging.FileHandler(<span class="string">&#x27;rag_app.log&#x27;</span>),</span><br><span class="line">        logging.StreamHandler()</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MonitoredRAGGenerator</span>(<span class="title class_ inherited__">RAGGenerator</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_answer</span>(<span class="params">self, question: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        start_time = datetime.now()</span><br><span class="line">        logger.info(<span class="string">f&quot;开始处理问题: <span class="subst">&#123;question[:<span class="number">50</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            result = <span class="built_in">super</span>().generate_answer(question)</span><br><span class="line">            duration = (datetime.now() - start_time).total_seconds()</span><br><span class="line">            </span><br><span class="line">            logger.info(<span class="string">f&quot;问题处理完成，耗时: <span class="subst">&#123;duration:<span class="number">.2</span>f&#125;</span>秒&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(<span class="string">f&quot;问题处理失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>

<h2 id="📈-进阶功能扩展"><a href="#📈-进阶功能扩展" class="headerlink" title="📈 进阶功能扩展"></a>📈 进阶功能扩展</h2><h3 id="1-多模态RAG"><a href="#1-多模态RAG" class="headerlink" title="1. 多模态RAG"></a>1. 多模态RAG</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 支持图像和文本的多模态RAG</span></span><br><span class="line"><span class="keyword">from</span> langchain.document_loaders <span class="keyword">import</span> UnstructuredImageLoader</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MultiModalRAG</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.text_retriever = AdvancedRetriever(text_vector_store)</span><br><span class="line">        <span class="variable language_">self</span>.image_retriever = AdvancedRetriever(image_vector_store)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_image</span>(<span class="params">self, image_path: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;处理图像并提取文本描述&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 使用GPT-4V分析图像</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(image_path, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> image_file:</span><br><span class="line">            response = openai.ChatCompletion.create(</span><br><span class="line">                model=<span class="string">&quot;gpt-4-vision-preview&quot;</span>,</span><br><span class="line">                messages=[</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;content&quot;</span>: [</span><br><span class="line">                            &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>, <span class="string">&quot;text&quot;</span>: <span class="string">&quot;请详细描述这张图片的内容&quot;</span>&#125;,</span><br><span class="line">                            &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;image_url&quot;</span>, <span class="string">&quot;image_url&quot;</span>: &#123;<span class="string">&quot;url&quot;</span>: <span class="string">f&quot;data:image/jpeg;base64,<span class="subst">&#123;base64.b64encode(image_file.read()).decode()&#125;</span>&quot;</span>&#125;&#125;</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">return</span> response.choices[<span class="number">0</span>].message.content</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">multimodal_search</span>(<span class="params">self, query: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[Document]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;多模态搜索&quot;&quot;&quot;</span></span><br><span class="line">        text_results = <span class="variable language_">self</span>.text_retriever.retrieve(query)</span><br><span class="line">        image_results = <span class="variable language_">self</span>.image_retriever.retrieve(query)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 合并和排序结果</span></span><br><span class="line">        all_results = text_results + image_results</span><br><span class="line">        <span class="keyword">return</span> all_results[:<span class="number">10</span>]  <span class="comment"># 返回前10个结果</span></span><br></pre></td></tr></table></figure>

<h3 id="2-实时学习和更新"><a href="#2-实时学习和更新" class="headerlink" title="2. 实时学习和更新"></a>2. 实时学习和更新</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 实时学习系统</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdaptiveRAG</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.feedback_store = []</span><br><span class="line">        <span class="variable language_">self</span>.performance_metrics = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">collect_feedback</span>(<span class="params">self, question: <span class="built_in">str</span>, answer: <span class="built_in">str</span>, rating: <span class="built_in">int</span>, feedback: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;收集用户反馈&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.feedback_store.append(&#123;</span><br><span class="line">            <span class="string">&quot;question&quot;</span>: question,</span><br><span class="line">            <span class="string">&quot;answer&quot;</span>: answer,</span><br><span class="line">            <span class="string">&quot;rating&quot;</span>: rating,</span><br><span class="line">            <span class="string">&quot;feedback&quot;</span>: feedback,</span><br><span class="line">            <span class="string">&quot;timestamp&quot;</span>: datetime.now()</span><br><span class="line">        &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_retrieval_strategy</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;基于反馈更新检索策略&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 分析反馈数据</span></span><br><span class="line">        low_rating_questions = [</span><br><span class="line">            item <span class="keyword">for</span> item <span class="keyword">in</span> <span class="variable language_">self</span>.feedback_store </span><br><span class="line">            <span class="keyword">if</span> item[<span class="string">&quot;rating&quot;</span>] &lt; <span class="number">3</span></span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 调整检索参数</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(low_rating_questions) &gt; <span class="number">10</span>:</span><br><span class="line">            <span class="comment"># 增加检索的文档数量</span></span><br><span class="line">            settings.top_k = <span class="built_in">min</span>(settings.top_k + <span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">            logger.info(<span class="string">f&quot;调整检索参数，top_k增加到: <span class="subst">&#123;settings.top_k&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="🎯-总结和选择建议"><a href="#🎯-总结和选择建议" class="headerlink" title="🎯 总结和选择建议"></a>🎯 总结和选择建议</h2><h3 id="框架选择矩阵"><a href="#框架选择矩阵" class="headerlink" title="框架选择矩阵"></a>框架选择矩阵</h3><table>
<thead>
<tr>
<th>使用场景</th>
<th>推荐框架组合</th>
<th>理由</th>
</tr>
</thead>
<tbody><tr>
<td><strong>快速原型</strong></td>
<td>LangChain + Gradio</td>
<td>开发速度快，组件丰富</td>
</tr>
<tr>
<td><strong>企业应用</strong></td>
<td>LlamaIndex + Streamlit</td>
<td>专业RAG，界面美观</td>
</tr>
<tr>
<td><strong>研究项目</strong></td>
<td>Transformers + Jupyter</td>
<td>灵活性高，可定制性强</td>
</tr>
<tr>
<td><strong>生产环境</strong></td>
<td>LangChain + FastAPI + React</td>
<td>性能稳定，可扩展性好</td>
</tr>
</tbody></table>
<h3 id="学习路径建议"><a href="#学习路径建议" class="headerlink" title="学习路径建议"></a>学习路径建议</h3><ol>
<li><p><strong>入门阶段</strong>（1-2周）</p>
<ul>
<li>学习LangChain基础概念</li>
<li>完成简单的LLM调用</li>
<li>尝试Gradio快速原型</li>
</ul>
</li>
<li><p><strong>进阶阶段</strong>（2-4周）</p>
<ul>
<li>掌握RAG系统构建</li>
<li>学习向量数据库使用</li>
<li>开发完整的问答应用</li>
</ul>
</li>
<li><p><strong>高级阶段</strong>（1-2个月）</p>
<ul>
<li>优化系统性能</li>
<li>添加监控和日志</li>
<li>部署到生产环境</li>
</ul>
</li>
</ol>
<h3 id="常见问题解决"><a href="#常见问题解决" class="headerlink" title="常见问题解决"></a>常见问题解决</h3><ol>
<li><strong>内存不足</strong>：使用批量处理和缓存优化</li>
<li><strong>响应慢</strong>：优化检索算法和模型选择</li>
<li><strong>答案质量差</strong>：改进提示词和增加上下文</li>
<li><strong>成本过高</strong>：使用本地模型或优化API调用</li>
</ol>
<hr>
<p>AI应用开发框架为构建智能应用提供了强大的基础设施。通过合理选择和组合这些框架，您可以快速构建出功能强大、性能优秀的AI应用。</p>
<p><strong>下一篇预告</strong>：<a href="./ai-programming-assistants.md">AI编程助手使用指南</a> - 深入了解GitHub Copilot、Cursor等AI编程工具的使用技巧。</p>
<p><em>本文为AI开发工具系列文章第三篇，更多精彩内容请关注后续文章。</em></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/AI%E5%BC%80%E5%8F%91/" rel="tag"># AI开发</a>
              <a href="/tags/LangChain/" rel="tag"># LangChain</a>
              <a href="/tags/LlamaIndex/" rel="tag"># LlamaIndex</a>
              <a href="/tags/RAG/" rel="tag"># RAG</a>
              <a href="/tags/Agent/" rel="tag"># Agent</a>
              <a href="/tags/%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"># 向量数据库</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/08/07/local-ai-model-deployment-tools/" rel="prev" title="本地AI模型部署工具详解：从LM Studio到Ollama的完整指南">
                  <i class="fa fa-angle-left"></i> 本地AI模型部署工具详解：从LM Studio到Ollama的完整指南
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/08/10/legend-eternal-update-instance-node-gm-commands/" rel="next" title="传奇永恒更新：副本节点系统与 GM 变量命令上线，全面支持「九层妖塔」">
                  传奇永恒更新：副本节点系统与 GM 变量命令上线，全面支持「九层妖塔」 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">V.Joker</span>
  </div><footer class="custom-footer">
    <p>微笑是混乱的最佳面具</p>
</footer>


    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
