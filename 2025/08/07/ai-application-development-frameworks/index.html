<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.vjoker.blog","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.24.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="åœ¨æ··æ²Œä¸­å¯»æ‰¾çœŸç›¸ï¼Œåœ¨é»‘æš—é‡Œç»½æ”¾å¾®ç¬‘">
<meta property="og:type" content="blog">
<meta property="og:title" content="V&#39;s Joker Blog">
<meta property="og:url" content="https://www.vjoker.blog/2025/08/07/ai-application-development-frameworks/index.html">
<meta property="og:site_name" content="V&#39;s Joker">
<meta property="og:description" content="åœ¨æ··æ²Œä¸­å¯»æ‰¾çœŸç›¸ï¼Œåœ¨é»‘æš—é‡Œç»½æ”¾å¾®ç¬‘">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-08-07T05:00:00.000Z">
<meta property="article:modified_time" content="2025-08-25T01:02:07.702Z">
<meta property="article:author" content="V.Joker">
<meta property="article:tag" content="AIå¼€å‘">
<meta property="article:tag" content="LangChain">
<meta property="article:tag" content="LlamaIndex">
<meta property="article:tag" content="RAG">
<meta property="article:tag" content="Agent">
<meta property="article:tag" content="å‘é‡æ•°æ®åº“">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.vjoker.blog/2025/08/07/ai-application-development-frameworks/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.vjoker.blog/2025/08/07/ai-application-development-frameworks/","path":"2025/08/07/ai-application-development-frameworks/","title":"AIåº”ç”¨å¼€å‘æ¡†æ¶å®æˆ˜æŒ‡å—ï¼šä»LangChainåˆ°LlamaIndexçš„å®Œæ•´æ”»ç•¥"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>AIåº”ç”¨å¼€å‘æ¡†æ¶å®æˆ˜æŒ‡å—ï¼šä»LangChainåˆ°LlamaIndexçš„å®Œæ•´æ”»ç•¥ | V's Joker</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>







  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="V's Joker" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">V's Joker</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Remember remember the chaos and smile</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%8F%97%EF%B8%8F-AI%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6%E7%94%9F%E6%80%81"><span class="nav-number">1.</span> <span class="nav-text">ğŸ—ï¸ AIåº”ç”¨å¼€å‘æ¡†æ¶ç”Ÿæ€</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%8A-%E6%A1%86%E6%9E%B6%E5%88%86%E7%B1%BB%E5%92%8C%E5%AE%9A%E4%BD%8D"><span class="nav-number">1.1.</span> <span class="nav-text">ğŸ“Š æ¡†æ¶åˆ†ç±»å’Œå®šä½</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%8E%AF-%E6%A0%B8%E5%BF%83%E8%83%BD%E5%8A%9B%E5%AF%B9%E6%AF%94"><span class="nav-number">1.2.</span> <span class="nav-text">ğŸ¯ æ ¸å¿ƒèƒ½åŠ›å¯¹æ¯”</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%A6%9C-LangChain%EF%BC%9A%E6%9C%80%E5%85%A8%E9%9D%A2%E7%9A%84AI%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6"><span class="nav-number">2.</span> <span class="nav-text">ğŸ¦œ LangChainï¼šæœ€å…¨é¢çš„AIåº”ç”¨å¼€å‘æ¡†æ¶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%94%A7-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-number">2.1.</span> <span class="nav-text">ğŸ”§ æ ¸å¿ƒæ¦‚å¿µ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%BB%84%E4%BB%B6%E6%9E%B6%E6%9E%84"><span class="nav-number">2.1.1.</span> <span class="nav-text">1. ç»„ä»¶æ¶æ„</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%AE%BE%E8%AE%A1%E5%93%B2%E5%AD%A6"><span class="nav-number">2.1.2.</span> <span class="nav-text">2. è®¾è®¡å“²å­¦</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%9A%80-%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE"><span class="nav-number">2.2.</span> <span class="nav-text">ğŸš€ å®‰è£…å’Œé…ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%9D-%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="nav-number">2.3.</span> <span class="nav-text">ğŸ“ åŸºç¡€ä½¿ç”¨ç¤ºä¾‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%AE%80%E5%8D%95%E7%9A%84LLM%E8%B0%83%E7%94%A8"><span class="nav-number">2.3.1.</span> <span class="nav-text">1. ç®€å•çš„LLMè°ƒç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%A8%A1%E6%9D%BF"><span class="nav-number">2.3.2.</span> <span class="nav-text">2. æç¤ºè¯æ¨¡æ¿</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E9%93%BE%E5%BC%8F%E7%BB%84%E5%90%88"><span class="nav-number">2.3.3.</span> <span class="nav-text">3. é“¾å¼ç»„åˆ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%A4%96-Agent%E5%BC%80%E5%8F%91"><span class="nav-number">2.4.</span> <span class="nav-text">ğŸ¤– Agentå¼€å‘</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%9F%BA%E7%A1%80Agent"><span class="nav-number">2.4.1.</span> <span class="nav-text">1. åŸºç¡€Agent</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E9%AB%98%E7%BA%A7Agent%EF%BC%9AReAct%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.4.2.</span> <span class="nav-text">2. é«˜çº§Agentï¼šReActæ¨¡å¼</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%92%BE-%E8%AE%B0%E5%BF%86%E7%AE%A1%E7%90%86"><span class="nav-number">2.5.</span> <span class="nav-text">ğŸ’¾ è®°å¿†ç®¡ç†</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BF%86"><span class="nav-number">2.5.1.</span> <span class="nav-text">1. å¯¹è¯è®°å¿†</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%90%91%E9%87%8F%E8%AE%B0%E5%BF%86"><span class="nav-number">2.5.2.</span> <span class="nav-text">2. å‘é‡è®°å¿†</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%94%8D-RAG%E7%B3%BB%E7%BB%9F%E6%9E%84%E5%BB%BA"><span class="nav-number">2.6.</span> <span class="nav-text">ğŸ” RAGç³»ç»Ÿæ„å»º</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%9F%BA%E7%A1%80RAG%E5%AE%9E%E7%8E%B0"><span class="nav-number">2.6.1.</span> <span class="nav-text">1. åŸºç¡€RAGå®ç°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E9%AB%98%E7%BA%A7RAG%EF%BC%9A%E5%A4%9A%E6%A8%A1%E6%80%81%E6%A3%80%E7%B4%A2"><span class="nav-number">2.6.2.</span> <span class="nav-text">2. é«˜çº§RAGï¼šå¤šæ¨¡æ€æ£€ç´¢</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%94%A7-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6"><span class="nav-number">2.7.</span> <span class="nav-text">ğŸ”§ è‡ªå®šä¹‰ç»„ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E8%87%AA%E5%AE%9A%E4%B9%89LLM"><span class="nav-number">2.7.1.</span> <span class="nav-text">1. è‡ªå®šä¹‰LLM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B7%A5%E5%85%B7"><span class="nav-number">2.7.2.</span> <span class="nav-text">2. è‡ªå®šä¹‰å·¥å…·</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%A6%99-LlamaIndex%EF%BC%9A%E4%B8%93%E4%B8%9A%E7%9A%84RAG%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6"><span class="nav-number">3.</span> <span class="nav-text">ğŸ¦™ LlamaIndexï¼šä¸“ä¸šçš„RAGå¼€å‘æ¡†æ¶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%8E%AF-%E6%A0%B8%E5%BF%83%E4%BC%98%E5%8A%BF"><span class="nav-number">3.1.</span> <span class="nav-text">ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%9A%80-%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B"><span class="nav-number">3.2.</span> <span class="nav-text">ğŸš€ å¿«é€Ÿå¼€å§‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE"><span class="nav-number">3.2.1.</span> <span class="nav-text">1. å®‰è£…å’Œé…ç½®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="nav-number">3.2.2.</span> <span class="nav-text">2. åŸºç¡€ä½¿ç”¨</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%8A-%E9%AB%98%E7%BA%A7%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84"><span class="nav-number">3.3.</span> <span class="nav-text">ğŸ“Š é«˜çº§ç´¢å¼•ç»“æ„</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%B1%82%E6%AC%A1%E7%B4%A2%E5%BC%95"><span class="nav-number">3.3.1.</span> <span class="nav-text">1. å±‚æ¬¡ç´¢å¼•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%85%B3%E9%94%AE%E8%AF%8D%E7%B4%A2%E5%BC%95"><span class="nav-number">3.3.2.</span> <span class="nav-text">2. å…³é”®è¯ç´¢å¼•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E7%B4%A2%E5%BC%95"><span class="nav-number">3.3.3.</span> <span class="nav-text">3. çŸ¥è¯†å›¾è°±ç´¢å¼•</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%94%8D-%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2%E6%8A%80%E6%9C%AF"><span class="nav-number">3.4.</span> <span class="nav-text">ğŸ” é«˜çº§æŸ¥è¯¢æŠ€æœ¯</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%A4%9A%E6%A8%A1%E6%80%81%E6%9F%A5%E8%AF%A2"><span class="nav-number">3.4.1.</span> <span class="nav-text">1. å¤šæ¨¡æ€æŸ¥è¯¢</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%AD%90%E9%97%AE%E9%A2%98%E6%9F%A5%E8%AF%A2"><span class="nav-number">3.4.2.</span> <span class="nav-text">2. å­é—®é¢˜æŸ¥è¯¢</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%88-RAG%E8%AF%84%E4%BC%B0"><span class="nav-number">3.5.</span> <span class="nav-text">ğŸ“ˆ RAGè¯„ä¼°</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E8%AF%84%E4%BC%B0%E6%8C%87%E6%A0%87"><span class="nav-number">3.5.1.</span> <span class="nav-text">1. è¯„ä¼°æŒ‡æ ‡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%84%E4%BC%B0"><span class="nav-number">3.5.2.</span> <span class="nav-text">2. è‡ªå®šä¹‰è¯„ä¼°</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%97%84%EF%B8%8F-%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E6%88%98"><span class="nav-number">4.</span> <span class="nav-text">ğŸ—„ï¸ å‘é‡æ•°æ®åº“å®æˆ˜</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%8E%A8-Chroma%EF%BC%9A%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">4.1.</span> <span class="nav-text">ğŸ¨ Chromaï¼šè½»é‡çº§å‘é‡æ•°æ®åº“</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="nav-number">4.1.1.</span> <span class="nav-text">1. åŸºç¡€ä½¿ç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD"><span class="nav-number">4.1.2.</span> <span class="nav-text">2. é«˜çº§åŠŸèƒ½</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%8C-Pinecone%EF%BC%9A%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">4.2.</span> <span class="nav-text">ğŸ“Œ Pineconeï¼šä¼ä¸šçº§å‘é‡æ•°æ®åº“</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE"><span class="nav-number">4.2.1.</span> <span class="nav-text">1. åŸºç¡€é…ç½®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C"><span class="nav-number">4.2.2.</span> <span class="nav-text">2. æ•°æ®æ“ä½œ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.2.3.</span> <span class="nav-text">3. é«˜çº§æŸ¥è¯¢</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%8E%A8-UI%E6%A1%86%E6%9E%B6%EF%BC%9AGradio%E5%92%8CStreamlit"><span class="nav-number">5.</span> <span class="nav-text">ğŸ¨ UIæ¡†æ¶ï¼šGradioå’ŒStreamlit</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%9A%80-Gradio%EF%BC%9A%E5%BF%AB%E9%80%9FAI%E5%BA%94%E7%94%A8%E5%8E%9F%E5%9E%8B"><span class="nav-number">5.1.</span> <span class="nav-text">ğŸš€ Gradioï¼šå¿«é€ŸAIåº”ç”¨åŸå‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%9F%BA%E7%A1%80%E7%95%8C%E9%9D%A2"><span class="nav-number">5.1.1.</span> <span class="nav-text">1. åŸºç¡€ç•Œé¢</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%A4%9A%E5%8A%9F%E8%83%BD%E5%BA%94%E7%94%A8"><span class="nav-number">5.1.2.</span> <span class="nav-text">2. å¤šåŠŸèƒ½åº”ç”¨</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%8A-Streamlit%EF%BC%9A%E6%95%B0%E6%8D%AE%E9%A9%B1%E5%8A%A8%E7%9A%84AI%E5%BA%94%E7%94%A8"><span class="nav-number">5.2.</span> <span class="nav-text">ğŸ“Š Streamlitï¼šæ•°æ®é©±åŠ¨çš„AIåº”ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8"><span class="nav-number">5.2.1.</span> <span class="nav-text">1. åŸºç¡€åº”ç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD-1"><span class="nav-number">5.2.2.</span> <span class="nav-text">2. é«˜çº§åŠŸèƒ½</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%94%A7-%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%9E%84%E5%BB%BA%E5%AE%8C%E6%95%B4%E7%9A%84RAG%E5%BA%94%E7%94%A8"><span class="nav-number">6.</span> <span class="nav-text">ğŸ”§ å®æˆ˜é¡¹ç›®ï¼šæ„å»ºå®Œæ•´çš„RAGåº”ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%8B-%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84"><span class="nav-number">6.1.</span> <span class="nav-text">ğŸ“‹ é¡¹ç›®æ¶æ„</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%8F%97%EF%B8%8F-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E5%AE%9E%E7%8E%B0"><span class="nav-number">6.2.</span> <span class="nav-text">ğŸ—ï¸ æ ¸å¿ƒç»„ä»¶å®ç°</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86"><span class="nav-number">6.2.1.</span> <span class="nav-text">1. é…ç½®ç®¡ç†</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%96%87%E6%A1%A3%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="nav-number">6.2.2.</span> <span class="nav-text">2. æ–‡æ¡£åŠ è½½å™¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%90%91%E9%87%8F%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86"><span class="nav-number">6.2.3.</span> <span class="nav-text">3. å‘é‡å­˜å‚¨ç®¡ç†</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E6%A3%80%E7%B4%A2%E5%99%A8"><span class="nav-number">6.2.4.</span> <span class="nav-text">4. æ£€ç´¢å™¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E7%94%9F%E6%88%90%E5%99%A8"><span class="nav-number">6.2.5.</span> <span class="nav-text">5. ç”Ÿæˆå™¨</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%96%A5%EF%B8%8F-Streamlit%E5%BA%94%E7%94%A8%E7%95%8C%E9%9D%A2"><span class="nav-number">6.3.</span> <span class="nav-text">ğŸ–¥ï¸ Streamlitåº”ç”¨ç•Œé¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%A6-%E9%83%A8%E7%BD%B2%E9%85%8D%E7%BD%AE"><span class="nav-number">6.4.</span> <span class="nav-text">ğŸ“¦ éƒ¨ç½²é…ç½®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E4%BE%9D%E8%B5%96%E6%96%87%E4%BB%B6"><span class="nav-number">6.4.1.</span> <span class="nav-text">1. ä¾èµ–æ–‡ä»¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="nav-number">6.4.2.</span> <span class="nav-text">2. ç¯å¢ƒé…ç½®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC"><span class="nav-number">6.4.3.</span> <span class="nav-text">3. å¯åŠ¨è„šæœ¬</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%9A%80-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E5%92%8C%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE"><span class="nav-number">7.</span> <span class="nav-text">ğŸš€ æœ€ä½³å®è·µå’Œä¼˜åŒ–å»ºè®®</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">7.1.</span> <span class="nav-text">1. æ€§èƒ½ä¼˜åŒ–</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-number">7.2.</span> <span class="nav-text">2. é”™è¯¯å¤„ç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%9B%91%E6%8E%A7%E5%92%8C%E6%97%A5%E5%BF%97"><span class="nav-number">7.3.</span> <span class="nav-text">3. ç›‘æ§å’Œæ—¥å¿—</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%93%88-%E8%BF%9B%E9%98%B6%E5%8A%9F%E8%83%BD%E6%89%A9%E5%B1%95"><span class="nav-number">8.</span> <span class="nav-text">ğŸ“ˆ è¿›é˜¶åŠŸèƒ½æ‰©å±•</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%A4%9A%E6%A8%A1%E6%80%81RAG"><span class="nav-number">8.1.</span> <span class="nav-text">1. å¤šæ¨¡æ€RAG</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AE%9E%E6%97%B6%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%9B%B4%E6%96%B0"><span class="nav-number">8.2.</span> <span class="nav-text">2. å®æ—¶å­¦ä¹ å’Œæ›´æ–°</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%8E%AF-%E6%80%BB%E7%BB%93%E5%92%8C%E9%80%89%E6%8B%A9%E5%BB%BA%E8%AE%AE"><span class="nav-number">9.</span> <span class="nav-text">ğŸ¯ æ€»ç»“å’Œé€‰æ‹©å»ºè®®</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%86%E6%9E%B6%E9%80%89%E6%8B%A9%E7%9F%A9%E9%98%B5"><span class="nav-number">9.1.</span> <span class="nav-text">æ¡†æ¶é€‰æ‹©çŸ©é˜µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84%E5%BB%BA%E8%AE%AE"><span class="nav-number">9.2.</span> <span class="nav-text">å­¦ä¹ è·¯å¾„å»ºè®®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3"><span class="nav-number">9.3.</span> <span class="nav-text">å¸¸è§é—®é¢˜è§£å†³</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="V.Joker"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">V.Joker</p>
  <div class="site-description" itemprop="description">åœ¨æ··æ²Œä¸­å¯»æ‰¾çœŸç›¸ï¼Œåœ¨é»‘æš—é‡Œç»½æ”¾å¾®ç¬‘</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">37</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">116</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/itzdd9527" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;itzdd9527" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yourname@gmail.com" title="E-Mail â†’ mailto:yourname@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS â†’ &#x2F;atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vjoker.blog/2025/08/07/ai-application-development-frameworks/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="V.Joker">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="V's Joker">
      <meta itemprop="description" content="åœ¨æ··æ²Œä¸­å¯»æ‰¾çœŸç›¸ï¼Œåœ¨é»‘æš—é‡Œç»½æ”¾å¾®ç¬‘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="AIåº”ç”¨å¼€å‘æ¡†æ¶å®æˆ˜æŒ‡å—ï¼šä»LangChainåˆ°LlamaIndexçš„å®Œæ•´æ”»ç•¥ | V's Joker">
      <meta itemprop="description" content="æ·±å…¥å­¦ä¹ ä¸»æµAIåº”ç”¨å¼€å‘æ¡†æ¶ï¼ŒåŒ…æ‹¬LangChainã€LlamaIndexã€å‘é‡æ•°æ®åº“ç­‰å·¥å…·çš„å®æˆ˜ä½¿ç”¨æ–¹æ³•å’Œæœ€ä½³å®è·µã€‚">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AIåº”ç”¨å¼€å‘æ¡†æ¶å®æˆ˜æŒ‡å—ï¼šä»LangChainåˆ°LlamaIndexçš„å®Œæ•´æ”»ç•¥
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-07 13:00:00" itemprop="dateCreated datePublished" datetime="2025-08-07T13:00:00+08:00">2025-08-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-25 09:02:07" itemprop="dateModified" datetime="2025-08-25T09:02:07+08:00">2025-08-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">AIæŠ€æœ¯</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI%E6%8A%80%E6%9C%AF/%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">å¼€å‘æ¡†æ¶</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">æ·±å…¥å­¦ä¹ ä¸»æµAIåº”ç”¨å¼€å‘æ¡†æ¶ï¼ŒåŒ…æ‹¬LangChainã€LlamaIndexã€å‘é‡æ•°æ®åº“ç­‰å·¥å…·çš„å®æˆ˜ä½¿ç”¨æ–¹æ³•å’Œæœ€ä½³å®è·µã€‚</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>AIåº”ç”¨å¼€å‘æ¡†æ¶ä¸ºæ„å»ºæ™ºèƒ½åº”ç”¨æä¾›äº†å¼ºå¤§çš„åŸºç¡€è®¾æ–½ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿæ„å»ºå¤æ‚çš„AIç³»ç»Ÿã€‚æœ¬æ–‡å°†æ·±å…¥ä»‹ç»ä¸»æµæ¡†æ¶çš„ä½¿ç”¨æ–¹æ³•ï¼Œä»åŸºç¡€æ¦‚å¿µåˆ°å®æˆ˜é¡¹ç›®ï¼Œå¸®åŠ©æ‚¨æŒæ¡ç°ä»£AIåº”ç”¨å¼€å‘çš„æ ¸å¿ƒæŠ€èƒ½ã€‚</p>
<span id="more"></span>

<h2 id="ğŸ—ï¸-AIåº”ç”¨å¼€å‘æ¡†æ¶ç”Ÿæ€"><a href="#ğŸ—ï¸-AIåº”ç”¨å¼€å‘æ¡†æ¶ç”Ÿæ€" class="headerlink" title="ğŸ—ï¸ AIåº”ç”¨å¼€å‘æ¡†æ¶ç”Ÿæ€"></a>ğŸ—ï¸ AIåº”ç”¨å¼€å‘æ¡†æ¶ç”Ÿæ€</h2><h3 id="ğŸ“Š-æ¡†æ¶åˆ†ç±»å’Œå®šä½"><a href="#ğŸ“Š-æ¡†æ¶åˆ†ç±»å’Œå®šä½" class="headerlink" title="ğŸ“Š æ¡†æ¶åˆ†ç±»å’Œå®šä½"></a>ğŸ“Š æ¡†æ¶åˆ†ç±»å’Œå®šä½</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[AIåº”ç”¨å¼€å‘æ¡†æ¶] --&gt; B[åº”ç”¨ç¼–æ’æ¡†æ¶]</span><br><span class="line">    A --&gt; C[æ•°æ®å¤„ç†æ¡†æ¶]</span><br><span class="line">    A --&gt; D[å‘é‡æ•°æ®åº“]</span><br><span class="line">    A --&gt; E[UIæ¡†æ¶]</span><br><span class="line">    </span><br><span class="line">    B --&gt; B1[LangChain]</span><br><span class="line">    B --&gt; B2[LlamaIndex]</span><br><span class="line">    B --&gt; B3[Semantic Kernel]</span><br><span class="line">    </span><br><span class="line">    C --&gt; C1[Transformers]</span><br><span class="line">    C --&gt; C2[Datasets]</span><br><span class="line">    C --&gt; C3[Accelerate]</span><br><span class="line">    </span><br><span class="line">    D --&gt; D1[Chroma]</span><br><span class="line">    D --&gt; D2[Pinecone]</span><br><span class="line">    D --&gt; D3[Weaviate]</span><br><span class="line">    D --&gt; D4[Qdrant]</span><br><span class="line">    </span><br><span class="line">    E --&gt; E1[Gradio]</span><br><span class="line">    E --&gt; E2[Streamlit]</span><br><span class="line">    E --&gt; E3[Chainlit]</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ¯-æ ¸å¿ƒèƒ½åŠ›å¯¹æ¯”"><a href="#ğŸ¯-æ ¸å¿ƒèƒ½åŠ›å¯¹æ¯”" class="headerlink" title="ğŸ¯ æ ¸å¿ƒèƒ½åŠ›å¯¹æ¯”"></a>ğŸ¯ æ ¸å¿ƒèƒ½åŠ›å¯¹æ¯”</h3><table>
<thead>
<tr>
<th>æ¡†æ¶</th>
<th>ä¸»è¦ç”¨é€”</th>
<th>æ ¸å¿ƒä¼˜åŠ¿</th>
<th>å­¦ä¹ éš¾åº¦</th>
<th>ç”Ÿæ€æˆç†Ÿåº¦</th>
</tr>
</thead>
<tbody><tr>
<td><strong>LangChain</strong></td>
<td>é€šç”¨AIåº”ç”¨</td>
<td>ç”Ÿæ€ä¸°å¯Œï¼Œç»„ä»¶å®Œæ•´</td>
<td>ä¸­ç­‰</td>
<td>â­â­â­â­â­</td>
</tr>
<tr>
<td><strong>LlamaIndex</strong></td>
<td>RAGåº”ç”¨</td>
<td>æ•°æ®å¤„ç†å¼ºï¼Œç´¢å¼•ä¼˜åŒ–</td>
<td>ç®€å•</td>
<td>â­â­â­â­</td>
</tr>
<tr>
<td><strong>Transformers</strong></td>
<td>æ¨¡å‹ä½¿ç”¨</td>
<td>æ¨¡å‹ä¸°å¯Œï¼Œæ€§èƒ½ä¼˜ç§€</td>
<td>ä¸­ç­‰</td>
<td>â­â­â­â­â­</td>
</tr>
<tr>
<td><strong>Gradio</strong></td>
<td>å¿«é€ŸåŸå‹</td>
<td>ç®€å•æ˜“ç”¨ï¼Œéƒ¨ç½²ä¾¿æ·</td>
<td>ç®€å•</td>
<td>â­â­â­â­</td>
</tr>
<tr>
<td><strong>Streamlit</strong></td>
<td>æ•°æ®åº”ç”¨</td>
<td>äº¤äº’ä¸°å¯Œï¼Œå¯è§†åŒ–å¼º</td>
<td>ç®€å•</td>
<td>â­â­â­â­</td>
</tr>
</tbody></table>
<h2 id="ğŸ¦œ-LangChainï¼šæœ€å…¨é¢çš„AIåº”ç”¨å¼€å‘æ¡†æ¶"><a href="#ğŸ¦œ-LangChainï¼šæœ€å…¨é¢çš„AIåº”ç”¨å¼€å‘æ¡†æ¶" class="headerlink" title="ğŸ¦œ LangChainï¼šæœ€å…¨é¢çš„AIåº”ç”¨å¼€å‘æ¡†æ¶"></a>ğŸ¦œ LangChainï¼šæœ€å…¨é¢çš„AIåº”ç”¨å¼€å‘æ¡†æ¶</h2><p><strong>å®˜æ–¹ç½‘ç«™</strong>ï¼š<a target="_blank" rel="noopener" href="https://langchain.com/">https://langchain.com</a><br><strong>GitHub</strong>ï¼š<a target="_blank" rel="noopener" href="https://github.com/langchain-ai/langchain">https://github.com/langchain-ai/langchain</a></p>
<p>LangChainæ˜¯ç›®å‰æœ€å—æ¬¢è¿çš„AIåº”ç”¨å¼€å‘æ¡†æ¶ï¼Œæä¾›äº†æ„å»ºå¤æ‚AIåº”ç”¨æ‰€éœ€çš„å…¨å¥—å·¥å…·ã€‚</p>
<h3 id="ğŸ”§-æ ¸å¿ƒæ¦‚å¿µ"><a href="#ğŸ”§-æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="ğŸ”§ æ ¸å¿ƒæ¦‚å¿µ"></a>ğŸ”§ æ ¸å¿ƒæ¦‚å¿µ</h3><h4 id="1-ç»„ä»¶æ¶æ„"><a href="#1-ç»„ä»¶æ¶æ„" class="headerlink" title="1. ç»„ä»¶æ¶æ„"></a>1. ç»„ä»¶æ¶æ„</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># LangChainæ ¸å¿ƒç»„ä»¶</span></span><br><span class="line">components = &#123;</span><br><span class="line">    <span class="string">&quot;Models&quot;</span>: <span class="string">&quot;è¯­è¨€æ¨¡å‹æŠ½è±¡å±‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Prompts&quot;</span>: <span class="string">&quot;æç¤ºè¯æ¨¡æ¿ç®¡ç†&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Chains&quot;</span>: <span class="string">&quot;ç»„ä»¶é“¾å¼ç»„åˆ&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Agents&quot;</span>: <span class="string">&quot;æ™ºèƒ½å†³ç­–ä»£ç†&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Memory&quot;</span>: <span class="string">&quot;å¯¹è¯è®°å¿†ç®¡ç†&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Retrievers&quot;</span>: <span class="string">&quot;ä¿¡æ¯æ£€ç´¢ç»„ä»¶&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Tools&quot;</span>: <span class="string">&quot;å¤–éƒ¨å·¥å…·é›†æˆ&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Callbacks&quot;</span>: <span class="string">&quot;æ‰§è¡Œè¿‡ç¨‹ç›‘æ§&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-è®¾è®¡å“²å­¦"><a href="#2-è®¾è®¡å“²å­¦" class="headerlink" title="2. è®¾è®¡å“²å­¦"></a>2. è®¾è®¡å“²å­¦</h4><ul>
<li><strong>æ¨¡å—åŒ–</strong>ï¼šæ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥ç‹¬ç«‹ä½¿ç”¨å’Œæ›¿æ¢</li>
<li><strong>å¯ç»„åˆ</strong>ï¼šé€šè¿‡é“¾å¼è°ƒç”¨æ„å»ºå¤æ‚åº”ç”¨</li>
<li><strong>å¯æ‰©å±•</strong>ï¼šæ”¯æŒè‡ªå®šä¹‰ç»„ä»¶å’Œå·¥å…·</li>
<li><strong>å¯è§‚æµ‹</strong>ï¼šå®Œæ•´çš„æ‰§è¡Œè¿‡ç¨‹è¿½è¸ª</li>
</ul>
<h3 id="ğŸš€-å®‰è£…å’Œé…ç½®"><a href="#ğŸš€-å®‰è£…å’Œé…ç½®" class="headerlink" title="ğŸš€ å®‰è£…å’Œé…ç½®"></a>ğŸš€ å®‰è£…å’Œé…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…æ ¸å¿ƒåŒ…</span></span><br><span class="line">pip install langchain</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…ç¤¾åŒºåŒ…ï¼ˆæ›´å¤šé›†æˆï¼‰</span></span><br><span class="line">pip install langchain-community</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…å®éªŒæ€§åŠŸèƒ½</span></span><br><span class="line">pip install langchain-experimental</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…ç‰¹å®šé›†æˆ</span></span><br><span class="line">pip install langchain-openai</span><br><span class="line">pip install langchain-anthropic</span><br><span class="line">pip install langchain-google-genai</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…å‘é‡æ•°æ®åº“æ”¯æŒ</span></span><br><span class="line">pip install chromadb</span><br><span class="line">pip install pinecone-client</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…å…¶ä»–ä¾èµ–</span></span><br><span class="line">pip install tiktoken</span><br><span class="line">pip install faiss-cpu</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ“-åŸºç¡€ä½¿ç”¨ç¤ºä¾‹"><a href="#ğŸ“-åŸºç¡€ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ğŸ“ åŸºç¡€ä½¿ç”¨ç¤ºä¾‹"></a>ğŸ“ åŸºç¡€ä½¿ç”¨ç¤ºä¾‹</h3><h4 id="1-ç®€å•çš„LLMè°ƒç”¨"><a href="#1-ç®€å•çš„LLMè°ƒç”¨" class="headerlink" title="1. ç®€å•çš„LLMè°ƒç”¨"></a>1. ç®€å•çš„LLMè°ƒç”¨</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> langchain.schema <span class="keyword">import</span> HumanMessage, SystemMessage</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–æ¨¡å‹</span></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">    model=<span class="string">&quot;gpt-4-turbo&quot;</span>,</span><br><span class="line">    temperature=<span class="number">0.7</span>,</span><br><span class="line">    api_key=<span class="string">&quot;your-api-key&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºæ¶ˆæ¯</span></span><br><span class="line">messages = [</span><br><span class="line">    SystemMessage(content=<span class="string">&quot;ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„Pythonç¼–ç¨‹åŠ©æ‰‹ã€‚&quot;</span>),</span><br><span class="line">    HumanMessage(content=<span class="string">&quot;å¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„è£…é¥°å™¨ï¼Ÿ&quot;</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å›å¤</span></span><br><span class="line">response = llm.invoke(messages)</span><br><span class="line"><span class="built_in">print</span>(response.content)</span><br></pre></td></tr></table></figure>

<h4 id="2-æç¤ºè¯æ¨¡æ¿"><a href="#2-æç¤ºè¯æ¨¡æ¿" class="headerlink" title="2. æç¤ºè¯æ¨¡æ¿"></a>2. æç¤ºè¯æ¨¡æ¿</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.prompts <span class="keyword">import</span> ChatPromptTemplate, PromptTemplate</span><br><span class="line"><span class="keyword">from</span> langchain.prompts.few_shot <span class="keyword">import</span> FewShotPromptTemplate</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºç¡€æç¤ºè¯æ¨¡æ¿</span></span><br><span class="line">prompt = ChatPromptTemplate.from_messages([</span><br><span class="line">    (<span class="string">&quot;system&quot;</span>, <span class="string">&quot;ä½ æ˜¯ä¸€ä¸ª&#123;role&#125;ï¼Œä¸“é—¨å¸®åŠ©ç”¨æˆ·&#123;task&#125;ã€‚&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;human&quot;</span>, <span class="string">&quot;è¯·å¸®æˆ‘&#123;request&#125;&quot;</span>)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¼å¼åŒ–æç¤ºè¯</span></span><br><span class="line">formatted_prompt = prompt.format_messages(</span><br><span class="line">    role=<span class="string">&quot;æ•°æ®åˆ†æå¸ˆ&quot;</span>,</span><br><span class="line">    task=<span class="string">&quot;åˆ†ææ•°æ®å’Œç”ŸæˆæŠ¥å‘Š&quot;</span>,</span><br><span class="line">    request=<span class="string">&quot;åˆ†æè¿™ä¸ªé”€å”®æ•°æ®çš„è¶‹åŠ¿&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(formatted_prompt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Few-shotæç¤ºè¯</span></span><br><span class="line">examples = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;question&quot;</span>: <span class="string">&quot;ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ&quot;</span>,</span><br><span class="line">        <span class="string">&quot;answer&quot;</span>: <span class="string">&quot;æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œé€šè¿‡ç®—æ³•è®©è®¡ç®—æœºä»æ•°æ®ä¸­å­¦ä¹ æ¨¡å¼ã€‚&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;question&quot;</span>: <span class="string">&quot;ä»€ä¹ˆæ˜¯æ·±åº¦å­¦ä¹ ï¼Ÿ&quot;</span>,</span><br><span class="line">        <span class="string">&quot;answer&quot;</span>: <span class="string">&quot;æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„å­é›†ï¼Œä½¿ç”¨å¤šå±‚ç¥ç»ç½‘ç»œæ¥å¤„ç†å¤æ‚æ•°æ®ã€‚&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">example_prompt = PromptTemplate(</span><br><span class="line">    input_variables=[<span class="string">&quot;question&quot;</span>, <span class="string">&quot;answer&quot;</span>],</span><br><span class="line">    template=<span class="string">&quot;é—®é¢˜: &#123;question&#125;\nç­”æ¡ˆ: &#123;answer&#125;&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">few_shot_prompt = FewShotPromptTemplate(</span><br><span class="line">    examples=examples,</span><br><span class="line">    example_prompt=example_prompt,</span><br><span class="line">    prefix=<span class="string">&quot;ä»¥ä¸‹æ˜¯ä¸€äº›é—®ç­”ç¤ºä¾‹ï¼š&quot;</span>,</span><br><span class="line">    suffix=<span class="string">&quot;é—®é¢˜: &#123;input&#125;\nç­”æ¡ˆ:&quot;</span>,</span><br><span class="line">    input_variables=[<span class="string">&quot;input&quot;</span>]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(few_shot_prompt.<span class="built_in">format</span>(<span class="built_in">input</span>=<span class="string">&quot;ä»€ä¹ˆæ˜¯è‡ªç„¶è¯­è¨€å¤„ç†ï¼Ÿ&quot;</span>))</span><br></pre></td></tr></table></figure>

<h4 id="3-é“¾å¼ç»„åˆ"><a href="#3-é“¾å¼ç»„åˆ" class="headerlink" title="3. é“¾å¼ç»„åˆ"></a>3. é“¾å¼ç»„åˆ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> LLMChain, SimpleSequentialChain</span><br><span class="line"><span class="keyword">from</span> langchain.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ªé“¾ï¼šç”Ÿæˆæ•…äº‹å¤§çº²</span></span><br><span class="line">outline_prompt = PromptTemplate(</span><br><span class="line">    input_variables=[<span class="string">&quot;topic&quot;</span>],</span><br><span class="line">    template=<span class="string">&quot;ä¸ºä»¥ä¸‹ä¸»é¢˜åˆ›å»ºä¸€ä¸ªæ•…äº‹å¤§çº²ï¼š&#123;topic&#125;&quot;</span></span><br><span class="line">)</span><br><span class="line">outline_chain = LLMChain(llm=llm, prompt=outline_prompt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬äºŒä¸ªé“¾ï¼šæ‰©å±•æ•…äº‹</span></span><br><span class="line">story_prompt = PromptTemplate(</span><br><span class="line">    input_variables=[<span class="string">&quot;outline&quot;</span>],</span><br><span class="line">    template=<span class="string">&quot;åŸºäºä»¥ä¸‹å¤§çº²å†™ä¸€ä¸ªå®Œæ•´çš„çŸ­æ•…äº‹ï¼š&#123;outline&#125;&quot;</span></span><br><span class="line">)</span><br><span class="line">story_chain = LLMChain(llm=llm, prompt=story_prompt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»„åˆé“¾</span></span><br><span class="line">full_chain = SimpleSequentialChain(</span><br><span class="line">    chains=[outline_chain, story_chain],</span><br><span class="line">    verbose=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œé“¾</span></span><br><span class="line">result = full_chain.run(<span class="string">&quot;ä¸€ä¸ªå…³äºAIå’Œäººç±»å‹è°Šçš„ç§‘å¹»æ•…äº‹&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ¤–-Agentå¼€å‘"><a href="#ğŸ¤–-Agentå¼€å‘" class="headerlink" title="ğŸ¤– Agentå¼€å‘"></a>ğŸ¤– Agentå¼€å‘</h3><h4 id="1-åŸºç¡€Agent"><a href="#1-åŸºç¡€Agent" class="headerlink" title="1. åŸºç¡€Agent"></a>1. åŸºç¡€Agent</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> create_openai_tools_agent, AgentExecutor</span><br><span class="line"><span class="keyword">from</span> langchain.tools <span class="keyword">import</span> Tool</span><br><span class="line"><span class="keyword">from</span> langchain_community.tools <span class="keyword">import</span> DuckDuckGoSearchRun</span><br><span class="line"><span class="keyword">from</span> langchain.prompts <span class="keyword">import</span> ChatPromptTemplate</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰è‡ªå®šä¹‰å·¥å…·</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_weather</span>(<span class="params">city: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># è¿™é‡Œåº”è¯¥è°ƒç”¨çœŸå®çš„å¤©æ°”API</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;city&#125;</span>ä»Šå¤©å¤©æ°”æ™´æœ—ï¼Œæ¸©åº¦25Â°C&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate</span>(<span class="params">expression: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è®¡ç®—æ•°å­¦è¡¨è¾¾å¼&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = <span class="built_in">eval</span>(expression)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;è®¡ç®—ç»“æœ: <span class="subst">&#123;result&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;è®¡ç®—é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¡¨è¾¾å¼&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå·¥å…·åˆ—è¡¨</span></span><br><span class="line">tools = [</span><br><span class="line">    Tool(</span><br><span class="line">        name=<span class="string">&quot;æœç´¢&quot;</span>,</span><br><span class="line">        func=DuckDuckGoSearchRun().run,</span><br><span class="line">        description=<span class="string">&quot;ç”¨äºæœç´¢æœ€æ–°ä¿¡æ¯å’Œå›ç­”é—®é¢˜&quot;</span></span><br><span class="line">    ),</span><br><span class="line">    Tool(</span><br><span class="line">        name=<span class="string">&quot;å¤©æ°”æŸ¥è¯¢&quot;</span>,</span><br><span class="line">        func=get_weather,</span><br><span class="line">        description=<span class="string">&quot;æŸ¥è¯¢æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯ï¼Œè¾“å…¥åŸå¸‚åç§°&quot;</span></span><br><span class="line">    ),</span><br><span class="line">    Tool(</span><br><span class="line">        name=<span class="string">&quot;è®¡ç®—å™¨&quot;</span>,</span><br><span class="line">        func=calculate,</span><br><span class="line">        description=<span class="string">&quot;è®¡ç®—æ•°å­¦è¡¨è¾¾å¼ï¼Œè¾“å…¥è¦è®¡ç®—çš„è¡¨è¾¾å¼&quot;</span></span><br><span class="line">    )</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºAgentæç¤ºè¯</span></span><br><span class="line">prompt = ChatPromptTemplate.from_messages([</span><br><span class="line">    (<span class="string">&quot;system&quot;</span>, <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„AIåŠ©æ‰‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·æ¥å¸®åŠ©ç”¨æˆ·ï¼š</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    &#123;tools&#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Question: ç”¨æˆ·çš„é—®é¢˜</span></span><br><span class="line"><span class="string">    Thought: ä½ åº”è¯¥æ€è€ƒè¦åšä»€ä¹ˆ</span></span><br><span class="line"><span class="string">    Action: è¦ä½¿ç”¨çš„å·¥å…·åç§°</span></span><br><span class="line"><span class="string">    Action Input: å·¥å…·çš„è¾“å…¥</span></span><br><span class="line"><span class="string">    Observation: å·¥å…·çš„è¾“å‡º</span></span><br><span class="line"><span class="string">    ... (è¿™ä¸ªæ€è€ƒ/è¡ŒåŠ¨/è§‚å¯Ÿçš„è¿‡ç¨‹å¯ä»¥é‡å¤Næ¬¡)</span></span><br><span class="line"><span class="string">    Thought: æˆ‘ç°åœ¨çŸ¥é“æœ€ç»ˆç­”æ¡ˆäº†</span></span><br><span class="line"><span class="string">    Final Answer: å¯¹åŸå§‹é—®é¢˜çš„æœ€ç»ˆç­”æ¡ˆ</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;human&quot;</span>, <span class="string">&quot;&#123;input&#125;&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;&#123;agent_scratchpad&#125;&quot;</span>)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºAgent</span></span><br><span class="line">agent = create_openai_tools_agent(llm, tools, prompt)</span><br><span class="line">agent_executor = AgentExecutor(agent=agent, tools=tools, verbose=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨Agent</span></span><br><span class="line">result = agent_executor.invoke(&#123;</span><br><span class="line">    <span class="string">&quot;input&quot;</span>: <span class="string">&quot;åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿå¦å¤–å¸®æˆ‘è®¡ç®—ä¸€ä¸‹ 25 * 4 + 10 ç­‰äºå¤šå°‘ï¼Ÿ&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result[<span class="string">&quot;output&quot;</span>])</span><br></pre></td></tr></table></figure>

<h4 id="2-é«˜çº§Agentï¼šReActæ¨¡å¼"><a href="#2-é«˜çº§Agentï¼šReActæ¨¡å¼" class="headerlink" title="2. é«˜çº§Agentï¼šReActæ¨¡å¼"></a>2. é«˜çº§Agentï¼šReActæ¨¡å¼</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> create_react_agent</span><br><span class="line"><span class="keyword">from</span> langchain <span class="keyword">import</span> hub</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨é¢„å®šä¹‰çš„ReActæç¤ºè¯</span></span><br><span class="line">react_prompt = hub.pull(<span class="string">&quot;hwchase17/react&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºReAct Agent</span></span><br><span class="line">react_agent = create_react_agent(llm, tools, react_prompt)</span><br><span class="line">react_executor = AgentExecutor(</span><br><span class="line">    agent=react_agent, </span><br><span class="line">    tools=tools, </span><br><span class="line">    verbose=<span class="literal">True</span>,</span><br><span class="line">    max_iterations=<span class="number">5</span>,</span><br><span class="line">    early_stopping_method=<span class="string">&quot;generate&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤æ‚ä»»åŠ¡æ‰§è¡Œ</span></span><br><span class="line">complex_task = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">è¯·å¸®æˆ‘å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š</span></span><br><span class="line"><span class="string">1. æœç´¢æœ€æ–°çš„AIæŠ€æœ¯è¶‹åŠ¿</span></span><br><span class="line"><span class="string">2. æŸ¥è¯¢ä¸Šæµ·çš„å¤©æ°”æƒ…å†µ</span></span><br><span class="line"><span class="string">3. è®¡ç®—å¦‚æœæˆ‘æ¯å¤©å­¦ä¹ 2å°æ—¶ï¼Œä¸€å¹´èƒ½å­¦ä¹ å¤šå°‘å°æ—¶</span></span><br><span class="line"><span class="string">4. åŸºäºä»¥ä¸Šä¿¡æ¯ï¼Œç»™æˆ‘ä¸€ä¸ªå­¦ä¹ AIçš„å»ºè®®</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">result = react_executor.invoke(&#123;<span class="string">&quot;input&quot;</span>: complex_task&#125;)</span><br><span class="line"><span class="built_in">print</span>(result[<span class="string">&quot;output&quot;</span>])</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ’¾-è®°å¿†ç®¡ç†"><a href="#ğŸ’¾-è®°å¿†ç®¡ç†" class="headerlink" title="ğŸ’¾ è®°å¿†ç®¡ç†"></a>ğŸ’¾ è®°å¿†ç®¡ç†</h3><h4 id="1-å¯¹è¯è®°å¿†"><a href="#1-å¯¹è¯è®°å¿†" class="headerlink" title="1. å¯¹è¯è®°å¿†"></a>1. å¯¹è¯è®°å¿†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.memory <span class="keyword">import</span> ConversationBufferMemory, ConversationSummaryMemory</span><br><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> ConversationChain</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼“å†²è®°å¿†ï¼ˆä¿å­˜å®Œæ•´å¯¹è¯å†å²ï¼‰</span></span><br><span class="line">buffer_memory = ConversationBufferMemory()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‘˜è¦è®°å¿†ï¼ˆå‹ç¼©å†å²å¯¹è¯ï¼‰</span></span><br><span class="line">summary_memory = ConversationSummaryMemory(llm=llm)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå¯¹è¯é“¾</span></span><br><span class="line">conversation = ConversationChain(</span><br><span class="line">    llm=llm,</span><br><span class="line">    memory=buffer_memory,</span><br><span class="line">    verbose=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤šè½®å¯¹è¯</span></span><br><span class="line"><span class="built_in">print</span>(conversation.predict(<span class="built_in">input</span>=<span class="string">&quot;ä½ å¥½ï¼Œæˆ‘å«å¼ ä¸‰&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(conversation.predict(<span class="built_in">input</span>=<span class="string">&quot;æˆ‘å–œæ¬¢ç¼–ç¨‹&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(conversation.predict(<span class="built_in">input</span>=<span class="string">&quot;ä½ è¿˜è®°å¾—æˆ‘çš„åå­—å—ï¼Ÿ&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è®°å¿†å†…å®¹</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nè®°å¿†å†…å®¹:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(buffer_memory.buffer)</span><br></pre></td></tr></table></figure>

<h4 id="2-å‘é‡è®°å¿†"><a href="#2-å‘é‡è®°å¿†" class="headerlink" title="2. å‘é‡è®°å¿†"></a>2. å‘é‡è®°å¿†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.memory <span class="keyword">import</span> VectorStoreRetrieverMemory</span><br><span class="line"><span class="keyword">from</span> langchain.vectorstores <span class="keyword">import</span> Chroma</span><br><span class="line"><span class="keyword">from</span> langchain.embeddings <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå‘é‡å­˜å‚¨</span></span><br><span class="line">embeddings = OpenAIEmbeddings()</span><br><span class="line">vectorstore = Chroma(embedding_function=embeddings)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå‘é‡è®°å¿†</span></span><br><span class="line">vector_memory = VectorStoreRetrieverMemory(</span><br><span class="line">    retriever=vectorstore.as_retriever(search_kwargs=&#123;<span class="string">&quot;k&quot;</span>: <span class="number">3</span>&#125;)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿å­˜è®°å¿†</span></span><br><span class="line">vector_memory.save_context(</span><br><span class="line">    &#123;<span class="string">&quot;input&quot;</span>: <span class="string">&quot;æˆ‘æœ€å–œæ¬¢çš„ç¼–ç¨‹è¯­è¨€æ˜¯Python&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;output&quot;</span>: <span class="string">&quot;å¾ˆå¥½ï¼Pythonæ˜¯ä¸€é—¨ä¼˜ç§€çš„ç¼–ç¨‹è¯­è¨€ã€‚&quot;</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">vector_memory.save_context(</span><br><span class="line">    &#123;<span class="string">&quot;input&quot;</span>: <span class="string">&quot;æˆ‘åœ¨å­¦ä¹ æœºå™¨å­¦ä¹ &quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;output&quot;</span>: <span class="string">&quot;æœºå™¨å­¦ä¹ æ˜¯ä¸€ä¸ªå¾ˆæœ‰å‰æ™¯çš„é¢†åŸŸã€‚&quot;</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€ç´¢ç›¸å…³è®°å¿†</span></span><br><span class="line">relevant_memories = vector_memory.load_memory_variables(</span><br><span class="line">    &#123;<span class="string">&quot;prompt&quot;</span>: <span class="string">&quot;ç¼–ç¨‹è¯­è¨€&quot;</span>&#125;</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(relevant_memories)</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ”-RAGç³»ç»Ÿæ„å»º"><a href="#ğŸ”-RAGç³»ç»Ÿæ„å»º" class="headerlink" title="ğŸ” RAGç³»ç»Ÿæ„å»º"></a>ğŸ” RAGç³»ç»Ÿæ„å»º</h3><h4 id="1-åŸºç¡€RAGå®ç°"><a href="#1-åŸºç¡€RAGå®ç°" class="headerlink" title="1. åŸºç¡€RAGå®ç°"></a>1. åŸºç¡€RAGå®ç°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.document_loaders <span class="keyword">import</span> TextLoader, PyPDFLoader</span><br><span class="line"><span class="keyword">from</span> langchain.text_splitter <span class="keyword">import</span> RecursiveCharacterTextSplitter</span><br><span class="line"><span class="keyword">from</span> langchain.vectorstores <span class="keyword">import</span> Chroma</span><br><span class="line"><span class="keyword">from</span> langchain.embeddings <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> RetrievalQA</span><br><span class="line"><span class="keyword">from</span> langchain.retrievers <span class="keyword">import</span> ContextualCompressionRetriever</span><br><span class="line"><span class="keyword">from</span> langchain.retrievers.document_compressors <span class="keyword">import</span> LLMChainExtractor</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. åŠ è½½æ–‡æ¡£</span></span><br><span class="line">loader = TextLoader(<span class="string">&quot;knowledge_base.txt&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">documents = loader.load()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æ–‡æ¡£åˆ†å‰²</span></span><br><span class="line">text_splitter = RecursiveCharacterTextSplitter(</span><br><span class="line">    chunk_size=<span class="number">1000</span>,</span><br><span class="line">    chunk_overlap=<span class="number">200</span>,</span><br><span class="line">    length_function=<span class="built_in">len</span></span><br><span class="line">)</span><br><span class="line">splits = text_splitter.split_documents(documents)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. åˆ›å»ºå‘é‡å­˜å‚¨</span></span><br><span class="line">embeddings = OpenAIEmbeddings()</span><br><span class="line">vectorstore = Chroma.from_documents(</span><br><span class="line">    documents=splits,</span><br><span class="line">    embedding=embeddings,</span><br><span class="line">    persist_directory=<span class="string">&quot;./chroma_db&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. åˆ›å»ºæ£€ç´¢å™¨</span></span><br><span class="line">retriever = vectorstore.as_retriever(</span><br><span class="line">    search_type=<span class="string">&quot;similarity&quot;</span>,</span><br><span class="line">    search_kwargs=&#123;<span class="string">&quot;k&quot;</span>: <span class="number">4</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. æ·»åŠ å‹ç¼©æ£€ç´¢ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line">compressor = LLMChainExtractor.from_llm(llm)</span><br><span class="line">compression_retriever = ContextualCompressionRetriever(</span><br><span class="line">    base_compressor=compressor,</span><br><span class="line">    base_retriever=retriever</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. åˆ›å»ºQAé“¾</span></span><br><span class="line">qa_chain = RetrievalQA.from_chain_type(</span><br><span class="line">    llm=llm,</span><br><span class="line">    chain_type=<span class="string">&quot;stuff&quot;</span>,</span><br><span class="line">    retriever=compression_retriever,</span><br><span class="line">    return_source_documents=<span class="literal">True</span>,</span><br><span class="line">    verbose=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. æŸ¥è¯¢</span></span><br><span class="line">query = <span class="string">&quot;ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ&quot;</span></span><br><span class="line">result = qa_chain(&#123;<span class="string">&quot;query&quot;</span>: query&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;é—®é¢˜: <span class="subst">&#123;query&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ç­”æ¡ˆ: <span class="subst">&#123;result[<span class="string">&#x27;result&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;\næ¥æºæ–‡æ¡£:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(result[<span class="string">&#x27;source_documents&#x27;</span>]):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ–‡æ¡£ <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>: <span class="subst">&#123;doc.page_content[:<span class="number">200</span>]&#125;</span>...&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="2-é«˜çº§RAGï¼šå¤šæ¨¡æ€æ£€ç´¢"><a href="#2-é«˜çº§RAGï¼šå¤šæ¨¡æ€æ£€ç´¢" class="headerlink" title="2. é«˜çº§RAGï¼šå¤šæ¨¡æ€æ£€ç´¢"></a>2. é«˜çº§RAGï¼šå¤šæ¨¡æ€æ£€ç´¢</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.schema <span class="keyword">import</span> Document</span><br><span class="line"><span class="keyword">from</span> langchain.retrievers <span class="keyword">import</span> EnsembleRetriever</span><br><span class="line"><span class="keyword">from</span> langchain.retrievers <span class="keyword">import</span> BM25Retriever</span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸­æ–‡åˆ†è¯å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chinese_tokenizer</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(jieba.cut(text))</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºBM25æ£€ç´¢å™¨ï¼ˆå…³é”®è¯æ£€ç´¢ï¼‰</span></span><br><span class="line">bm25_retriever = BM25Retriever.from_documents(</span><br><span class="line">    splits,</span><br><span class="line">    preprocess_func=chinese_tokenizer</span><br><span class="line">)</span><br><span class="line">bm25_retriever.k = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ··åˆæ£€ç´¢å™¨</span></span><br><span class="line">ensemble_retriever = EnsembleRetriever(</span><br><span class="line">    retrievers=[vectorstore.as_retriever(), bm25_retriever],</span><br><span class="line">    weights=[<span class="number">0.7</span>, <span class="number">0.3</span>]  <span class="comment"># å‘é‡æ£€ç´¢æƒé‡0.7ï¼Œå…³é”®è¯æ£€ç´¢æƒé‡0.3</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ··åˆæ£€ç´¢å™¨</span></span><br><span class="line">hybrid_qa_chain = RetrievalQA.from_chain_type(</span><br><span class="line">    llm=llm,</span><br><span class="line">    chain_type=<span class="string">&quot;stuff&quot;</span>,</span><br><span class="line">    retriever=ensemble_retriever,</span><br><span class="line">    return_source_documents=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">result = hybrid_qa_chain(&#123;<span class="string">&quot;query&quot;</span>: <span class="string">&quot;æ·±åº¦å­¦ä¹ çš„åº”ç”¨é¢†åŸŸ&quot;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(result[<span class="string">&#x27;result&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ”§-è‡ªå®šä¹‰ç»„ä»¶"><a href="#ğŸ”§-è‡ªå®šä¹‰ç»„ä»¶" class="headerlink" title="ğŸ”§ è‡ªå®šä¹‰ç»„ä»¶"></a>ğŸ”§ è‡ªå®šä¹‰ç»„ä»¶</h3><h4 id="1-è‡ªå®šä¹‰LLM"><a href="#1-è‡ªå®šä¹‰LLM" class="headerlink" title="1. è‡ªå®šä¹‰LLM"></a>1. è‡ªå®šä¹‰LLM</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.llms.base <span class="keyword">import</span> LLM</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span>, <span class="type">List</span>, <span class="type">Any</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomLLM</span>(<span class="title class_ inherited__">LLM</span>):</span><br><span class="line">    api_url: <span class="built_in">str</span></span><br><span class="line">    api_key: <span class="built_in">str</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_llm_type</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;custom&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_call</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        prompt: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        stop: <span class="type">Optional</span>[<span class="type">List</span>[<span class="built_in">str</span>]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        run_manager: <span class="type">Optional</span>[<span class="type">Any</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        **kwargs: <span class="type">Any</span>,</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="comment"># è‡ªå®šä¹‰APIè°ƒç”¨é€»è¾‘</span></span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">&quot;Authorization&quot;</span>: <span class="string">f&quot;Bearer <span class="subst">&#123;self.api_key&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;prompt&quot;</span>: prompt,</span><br><span class="line">            <span class="string">&quot;max_tokens&quot;</span>: kwargs.get(<span class="string">&quot;max_tokens&quot;</span>, <span class="number">100</span>),</span><br><span class="line">            <span class="string">&quot;temperature&quot;</span>: kwargs.get(<span class="string">&quot;temperature&quot;</span>, <span class="number">0.7</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        response = requests.post(<span class="variable language_">self</span>.api_url, headers=headers, json=data)</span><br><span class="line">        <span class="keyword">return</span> response.json().get(<span class="string">&quot;text&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_identifying_params</span>(<span class="params">self</span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;api_url&quot;</span>: <span class="variable language_">self</span>.api_url&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨è‡ªå®šä¹‰LLM</span></span><br><span class="line">custom_llm = CustomLLM(</span><br><span class="line">    api_url=<span class="string">&quot;https://your-api-endpoint.com/generate&quot;</span>,</span><br><span class="line">    api_key=<span class="string">&quot;your-api-key&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="2-è‡ªå®šä¹‰å·¥å…·"><a href="#2-è‡ªå®šä¹‰å·¥å…·" class="headerlink" title="2. è‡ªå®šä¹‰å·¥å…·"></a>2. è‡ªå®šä¹‰å·¥å…·</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.tools <span class="keyword">import</span> BaseTool</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span>, <span class="type">Type</span></span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WeatherInput</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    city: <span class="built_in">str</span> = Field(description=<span class="string">&quot;åŸå¸‚åç§°&quot;</span>)</span><br><span class="line">    date: <span class="type">Optional</span>[<span class="built_in">str</span>] = Field(description=<span class="string">&quot;æ—¥æœŸï¼Œæ ¼å¼ï¼šYYYY-MM-DD&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WeatherTool</span>(<span class="title class_ inherited__">BaseTool</span>):</span><br><span class="line">    name = <span class="string">&quot;weather_query&quot;</span></span><br><span class="line">    description = <span class="string">&quot;æŸ¥è¯¢æŒ‡å®šåŸå¸‚å’Œæ—¥æœŸçš„å¤©æ°”ä¿¡æ¯&quot;</span></span><br><span class="line">    args_schema: <span class="type">Type</span>[BaseModel] = WeatherInput</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_run</span>(<span class="params">self, city: <span class="built_in">str</span>, date: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="comment"># å®é™…çš„å¤©æ°”æŸ¥è¯¢é€»è¾‘</span></span><br><span class="line">        <span class="keyword">if</span> date:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;city&#125;</span>åœ¨<span class="subst">&#123;date&#125;</span>çš„å¤©æ°”ï¼šæ™´æœ—ï¼Œæ¸©åº¦20-25Â°C&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;city&#125;</span>ä»Šå¤©å¤©æ°”ï¼šæ™´æœ—ï¼Œæ¸©åº¦20-25Â°C&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">_arun</span>(<span class="params">self, city: <span class="built_in">str</span>, date: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="comment"># å¼‚æ­¥ç‰ˆæœ¬</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._run(city, date)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨è‡ªå®šä¹‰å·¥å…·</span></span><br><span class="line">weather_tool = WeatherTool()</span><br><span class="line">result = weather_tool.run(&#123;<span class="string">&quot;city&quot;</span>: <span class="string">&quot;åŒ—äº¬&quot;</span>, <span class="string">&quot;date&quot;</span>: <span class="string">&quot;2024-01-15&quot;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ¦™-LlamaIndexï¼šä¸“ä¸šçš„RAGå¼€å‘æ¡†æ¶"><a href="#ğŸ¦™-LlamaIndexï¼šä¸“ä¸šçš„RAGå¼€å‘æ¡†æ¶" class="headerlink" title="ğŸ¦™ LlamaIndexï¼šä¸“ä¸šçš„RAGå¼€å‘æ¡†æ¶"></a>ğŸ¦™ LlamaIndexï¼šä¸“ä¸šçš„RAGå¼€å‘æ¡†æ¶</h2><p><strong>å®˜æ–¹ç½‘ç«™</strong>ï¼š<a target="_blank" rel="noopener" href="https://llamaindex.ai/">https://llamaindex.ai</a><br><strong>GitHub</strong>ï¼š<a target="_blank" rel="noopener" href="https://github.com/run-llama/llama_index">https://github.com/run-llama/llama_index</a></p>
<p>LlamaIndexä¸“æ³¨äºæ•°æ®ç´¢å¼•å’Œæ£€ç´¢ï¼Œæ˜¯æ„å»ºRAGåº”ç”¨çš„æœ€ä½³é€‰æ‹©ã€‚</p>
<h3 id="ğŸ¯-æ ¸å¿ƒä¼˜åŠ¿"><a href="#ğŸ¯-æ ¸å¿ƒä¼˜åŠ¿" class="headerlink" title="ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿"></a>ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿</h3><ul>
<li><strong>æ•°æ®è¿æ¥å™¨</strong>ï¼šæ”¯æŒ100+ç§æ•°æ®æº</li>
<li><strong>ç´¢å¼•ç»“æ„</strong>ï¼šå¤šç§é«˜æ•ˆçš„ç´¢å¼•ç®—æ³•</li>
<li><strong>æŸ¥è¯¢å¼•æ“</strong>ï¼šæ™ºèƒ½çš„æŸ¥è¯¢å¤„ç†</li>
<li><strong>è¯„ä¼°å·¥å…·</strong>ï¼šå®Œæ•´çš„RAGè¯„ä¼°ä½“ç³»</li>
</ul>
<h3 id="ğŸš€-å¿«é€Ÿå¼€å§‹"><a href="#ğŸš€-å¿«é€Ÿå¼€å§‹" class="headerlink" title="ğŸš€ å¿«é€Ÿå¼€å§‹"></a>ğŸš€ å¿«é€Ÿå¼€å§‹</h3><h4 id="1-å®‰è£…å’Œé…ç½®"><a href="#1-å®‰è£…å’Œé…ç½®" class="headerlink" title="1. å®‰è£…å’Œé…ç½®"></a>1. å®‰è£…å’Œé…ç½®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…æ ¸å¿ƒåŒ…</span></span><br><span class="line">pip install llama-index</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…ç‰¹å®šé›†æˆ</span></span><br><span class="line">pip install llama-index-llms-openai</span><br><span class="line">pip install llama-index-embeddings-openai</span><br><span class="line">pip install llama-index-vector-stores-chroma</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æ•°æ®åŠ è½½å™¨</span></span><br><span class="line">pip install llama-index-readers-file</span><br><span class="line">pip install llama-index-readers-web</span><br></pre></td></tr></table></figure>

<h4 id="2-åŸºç¡€ä½¿ç”¨"><a href="#2-åŸºç¡€ä½¿ç”¨" class="headerlink" title="2. åŸºç¡€ä½¿ç”¨"></a>2. åŸºç¡€ä½¿ç”¨</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> VectorStoreIndex, SimpleDirectoryReader</span><br><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> Settings</span><br><span class="line"><span class="keyword">from</span> llama_index.llms.openai <span class="keyword">import</span> OpenAI</span><br><span class="line"><span class="keyword">from</span> llama_index.embeddings.openai <span class="keyword">import</span> OpenAIEmbedding</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®å…¨å±€è®¾ç½®</span></span><br><span class="line">Settings.llm = OpenAI(model=<span class="string">&quot;gpt-4-turbo&quot;</span>, api_key=<span class="string">&quot;your-api-key&quot;</span>)</span><br><span class="line">Settings.embed_model = OpenAIEmbedding(api_key=<span class="string">&quot;your-api-key&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½æ–‡æ¡£</span></span><br><span class="line">documents = SimpleDirectoryReader(<span class="string">&quot;./data&quot;</span>).load_data()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºç´¢å¼•</span></span><br><span class="line">index = VectorStoreIndex.from_documents(documents)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæŸ¥è¯¢å¼•æ“</span></span><br><span class="line">query_engine = index.as_query_engine()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢</span></span><br><span class="line">response = query_engine.query(<span class="string">&quot;ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ“Š-é«˜çº§ç´¢å¼•ç»“æ„"><a href="#ğŸ“Š-é«˜çº§ç´¢å¼•ç»“æ„" class="headerlink" title="ğŸ“Š é«˜çº§ç´¢å¼•ç»“æ„"></a>ğŸ“Š é«˜çº§ç´¢å¼•ç»“æ„</h3><h4 id="1-å±‚æ¬¡ç´¢å¼•"><a href="#1-å±‚æ¬¡ç´¢å¼•" class="headerlink" title="1. å±‚æ¬¡ç´¢å¼•"></a>1. å±‚æ¬¡ç´¢å¼•</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> TreeIndex</span><br><span class="line"><span class="keyword">from</span> llama_index.core.node_parser <span class="keyword">import</span> SentenceSplitter</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºèŠ‚ç‚¹è§£æå™¨</span></span><br><span class="line">node_parser = SentenceSplitter(</span><br><span class="line">    chunk_size=<span class="number">1024</span>,</span><br><span class="line">    chunk_overlap=<span class="number">20</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£ææ–‡æ¡£ä¸ºèŠ‚ç‚¹</span></span><br><span class="line">nodes = node_parser.get_nodes_from_documents(documents)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ ‘å½¢ç´¢å¼•</span></span><br><span class="line">tree_index = TreeIndex(nodes)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæŸ¥è¯¢å¼•æ“</span></span><br><span class="line">tree_query_engine = tree_index.as_query_engine(</span><br><span class="line">    retriever_mode=<span class="string">&quot;select_leaf_embedding&quot;</span>,</span><br><span class="line">    response_mode=<span class="string">&quot;tree_summarize&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">response = tree_query_engine.query(<span class="string">&quot;æ€»ç»“æ–‡æ¡£çš„ä¸»è¦å†…å®¹&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure>

<h4 id="2-å…³é”®è¯ç´¢å¼•"><a href="#2-å…³é”®è¯ç´¢å¼•" class="headerlink" title="2. å…³é”®è¯ç´¢å¼•"></a>2. å…³é”®è¯ç´¢å¼•</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> KeywordTableIndex</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå…³é”®è¯ç´¢å¼•</span></span><br><span class="line">keyword_index = KeywordTableIndex.from_documents(documents)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢</span></span><br><span class="line">keyword_query_engine = keyword_index.as_query_engine()</span><br><span class="line">response = keyword_query_engine.query(<span class="string">&quot;æœºå™¨å­¦ä¹ ç®—æ³•&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure>

<h4 id="3-çŸ¥è¯†å›¾è°±ç´¢å¼•"><a href="#3-çŸ¥è¯†å›¾è°±ç´¢å¼•" class="headerlink" title="3. çŸ¥è¯†å›¾è°±ç´¢å¼•"></a>3. çŸ¥è¯†å›¾è°±ç´¢å¼•</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> KnowledgeGraphIndex</span><br><span class="line"><span class="keyword">from</span> llama_index.core.graph_stores <span class="keyword">import</span> SimpleGraphStore</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå›¾å­˜å‚¨</span></span><br><span class="line">graph_store = SimpleGraphStore()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºçŸ¥è¯†å›¾è°±ç´¢å¼•</span></span><br><span class="line">kg_index = KnowledgeGraphIndex.from_documents(</span><br><span class="line">    documents,</span><br><span class="line">    graph_store=graph_store,</span><br><span class="line">    max_triplets_per_chunk=<span class="number">2</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢</span></span><br><span class="line">kg_query_engine = kg_index.as_query_engine(</span><br><span class="line">    include_text=<span class="literal">True</span>,</span><br><span class="line">    response_mode=<span class="string">&quot;tree_summarize&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">response = kg_query_engine.query(<span class="string">&quot;äººå·¥æ™ºèƒ½å’Œæœºå™¨å­¦ä¹ çš„å…³ç³»&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ”-é«˜çº§æŸ¥è¯¢æŠ€æœ¯"><a href="#ğŸ”-é«˜çº§æŸ¥è¯¢æŠ€æœ¯" class="headerlink" title="ğŸ” é«˜çº§æŸ¥è¯¢æŠ€æœ¯"></a>ğŸ” é«˜çº§æŸ¥è¯¢æŠ€æœ¯</h3><h4 id="1-å¤šæ¨¡æ€æŸ¥è¯¢"><a href="#1-å¤šæ¨¡æ€æŸ¥è¯¢" class="headerlink" title="1. å¤šæ¨¡æ€æŸ¥è¯¢"></a>1. å¤šæ¨¡æ€æŸ¥è¯¢</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core.query_engine <span class="keyword">import</span> RouterQueryEngine</span><br><span class="line"><span class="keyword">from</span> llama_index.core.selectors <span class="keyword">import</span> LLMSingleSelector</span><br><span class="line"><span class="keyword">from</span> llama_index.core.tools <span class="keyword">import</span> QueryEngineTool</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå¤šä¸ªæŸ¥è¯¢å¼•æ“</span></span><br><span class="line">vector_tool = QueryEngineTool.from_defaults(</span><br><span class="line">    query_engine=query_engine,</span><br><span class="line">    description=<span class="string">&quot;ç”¨äºå›ç­”å…³äºæ–‡æ¡£å†…å®¹çš„å…·ä½“é—®é¢˜&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">tree_tool = QueryEngineTool.from_defaults(</span><br><span class="line">    query_engine=tree_query_engine,</span><br><span class="line">    description=<span class="string">&quot;ç”¨äºæ€»ç»“å’Œæ¦‚æ‹¬æ–‡æ¡£å†…å®¹&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">keyword_tool = QueryEngineTool.from_defaults(</span><br><span class="line">    query_engine=keyword_query_engine,</span><br><span class="line">    description=<span class="string">&quot;ç”¨äºåŸºäºå…³é”®è¯çš„ç²¾ç¡®æœç´¢&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè·¯ç”±æŸ¥è¯¢å¼•æ“</span></span><br><span class="line">router_query_engine = RouterQueryEngine(</span><br><span class="line">    selector=LLMSingleSelector.from_defaults(),</span><br><span class="line">    query_engine_tools=[</span><br><span class="line">        vector_tool,</span><br><span class="line">        tree_tool,</span><br><span class="line">        keyword_tool</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ™ºèƒ½è·¯ç”±æŸ¥è¯¢</span></span><br><span class="line">response = router_query_engine.query(<span class="string">&quot;è¯·æ€»ç»“äººå·¥æ™ºèƒ½çš„å‘å±•å†ç¨‹&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure>

<h4 id="2-å­é—®é¢˜æŸ¥è¯¢"><a href="#2-å­é—®é¢˜æŸ¥è¯¢" class="headerlink" title="2. å­é—®é¢˜æŸ¥è¯¢"></a>2. å­é—®é¢˜æŸ¥è¯¢</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core.query_engine <span class="keyword">import</span> SubQuestionQueryEngine</span><br><span class="line"><span class="keyword">from</span> llama_index.core.tools <span class="keyword">import</span> QueryEngineTool</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå­é—®é¢˜æŸ¥è¯¢å¼•æ“</span></span><br><span class="line">query_engine_tools = [</span><br><span class="line">    QueryEngineTool(</span><br><span class="line">        query_engine=query_engine,</span><br><span class="line">        metadata=&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;ai_docs&quot;</span>, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;AIç›¸å…³æ–‡æ¡£&quot;</span>&#125;</span><br><span class="line">    )</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">sub_question_engine = SubQuestionQueryEngine.from_defaults(</span><br><span class="line">    query_engine_tools=query_engine_tools</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤æ‚é—®é¢˜åˆ†è§£æŸ¥è¯¢</span></span><br><span class="line">complex_query = <span class="string">&quot;æ¯”è¾ƒç›‘ç£å­¦ä¹ å’Œæ— ç›‘ç£å­¦ä¹ çš„ä¼˜ç¼ºç‚¹ï¼Œå¹¶ç»™å‡ºåº”ç”¨åœºæ™¯&quot;</span></span><br><span class="line">response = sub_question_engine.query(complex_query)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ“ˆ-RAGè¯„ä¼°"><a href="#ğŸ“ˆ-RAGè¯„ä¼°" class="headerlink" title="ğŸ“ˆ RAGè¯„ä¼°"></a>ğŸ“ˆ RAGè¯„ä¼°</h3><h4 id="1-è¯„ä¼°æŒ‡æ ‡"><a href="#1-è¯„ä¼°æŒ‡æ ‡" class="headerlink" title="1. è¯„ä¼°æŒ‡æ ‡"></a>1. è¯„ä¼°æŒ‡æ ‡</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core.evaluation <span class="keyword">import</span> (</span><br><span class="line">    FaithfulnessEvaluator,</span><br><span class="line">    RelevancyEvaluator,</span><br><span class="line">    CorrectnessEvaluator</span><br><span class="line">)</span><br><span class="line"><span class="keyword">from</span> llama_index.core.evaluation <span class="keyword">import</span> BatchEvalRunner</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè¯„ä¼°å™¨</span></span><br><span class="line">faithfulness_evaluator = FaithfulnessEvaluator()</span><br><span class="line">relevancy_evaluator = RelevancyEvaluator()</span><br><span class="line">correctness_evaluator = CorrectnessEvaluator()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡†å¤‡è¯„ä¼°æ•°æ®</span></span><br><span class="line">eval_questions = [</span><br><span class="line">    <span class="string">&quot;ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ·±åº¦å­¦ä¹ æœ‰å“ªäº›åº”ç”¨ï¼Ÿ&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å¦‚ä½•é€‰æ‹©åˆé€‚çš„ç®—æ³•ï¼Ÿ&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¹é‡è¯„ä¼°</span></span><br><span class="line">runner = BatchEvalRunner(</span><br><span class="line">    &#123;<span class="string">&quot;faithfulness&quot;</span>: faithfulness_evaluator,</span><br><span class="line">     <span class="string">&quot;relevancy&quot;</span>: relevancy_evaluator,</span><br><span class="line">     <span class="string">&quot;correctness&quot;</span>: correctness_evaluator&#125;,</span><br><span class="line">    workers=<span class="number">2</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">eval_results = <span class="keyword">await</span> runner.aevaluate_queries(</span><br><span class="line">    query_engine, </span><br><span class="line">    queries=eval_questions</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç»“æœ</span></span><br><span class="line"><span class="keyword">for</span> query, result <span class="keyword">in</span> eval_results.items():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Query: <span class="subst">&#123;query&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> metric, score <span class="keyword">in</span> result.items():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;metric&#125;</span>: <span class="subst">&#123;score.score&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="2-è‡ªå®šä¹‰è¯„ä¼°"><a href="#2-è‡ªå®šä¹‰è¯„ä¼°" class="headerlink" title="2. è‡ªå®šä¹‰è¯„ä¼°"></a>2. è‡ªå®šä¹‰è¯„ä¼°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core.evaluation <span class="keyword">import</span> BaseEvaluator</span><br><span class="line"><span class="keyword">from</span> llama_index.core.evaluation.eval_utils <span class="keyword">import</span> get_responses</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomEvaluator</span>(<span class="title class_ inherited__">BaseEvaluator</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_prompts</span>(<span class="params">self</span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;eval_template&quot;</span>: (</span><br><span class="line">                <span class="string">&quot;è¯·è¯„ä¼°ä»¥ä¸‹å›ç­”çš„è´¨é‡ï¼ˆ1-5åˆ†ï¼‰ï¼š\n&quot;</span></span><br><span class="line">                <span class="string">&quot;é—®é¢˜: &#123;query&#125;\n&quot;</span></span><br><span class="line">                <span class="string">&quot;å›ç­”: &#123;response&#125;\n&quot;</span></span><br><span class="line">                <span class="string">&quot;è¯„åˆ†ï¼ˆ1-5ï¼‰:&quot;</span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_prompt_modules</span>(<span class="params">self</span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">aevaluate</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        query: <span class="built_in">str</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        response: <span class="built_in">str</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        contexts: <span class="built_in">list</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        **kwargs</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">        eval_response = <span class="keyword">await</span> <span class="variable language_">self</span>.llm.apredict(</span><br><span class="line">            <span class="variable language_">self</span>.eval_template,</span><br><span class="line">            query=query,</span><br><span class="line">            response=response</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æå–åˆ†æ•°</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            score = <span class="built_in">float</span>(eval_response.strip())</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            score = <span class="number">0.0</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;score&quot;</span>: score, <span class="string">&quot;feedback&quot;</span>: eval_response&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨è‡ªå®šä¹‰è¯„ä¼°å™¨</span></span><br><span class="line">custom_evaluator = CustomEvaluator()</span><br><span class="line">result = <span class="keyword">await</span> custom_evaluator.aevaluate(</span><br><span class="line">    query=<span class="string">&quot;ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ&quot;</span>,</span><br><span class="line">    response=<span class="string">&quot;æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªåˆ†æ”¯...&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ—„ï¸-å‘é‡æ•°æ®åº“å®æˆ˜"><a href="#ğŸ—„ï¸-å‘é‡æ•°æ®åº“å®æˆ˜" class="headerlink" title="ğŸ—„ï¸ å‘é‡æ•°æ®åº“å®æˆ˜"></a>ğŸ—„ï¸ å‘é‡æ•°æ®åº“å®æˆ˜</h2><h3 id="ğŸ¨-Chromaï¼šè½»é‡çº§å‘é‡æ•°æ®åº“"><a href="#ğŸ¨-Chromaï¼šè½»é‡çº§å‘é‡æ•°æ®åº“" class="headerlink" title="ğŸ¨ Chromaï¼šè½»é‡çº§å‘é‡æ•°æ®åº“"></a>ğŸ¨ Chromaï¼šè½»é‡çº§å‘é‡æ•°æ®åº“</h3><h4 id="1-åŸºç¡€ä½¿ç”¨"><a href="#1-åŸºç¡€ä½¿ç”¨" class="headerlink" title="1. åŸºç¡€ä½¿ç”¨"></a>1. åŸºç¡€ä½¿ç”¨</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> chromadb</span><br><span class="line"><span class="keyword">from</span> chromadb.config <span class="keyword">import</span> Settings</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå®¢æˆ·ç«¯</span></span><br><span class="line">client = chromadb.Client(Settings(</span><br><span class="line">    chroma_db_impl=<span class="string">&quot;duckdb+parquet&quot;</span>,</span><br><span class="line">    persist_directory=<span class="string">&quot;./chroma_db&quot;</span></span><br><span class="line">))</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºé›†åˆ</span></span><br><span class="line">collection = client.create_collection(</span><br><span class="line">    name=<span class="string">&quot;my_collection&quot;</span>,</span><br><span class="line">    metadata=&#123;<span class="string">&quot;hnsw:space&quot;</span>: <span class="string">&quot;cosine&quot;</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ æ–‡æ¡£</span></span><br><span class="line">documents = [</span><br><span class="line">    <span class="string">&quot;æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªé‡è¦åˆ†æ”¯&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ·±åº¦å­¦ä¹ ä½¿ç”¨å¤šå±‚ç¥ç»ç½‘ç»œ&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è‡ªç„¶è¯­è¨€å¤„ç†å¤„ç†äººç±»è¯­è¨€&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è®¡ç®—æœºè§†è§‰è®©æœºå™¨ç†è§£å›¾åƒ&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">ids = [<span class="string">f&quot;doc_<span class="subst">&#123;i&#125;</span>&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(documents))]</span><br><span class="line">metadatas = [&#123;<span class="string">&quot;topic&quot;</span>: <span class="string">&quot;AI&quot;</span>, <span class="string">&quot;index&quot;</span>: i&#125; <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(documents))]</span><br><span class="line"></span><br><span class="line">collection.add(</span><br><span class="line">    documents=documents,</span><br><span class="line">    ids=ids,</span><br><span class="line">    metadatas=metadatas</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢</span></span><br><span class="line">results = collection.query(</span><br><span class="line">    query_texts=[<span class="string">&quot;ä»€ä¹ˆæ˜¯æ·±åº¦å­¦ä¹ ï¼Ÿ&quot;</span>],</span><br><span class="line">    n_results=<span class="number">2</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æŸ¥è¯¢ç»“æœ:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(results[<span class="string">&#x27;documents&#x27;</span>][<span class="number">0</span>]):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>. <span class="subst">&#123;doc&#125;</span> (è·ç¦»: <span class="subst">&#123;results[<span class="string">&#x27;distances&#x27;</span>][<span class="number">0</span>][i]:<span class="number">.3</span>f&#125;</span>)&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="2-é«˜çº§åŠŸèƒ½"><a href="#2-é«˜çº§åŠŸèƒ½" class="headerlink" title="2. é«˜çº§åŠŸèƒ½"></a>2. é«˜çº§åŠŸèƒ½</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> chromadb.utils <span class="keyword">import</span> embedding_functions</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨è‡ªå®šä¹‰åµŒå…¥å‡½æ•°</span></span><br><span class="line">openai_ef = embedding_functions.OpenAIEmbeddingFunction(</span><br><span class="line">    api_key=<span class="string">&quot;your-api-key&quot;</span>,</span><br><span class="line">    model_name=<span class="string">&quot;text-embedding-ada-002&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå¸¦è‡ªå®šä¹‰åµŒå…¥çš„é›†åˆ</span></span><br><span class="line">advanced_collection = client.create_collection(</span><br><span class="line">    name=<span class="string">&quot;advanced_collection&quot;</span>,</span><br><span class="line">    embedding_function=openai_ef</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¹é‡æ“ä½œ</span></span><br><span class="line">batch_size = <span class="number">100</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(large_documents), batch_size):</span><br><span class="line">    batch_docs = large_documents[i:i+batch_size]</span><br><span class="line">    batch_ids = [<span class="string">f&quot;doc_<span class="subst">&#123;j&#125;</span>&quot;</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i, <span class="built_in">min</span>(i+batch_size, <span class="built_in">len</span>(large_documents)))]</span><br><span class="line">    </span><br><span class="line">    advanced_collection.add(</span><br><span class="line">        documents=batch_docs,</span><br><span class="line">        ids=batch_ids</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤æ‚æŸ¥è¯¢</span></span><br><span class="line">complex_results = advanced_collection.query(</span><br><span class="line">    query_texts=[<span class="string">&quot;æœºå™¨å­¦ä¹ ç®—æ³•&quot;</span>],</span><br><span class="line">    n_results=<span class="number">5</span>,</span><br><span class="line">    where=&#123;<span class="string">&quot;topic&quot;</span>: <span class="string">&quot;AI&quot;</span>&#125;,</span><br><span class="line">    include=[<span class="string">&quot;documents&quot;</span>, <span class="string">&quot;distances&quot;</span>, <span class="string">&quot;metadatas&quot;</span>]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ“Œ-Pineconeï¼šä¼ä¸šçº§å‘é‡æ•°æ®åº“"><a href="#ğŸ“Œ-Pineconeï¼šä¼ä¸šçº§å‘é‡æ•°æ®åº“" class="headerlink" title="ğŸ“Œ Pineconeï¼šä¼ä¸šçº§å‘é‡æ•°æ®åº“"></a>ğŸ“Œ Pineconeï¼šä¼ä¸šçº§å‘é‡æ•°æ®åº“</h3><h4 id="1-åŸºç¡€é…ç½®"><a href="#1-åŸºç¡€é…ç½®" class="headerlink" title="1. åŸºç¡€é…ç½®"></a>1. åŸºç¡€é…ç½®</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pinecone</span><br><span class="line"><span class="keyword">from</span> pinecone <span class="keyword">import</span> Pinecone, ServerlessSpec</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–Pinecone</span></span><br><span class="line">pc = Pinecone(api_key=<span class="string">&quot;your-api-key&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºç´¢å¼•</span></span><br><span class="line">index_name = <span class="string">&quot;ai-knowledge-base&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> index_name <span class="keyword">not</span> <span class="keyword">in</span> pc.list_indexes().names():</span><br><span class="line">    pc.create_index(</span><br><span class="line">        name=index_name,</span><br><span class="line">        dimension=<span class="number">1536</span>,  <span class="comment"># OpenAI embeddingç»´åº¦</span></span><br><span class="line">        metric=<span class="string">&quot;cosine&quot;</span>,</span><br><span class="line">        spec=ServerlessSpec(</span><br><span class="line">            cloud=<span class="string">&quot;aws&quot;</span>,</span><br><span class="line">            region=<span class="string">&quot;us-east-1&quot;</span></span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿æ¥ç´¢å¼•</span></span><br><span class="line">index = pc.Index(index_name)</span><br></pre></td></tr></table></figure>

<h4 id="2-æ•°æ®æ“ä½œ"><a href="#2-æ•°æ®æ“ä½œ" class="headerlink" title="2. æ•°æ®æ“ä½œ"></a>2. æ•°æ®æ“ä½œ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> openai</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_embeddings</span>(<span class="params">texts: <span class="type">List</span>[<span class="built_in">str</span>]</span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">float</span>]]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è·å–æ–‡æœ¬åµŒå…¥&quot;&quot;&quot;</span></span><br><span class="line">    response = openai.Embedding.create(</span><br><span class="line">        <span class="built_in">input</span>=texts,</span><br><span class="line">        model=<span class="string">&quot;text-embedding-ada-002&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> [item[<span class="string">&#x27;embedding&#x27;</span>] <span class="keyword">for</span> item <span class="keyword">in</span> response[<span class="string">&#x27;data&#x27;</span>]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡†å¤‡æ•°æ®</span></span><br><span class="line">documents = [</span><br><span class="line">    <span class="string">&quot;äººå·¥æ™ºèƒ½æ˜¯æ¨¡æ‹Ÿäººç±»æ™ºèƒ½çš„æŠ€æœ¯&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æœºå™¨å­¦ä¹ è®©è®¡ç®—æœºä»æ•°æ®ä¸­å­¦ä¹ &quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„å­é›†&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç¥ç»ç½‘ç»œæ˜¯æ·±åº¦å­¦ä¹ çš„åŸºç¡€&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–åµŒå…¥</span></span><br><span class="line">embeddings = get_embeddings(documents)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡†å¤‡å‘é‡æ•°æ®</span></span><br><span class="line">vectors = []</span><br><span class="line"><span class="keyword">for</span> i, (doc, embedding) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(documents, embeddings)):</span><br><span class="line">    vectors.append(&#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="string">f&quot;doc_<span class="subst">&#123;i&#125;</span>&quot;</span>,</span><br><span class="line">        <span class="string">&quot;values&quot;</span>: embedding,</span><br><span class="line">        <span class="string">&quot;metadata&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;text&quot;</span>: doc,</span><br><span class="line">            <span class="string">&quot;category&quot;</span>: <span class="string">&quot;AI&quot;</span>,</span><br><span class="line">            <span class="string">&quot;timestamp&quot;</span>: <span class="string">&quot;2024-01-01&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¹é‡æ’å…¥</span></span><br><span class="line">index.upsert(vectors=vectors)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢</span></span><br><span class="line">query_text = <span class="string">&quot;ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ&quot;</span></span><br><span class="line">query_embedding = get_embeddings([query_text])[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">results = index.query(</span><br><span class="line">    vector=query_embedding,</span><br><span class="line">    top_k=<span class="number">3</span>,</span><br><span class="line">    include_metadata=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æŸ¥è¯¢ç»“æœ:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">match</span> <span class="keyword">in</span> results[<span class="string">&#x27;matches&#x27;</span>]:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ç›¸ä¼¼åº¦: <span class="subst">&#123;<span class="keyword">match</span>[<span class="string">&#x27;score&#x27;</span>]:<span class="number">.3</span>f&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ–‡æœ¬: <span class="subst">&#123;<span class="keyword">match</span>[<span class="string">&#x27;metadata&#x27;</span>][<span class="string">&#x27;text&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="3-é«˜çº§æŸ¥è¯¢"><a href="#3-é«˜çº§æŸ¥è¯¢" class="headerlink" title="3. é«˜çº§æŸ¥è¯¢"></a>3. é«˜çº§æŸ¥è¯¢</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ··åˆæŸ¥è¯¢ï¼ˆå‘é‡+å…ƒæ•°æ®è¿‡æ»¤ï¼‰</span></span><br><span class="line">filtered_results = index.query(</span><br><span class="line">    vector=query_embedding,</span><br><span class="line">    top_k=<span class="number">5</span>,</span><br><span class="line">    <span class="built_in">filter</span>=&#123;</span><br><span class="line">        <span class="string">&quot;category&quot;</span>: &#123;<span class="string">&quot;$eq&quot;</span>: <span class="string">&quot;AI&quot;</span>&#125;,</span><br><span class="line">        <span class="string">&quot;timestamp&quot;</span>: &#123;<span class="string">&quot;$gte&quot;</span>: <span class="string">&quot;2024-01-01&quot;</span>&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    include_metadata=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘½åç©ºé—´æŸ¥è¯¢</span></span><br><span class="line">index.query(</span><br><span class="line">    vector=query_embedding,</span><br><span class="line">    top_k=<span class="number">3</span>,</span><br><span class="line">    namespace=<span class="string">&quot;production&quot;</span>,</span><br><span class="line">    include_metadata=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¹é‡æŸ¥è¯¢</span></span><br><span class="line">query_vectors = get_embeddings([</span><br><span class="line">    <span class="string">&quot;æ·±åº¦å­¦ä¹ çš„åº”ç”¨&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç¥ç»ç½‘ç»œç»“æ„&quot;</span></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">batch_results = index.query(</span><br><span class="line">    vector=query_vectors,</span><br><span class="line">    top_k=<span class="number">2</span>,</span><br><span class="line">    include_metadata=<span class="literal">True</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ¨-UIæ¡†æ¶ï¼šGradioå’ŒStreamlit"><a href="#ğŸ¨-UIæ¡†æ¶ï¼šGradioå’ŒStreamlit" class="headerlink" title="ğŸ¨ UIæ¡†æ¶ï¼šGradioå’ŒStreamlit"></a>ğŸ¨ UIæ¡†æ¶ï¼šGradioå’ŒStreamlit</h2><h3 id="ğŸš€-Gradioï¼šå¿«é€ŸAIåº”ç”¨åŸå‹"><a href="#ğŸš€-Gradioï¼šå¿«é€ŸAIåº”ç”¨åŸå‹" class="headerlink" title="ğŸš€ Gradioï¼šå¿«é€ŸAIåº”ç”¨åŸå‹"></a>ğŸš€ Gradioï¼šå¿«é€ŸAIåº”ç”¨åŸå‹</h3><h4 id="1-åŸºç¡€ç•Œé¢"><a href="#1-åŸºç¡€ç•Œé¢" class="headerlink" title="1. åŸºç¡€ç•Œé¢"></a>1. åŸºç¡€ç•Œé¢</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gradio <span class="keyword">as</span> gr</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> pipeline</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ–‡æœ¬ç”Ÿæˆç®¡é“</span></span><br><span class="line">generator = pipeline(<span class="string">&quot;text-generation&quot;</span>, model=<span class="string">&quot;gpt2&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_text</span>(<span class="params">prompt, max_length, temperature</span>):</span><br><span class="line">    result = generator(</span><br><span class="line">        prompt,</span><br><span class="line">        max_length=max_length,</span><br><span class="line">        temperature=temperature,</span><br><span class="line">        num_return_sequences=<span class="number">1</span>,</span><br><span class="line">        pad_token_id=generator.tokenizer.eos_token_id</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> result[<span class="number">0</span>][<span class="string">&#x27;generated_text&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºç•Œé¢</span></span><br><span class="line">iface = gr.Interface(</span><br><span class="line">    fn=generate_text,</span><br><span class="line">    inputs=[</span><br><span class="line">        gr.Textbox(label=<span class="string">&quot;è¾“å…¥æç¤º&quot;</span>, placeholder=<span class="string">&quot;è¯·è¾“å…¥æ–‡æœ¬...&quot;</span>),</span><br><span class="line">        gr.Slider(<span class="number">10</span>, <span class="number">100</span>, value=<span class="number">50</span>, label=<span class="string">&quot;æœ€å¤§é•¿åº¦&quot;</span>),</span><br><span class="line">        gr.Slider(<span class="number">0.1</span>, <span class="number">2.0</span>, value=<span class="number">0.7</span>, label=<span class="string">&quot;åˆ›é€ æ€§&quot;</span>)</span><br><span class="line">    ],</span><br><span class="line">    outputs=gr.Textbox(label=<span class="string">&quot;ç”Ÿæˆçš„æ–‡æœ¬&quot;</span>),</span><br><span class="line">    title=<span class="string">&quot;AIæ–‡æœ¬ç”Ÿæˆå™¨&quot;</span>,</span><br><span class="line">    description=<span class="string">&quot;ä½¿ç”¨GPT-2ç”Ÿæˆæ–‡æœ¬&quot;</span>,</span><br><span class="line">    examples=[</span><br><span class="line">        [<span class="string">&quot;äººå·¥æ™ºèƒ½çš„æœªæ¥&quot;</span>, <span class="number">50</span>, <span class="number">0.7</span>],</span><br><span class="line">        [<span class="string">&quot;æœºå™¨å­¦ä¹ ç®—æ³•&quot;</span>, <span class="number">80</span>, <span class="number">0.5</span>]</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">iface.launch()</span><br></pre></td></tr></table></figure>

<h4 id="2-å¤šåŠŸèƒ½åº”ç”¨"><a href="#2-å¤šåŠŸèƒ½åº”ç”¨" class="headerlink" title="2. å¤šåŠŸèƒ½åº”ç”¨"></a>2. å¤šåŠŸèƒ½åº”ç”¨</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gradio <span class="keyword">as</span> gr</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤šä¸ªAIåŠŸèƒ½</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">text_generation</span>(<span class="params">prompt</span>):</span><br><span class="line">    <span class="comment"># æ–‡æœ¬ç”Ÿæˆé€»è¾‘</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;ç”Ÿæˆçš„æ–‡æœ¬åŸºäº: <span class="subst">&#123;prompt&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">image_classification</span>(<span class="params">image</span>):</span><br><span class="line">    <span class="comment"># å›¾åƒåˆ†ç±»é€»è¾‘</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;çŒ«&quot;</span>: <span class="number">0.8</span>, <span class="string">&quot;ç‹—&quot;</span>: <span class="number">0.2</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sentiment_analysis</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="comment"># æƒ…æ„Ÿåˆ†æé€»è¾‘</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;æ­£é¢&quot;</span>: <span class="number">0.7</span>, <span class="string">&quot;è´Ÿé¢&quot;</span>: <span class="number">0.3</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå¤šæ ‡ç­¾é¡µç•Œé¢</span></span><br><span class="line"><span class="keyword">with</span> gr.Blocks(title=<span class="string">&quot;AIå·¥å…·ç®±&quot;</span>) <span class="keyword">as</span> demo:</span><br><span class="line">    gr.Markdown(<span class="string">&quot;# ğŸ¤– AIå·¥å…·ç®±&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> gr.Tab(<span class="string">&quot;æ–‡æœ¬ç”Ÿæˆ&quot;</span>):</span><br><span class="line">        <span class="keyword">with</span> gr.Row():</span><br><span class="line">            text_input = gr.Textbox(label=<span class="string">&quot;è¾“å…¥æç¤º&quot;</span>)</span><br><span class="line">            text_output = gr.Textbox(label=<span class="string">&quot;ç”Ÿæˆç»“æœ&quot;</span>)</span><br><span class="line">        text_btn = gr.Button(<span class="string">&quot;ç”Ÿæˆ&quot;</span>)</span><br><span class="line">        text_btn.click(text_generation, text_input, text_output)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> gr.Tab(<span class="string">&quot;å›¾åƒåˆ†ç±»&quot;</span>):</span><br><span class="line">        <span class="keyword">with</span> gr.Row():</span><br><span class="line">            image_input = gr.Image(label=<span class="string">&quot;ä¸Šä¼ å›¾åƒ&quot;</span>)</span><br><span class="line">            image_output = gr.Label(label=<span class="string">&quot;åˆ†ç±»ç»“æœ&quot;</span>)</span><br><span class="line">        image_btn = gr.Button(<span class="string">&quot;åˆ†ç±»&quot;</span>)</span><br><span class="line">        image_btn.click(image_classification, image_input, image_output)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> gr.Tab(<span class="string">&quot;æƒ…æ„Ÿåˆ†æ&quot;</span>):</span><br><span class="line">        <span class="keyword">with</span> gr.Row():</span><br><span class="line">            sentiment_input = gr.Textbox(label=<span class="string">&quot;è¾“å…¥æ–‡æœ¬&quot;</span>)</span><br><span class="line">            sentiment_output = gr.Label(label=<span class="string">&quot;æƒ…æ„Ÿåˆ†æ&quot;</span>)</span><br><span class="line">        sentiment_btn = gr.Button(<span class="string">&quot;åˆ†æ&quot;</span>)</span><br><span class="line">        sentiment_btn.click(sentiment_analysis, sentiment_input, sentiment_output)</span><br><span class="line"></span><br><span class="line">demo.launch(share=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ“Š-Streamlitï¼šæ•°æ®é©±åŠ¨çš„AIåº”ç”¨"><a href="#ğŸ“Š-Streamlitï¼šæ•°æ®é©±åŠ¨çš„AIåº”ç”¨" class="headerlink" title="ğŸ“Š Streamlitï¼šæ•°æ®é©±åŠ¨çš„AIåº”ç”¨"></a>ğŸ“Š Streamlitï¼šæ•°æ®é©±åŠ¨çš„AIåº”ç”¨</h3><h4 id="1-åŸºç¡€åº”ç”¨"><a href="#1-åŸºç¡€åº”ç”¨" class="headerlink" title="1. åŸºç¡€åº”ç”¨"></a>1. åŸºç¡€åº”ç”¨</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> plotly.express <span class="keyword">as</span> px</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> pipeline</span><br><span class="line"></span><br><span class="line"><span class="comment"># é¡µé¢é…ç½®</span></span><br><span class="line">st.set_page_config(</span><br><span class="line">    page_title=<span class="string">&quot;AIæ•°æ®åˆ†æå¹³å°&quot;</span>,</span><br><span class="line">    page_icon=<span class="string">&quot;ğŸ¤–&quot;</span>,</span><br><span class="line">    layout=<span class="string">&quot;wide&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ‡é¢˜</span></span><br><span class="line">st.title(<span class="string">&quot;ğŸ¤– AIæ•°æ®åˆ†æå¹³å°&quot;</span>)</span><br><span class="line">st.markdown(<span class="string">&quot;---&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾§è¾¹æ </span></span><br><span class="line"><span class="keyword">with</span> st.sidebar:</span><br><span class="line">    st.header(<span class="string">&quot;é…ç½®é€‰é¡¹&quot;</span>)</span><br><span class="line">    model_choice = st.selectbox(</span><br><span class="line">        <span class="string">&quot;é€‰æ‹©æ¨¡å‹&quot;</span>,</span><br><span class="line">        [<span class="string">&quot;sentiment-analysis&quot;</span>, <span class="string">&quot;text-classification&quot;</span>, <span class="string">&quot;summarization&quot;</span>]</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    confidence_threshold = st.slider(</span><br><span class="line">        <span class="string">&quot;ç½®ä¿¡åº¦é˜ˆå€¼&quot;</span>,</span><br><span class="line">        <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.5</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»è¦å†…å®¹</span></span><br><span class="line">col1, col2 = st.columns([<span class="number">2</span>, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> col1:</span><br><span class="line">    st.header(<span class="string">&quot;æ–‡æœ¬åˆ†æ&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ–‡æœ¬è¾“å…¥</span></span><br><span class="line">    user_input = st.text_area(</span><br><span class="line">        <span class="string">&quot;è¾“å…¥è¦åˆ†æçš„æ–‡æœ¬&quot;</span>,</span><br><span class="line">        height=<span class="number">150</span>,</span><br><span class="line">        placeholder=<span class="string">&quot;è¯·è¾“å…¥æ–‡æœ¬...&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> st.button(<span class="string">&quot;å¼€å§‹åˆ†æ&quot;</span>, <span class="built_in">type</span>=<span class="string">&quot;primary&quot;</span>):</span><br><span class="line">        <span class="keyword">if</span> user_input:</span><br><span class="line">            <span class="comment"># åˆ›å»ºåˆ†æç®¡é“</span></span><br><span class="line">            classifier = pipeline(model_choice)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># æ‰§è¡Œåˆ†æ</span></span><br><span class="line">            <span class="keyword">with</span> st.spinner(<span class="string">&quot;åˆ†æä¸­...&quot;</span>):</span><br><span class="line">                results = classifier(user_input)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># æ˜¾ç¤ºç»“æœ</span></span><br><span class="line">            st.success(<span class="string">&quot;åˆ†æå®Œæˆï¼&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># ç»“æœå¯è§†åŒ–</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(results, <span class="built_in">list</span>) <span class="keyword">and</span> <span class="built_in">len</span>(results) &gt; <span class="number">0</span>:</span><br><span class="line">                result = results[<span class="number">0</span>]</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># åˆ›å»ºæ•°æ®æ¡†</span></span><br><span class="line">                df = pd.DataFrame([</span><br><span class="line">                    &#123;<span class="string">&quot;æ ‡ç­¾&quot;</span>: result[<span class="string">&#x27;label&#x27;</span>], <span class="string">&quot;ç½®ä¿¡åº¦&quot;</span>: result[<span class="string">&#x27;score&#x27;</span>]&#125;</span><br><span class="line">                ])</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># æ˜¾ç¤ºè¡¨æ ¼</span></span><br><span class="line">                st.dataframe(df, use_container_width=<span class="literal">True</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># æ˜¾ç¤ºå›¾è¡¨</span></span><br><span class="line">                fig = px.bar(</span><br><span class="line">                    df, </span><br><span class="line">                    x=<span class="string">&quot;æ ‡ç­¾&quot;</span>, </span><br><span class="line">                    y=<span class="string">&quot;ç½®ä¿¡åº¦&quot;</span>,</span><br><span class="line">                    title=<span class="string">&quot;åˆ†æç»“æœ&quot;</span></span><br><span class="line">                )</span><br><span class="line">                st.plotly_chart(fig, use_container_width=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            st.warning(<span class="string">&quot;è¯·è¾“å…¥è¦åˆ†æçš„æ–‡æœ¬&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> col2:</span><br><span class="line">    st.header(<span class="string">&quot;ç»Ÿè®¡ä¿¡æ¯&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> user_input:</span><br><span class="line">        <span class="comment"># æ–‡æœ¬ç»Ÿè®¡</span></span><br><span class="line">        word_count = <span class="built_in">len</span>(user_input.split())</span><br><span class="line">        char_count = <span class="built_in">len</span>(user_input)</span><br><span class="line">        </span><br><span class="line">        st.metric(<span class="string">&quot;å­—ç¬¦æ•°&quot;</span>, char_count)</span><br><span class="line">        st.metric(<span class="string">&quot;å•è¯æ•°&quot;</span>, word_count)</span><br><span class="line">        st.metric(<span class="string">&quot;å¹³å‡è¯é•¿&quot;</span>, <span class="string">f&quot;<span class="subst">&#123;char_count/word_count:<span class="number">.1</span>f&#125;</span>&quot;</span> <span class="keyword">if</span> word_count &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&quot;0&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å†å²è®°å½•</span></span><br><span class="line">    st.header(<span class="string">&quot;ä½¿ç”¨å†å²&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;history&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> st.session_state:</span><br><span class="line">        st.session_state.history = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> user_input <span class="keyword">and</span> st.button(<span class="string">&quot;ä¿å­˜åˆ°å†å²&quot;</span>):</span><br><span class="line">        st.session_state.history.append(&#123;</span><br><span class="line">            <span class="string">&quot;æ—¶é—´&quot;</span>: pd.Timestamp.now().strftime(<span class="string">&quot;%H:%M:%S&quot;</span>),</span><br><span class="line">            <span class="string">&quot;æ–‡æœ¬&quot;</span>: user_input[:<span class="number">50</span>] + <span class="string">&quot;...&quot;</span> <span class="keyword">if</span> <span class="built_in">len</span>(user_input) &gt; <span class="number">50</span> <span class="keyword">else</span> user_input</span><br><span class="line">        &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> st.session_state.history:</span><br><span class="line">        history_df = pd.DataFrame(st.session_state.history)</span><br><span class="line">        st.dataframe(history_df, use_container_width=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h4 id="2-é«˜çº§åŠŸèƒ½-1"><a href="#2-é«˜çº§åŠŸèƒ½-1" class="headerlink" title="2. é«˜çº§åŠŸèƒ½"></a>2. é«˜çº§åŠŸèƒ½</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">from</span> streamlit_chat <span class="keyword">import</span> message</span><br><span class="line"><span class="keyword">from</span> streamlit_option_menu <span class="keyword">import</span> option_menu</span><br><span class="line"><span class="keyword">import</span> plotly.graph_objects <span class="keyword">as</span> go</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤šé¡µé¢åº”ç”¨</span></span><br><span class="line"><span class="keyword">with</span> st.sidebar:</span><br><span class="line">    selected = option_menu(</span><br><span class="line">        <span class="string">&quot;ä¸»èœå•&quot;</span>,</span><br><span class="line">        [<span class="string">&quot;èŠå¤©æœºå™¨äºº&quot;</span>, <span class="string">&quot;æ•°æ®åˆ†æ&quot;</span>, <span class="string">&quot;æ¨¡å‹è®­ç»ƒ&quot;</span>, <span class="string">&quot;è®¾ç½®&quot;</span>],</span><br><span class="line">        icons=[<span class="string">&quot;chat&quot;</span>, <span class="string">&quot;graph-up&quot;</span>, <span class="string">&quot;cpu&quot;</span>, <span class="string">&quot;gear&quot;</span>],</span><br><span class="line">        menu_icon=<span class="string">&quot;cast&quot;</span>,</span><br><span class="line">        default_index=<span class="number">0</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> selected == <span class="string">&quot;èŠå¤©æœºå™¨äºº&quot;</span>:</span><br><span class="line">    st.header(<span class="string">&quot;ğŸ¤– AIèŠå¤©åŠ©æ‰‹&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># åˆå§‹åŒ–èŠå¤©å†å²</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;messages&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> st.session_state:</span><br><span class="line">        st.session_state.messages = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ˜¾ç¤ºèŠå¤©å†å²</span></span><br><span class="line">    <span class="keyword">for</span> i, msg <span class="keyword">in</span> <span class="built_in">enumerate</span>(st.session_state.messages):</span><br><span class="line">        message(msg[<span class="string">&quot;content&quot;</span>], is_user=msg[<span class="string">&quot;role&quot;</span>] == <span class="string">&quot;user&quot;</span>, key=<span class="string">f&quot;msg_<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç”¨æˆ·è¾“å…¥</span></span><br><span class="line">    user_input = st.chat_input(<span class="string">&quot;è¾“å…¥æ¶ˆæ¯...&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> user_input:</span><br><span class="line">        <span class="comment"># æ·»åŠ ç”¨æˆ·æ¶ˆæ¯</span></span><br><span class="line">        st.session_state.messages.append(&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: user_input&#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ç”ŸæˆAIå›å¤ï¼ˆè¿™é‡Œåº”è¯¥è°ƒç”¨å®é™…çš„AIæ¨¡å‹ï¼‰</span></span><br><span class="line">        ai_response = <span class="string">f&quot;æˆ‘ç†è§£æ‚¨è¯´çš„ï¼š<span class="subst">&#123;user_input&#125;</span>ã€‚è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹å›å¤ã€‚&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ·»åŠ AIå›å¤</span></span><br><span class="line">        st.session_state.messages.append(&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: ai_response&#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># é‡æ–°è¿è¡Œä»¥æ›´æ–°ç•Œé¢</span></span><br><span class="line">        st.rerun()</span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> selected == <span class="string">&quot;æ•°æ®åˆ†æ&quot;</span>:</span><br><span class="line">    st.header(<span class="string">&quot;ğŸ“Š æ•°æ®åˆ†æ&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line">    uploaded_file = st.file_uploader(</span><br><span class="line">        <span class="string">&quot;ä¸Šä¼ CSVæ–‡ä»¶&quot;</span>,</span><br><span class="line">        <span class="built_in">type</span>=[<span class="string">&quot;csv&quot;</span>],</span><br><span class="line">        <span class="built_in">help</span>=<span class="string">&quot;è¯·ä¸Šä¼ è¦åˆ†æçš„CSVæ–‡ä»¶&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> uploaded_file:</span><br><span class="line">        <span class="comment"># è¯»å–æ•°æ®</span></span><br><span class="line">        df = pd.read_csv(uploaded_file)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ˜¾ç¤ºæ•°æ®é¢„è§ˆ</span></span><br><span class="line">        st.subheader(<span class="string">&quot;æ•°æ®é¢„è§ˆ&quot;</span>)</span><br><span class="line">        st.dataframe(df.head(), use_container_width=<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ•°æ®ç»Ÿè®¡</span></span><br><span class="line">        col1, col2, col3 = st.columns(<span class="number">3</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> col1:</span><br><span class="line">            st.metric(<span class="string">&quot;è¡Œæ•°&quot;</span>, <span class="built_in">len</span>(df))</span><br><span class="line">        <span class="keyword">with</span> col2:</span><br><span class="line">            st.metric(<span class="string">&quot;åˆ—æ•°&quot;</span>, <span class="built_in">len</span>(df.columns))</span><br><span class="line">        <span class="keyword">with</span> col3:</span><br><span class="line">            st.metric(<span class="string">&quot;ç¼ºå¤±å€¼&quot;</span>, df.isnull().<span class="built_in">sum</span>().<span class="built_in">sum</span>())</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># é€‰æ‹©åˆ—è¿›è¡Œåˆ†æ</span></span><br><span class="line">        numeric_columns = df.select_dtypes(include=[np.number]).columns.tolist()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> numeric_columns:</span><br><span class="line">            selected_column = st.selectbox(<span class="string">&quot;é€‰æ‹©è¦åˆ†æçš„åˆ—&quot;</span>, numeric_columns)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># åˆ›å»ºå›¾è¡¨</span></span><br><span class="line">            fig = go.Figure()</span><br><span class="line">            fig.add_trace(go.Histogram(x=df[selected_column], name=selected_column))</span><br><span class="line">            fig.update_layout(title=<span class="string">f&quot;<span class="subst">&#123;selected_column&#125;</span> åˆ†å¸ƒå›¾&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            st.plotly_chart(fig, use_container_width=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> selected == <span class="string">&quot;æ¨¡å‹è®­ç»ƒ&quot;</span>:</span><br><span class="line">    st.header(<span class="string">&quot;ğŸ§  æ¨¡å‹è®­ç»ƒ&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è®­ç»ƒå‚æ•°é…ç½®</span></span><br><span class="line">    <span class="keyword">with</span> st.expander(<span class="string">&quot;è®­ç»ƒå‚æ•°&quot;</span>, expanded=<span class="literal">True</span>):</span><br><span class="line">        col1, col2 = st.columns(<span class="number">2</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> col1:</span><br><span class="line">            epochs = st.number_input(<span class="string">&quot;è®­ç»ƒè½®æ•°&quot;</span>, min_value=<span class="number">1</span>, max_value=<span class="number">100</span>, value=<span class="number">10</span>)</span><br><span class="line">            batch_size = st.selectbox(<span class="string">&quot;æ‰¹æ¬¡å¤§å°&quot;</span>, [<span class="number">16</span>, <span class="number">32</span>, <span class="number">64</span>, <span class="number">128</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> col2:</span><br><span class="line">            learning_rate = st.number_input(<span class="string">&quot;å­¦ä¹ ç‡&quot;</span>, min_value=<span class="number">0.0001</span>, max_value=<span class="number">0.1</span>, value=<span class="number">0.001</span>, <span class="built_in">format</span>=<span class="string">&quot;%.4f&quot;</span>)</span><br><span class="line">            model_type = st.selectbox(<span class="string">&quot;æ¨¡å‹ç±»å‹&quot;</span>, [<span class="string">&quot;BERT&quot;</span>, <span class="string">&quot;RoBERTa&quot;</span>, <span class="string">&quot;DistilBERT&quot;</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è®­ç»ƒè¿›åº¦</span></span><br><span class="line">    <span class="keyword">if</span> st.button(<span class="string">&quot;å¼€å§‹è®­ç»ƒ&quot;</span>, <span class="built_in">type</span>=<span class="string">&quot;primary&quot;</span>):</span><br><span class="line">        progress_bar = st.progress(<span class="number">0</span>)</span><br><span class="line">        status_text = st.empty()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(epochs):</span><br><span class="line">            <span class="comment"># æ¨¡æ‹Ÿè®­ç»ƒè¿‡ç¨‹</span></span><br><span class="line">            progress = (i + <span class="number">1</span>) / epochs</span><br><span class="line">            progress_bar.progress(progress)</span><br><span class="line">            status_text.text(<span class="string">f&quot;è®­ç»ƒè¿›åº¦: <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>/<span class="subst">&#123;epochs&#125;</span> è½®&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># æ¨¡æ‹Ÿè®­ç»ƒæ—¶é—´</span></span><br><span class="line">            <span class="keyword">import</span> time</span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        </span><br><span class="line">        st.success(<span class="string">&quot;è®­ç»ƒå®Œæˆï¼&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> selected == <span class="string">&quot;è®¾ç½®&quot;</span>:</span><br><span class="line">    st.header(<span class="string">&quot;âš™ï¸ ç³»ç»Ÿè®¾ç½®&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># APIé…ç½®</span></span><br><span class="line">    <span class="keyword">with</span> st.expander(<span class="string">&quot;APIé…ç½®&quot;</span>):</span><br><span class="line">        api_key = st.text_input(<span class="string">&quot;OpenAI API Key&quot;</span>, <span class="built_in">type</span>=<span class="string">&quot;password&quot;</span>)</span><br><span class="line">        api_base = st.text_input(<span class="string">&quot;API Base URL&quot;</span>, value=<span class="string">&quot;https://api.openai.com/v1&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ¨¡å‹é…ç½®</span></span><br><span class="line">    <span class="keyword">with</span> st.expander(<span class="string">&quot;æ¨¡å‹é…ç½®&quot;</span>):</span><br><span class="line">        default_model = st.selectbox(</span><br><span class="line">            <span class="string">&quot;é»˜è®¤æ¨¡å‹&quot;</span>,</span><br><span class="line">            [<span class="string">&quot;gpt-3.5-turbo&quot;</span>, <span class="string">&quot;gpt-4&quot;</span>, <span class="string">&quot;claude-3-sonnet&quot;</span>]</span><br><span class="line">        )</span><br><span class="line">        max_tokens = st.number_input(<span class="string">&quot;æœ€å¤§Tokenæ•°&quot;</span>, min_value=<span class="number">100</span>, max_value=<span class="number">4000</span>, value=<span class="number">1000</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ä¿å­˜è®¾ç½®</span></span><br><span class="line">    <span class="keyword">if</span> st.button(<span class="string">&quot;ä¿å­˜è®¾ç½®&quot;</span>):</span><br><span class="line">        st.success(<span class="string">&quot;è®¾ç½®å·²ä¿å­˜ï¼&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ”§-å®æˆ˜é¡¹ç›®ï¼šæ„å»ºå®Œæ•´çš„RAGåº”ç”¨"><a href="#ğŸ”§-å®æˆ˜é¡¹ç›®ï¼šæ„å»ºå®Œæ•´çš„RAGåº”ç”¨" class="headerlink" title="ğŸ”§ å®æˆ˜é¡¹ç›®ï¼šæ„å»ºå®Œæ•´çš„RAGåº”ç”¨"></a>ğŸ”§ å®æˆ˜é¡¹ç›®ï¼šæ„å»ºå®Œæ•´çš„RAGåº”ç”¨</h2><h3 id="ğŸ“‹-é¡¹ç›®æ¶æ„"><a href="#ğŸ“‹-é¡¹ç›®æ¶æ„" class="headerlink" title="ğŸ“‹ é¡¹ç›®æ¶æ„"></a>ğŸ“‹ é¡¹ç›®æ¶æ„</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é¡¹ç›®ç»“æ„</span></span><br><span class="line">project_structure = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">rag_app/</span></span><br><span class="line"><span class="string">â”œâ”€â”€ app.py                 # Streamlitä¸»åº”ç”¨</span></span><br><span class="line"><span class="string">â”œâ”€â”€ components/</span></span><br><span class="line"><span class="string">â”‚   â”œâ”€â”€ __init__.py</span></span><br><span class="line"><span class="string">â”‚   â”œâ”€â”€ document_loader.py # æ–‡æ¡£åŠ è½½å™¨</span></span><br><span class="line"><span class="string">â”‚   â”œâ”€â”€ vector_store.py    # å‘é‡å­˜å‚¨</span></span><br><span class="line"><span class="string">â”‚   â”œâ”€â”€ retriever.py       # æ£€ç´¢å™¨</span></span><br><span class="line"><span class="string">â”‚   â””â”€â”€ generator.py       # ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="string">â”œâ”€â”€ config/</span></span><br><span class="line"><span class="string">â”‚   â”œâ”€â”€ __init__.py</span></span><br><span class="line"><span class="string">â”‚   â””â”€â”€ settings.py        # é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="string">â”œâ”€â”€ data/</span></span><br><span class="line"><span class="string">â”‚   â””â”€â”€ documents/         # æ–‡æ¡£å­˜å‚¨</span></span><br><span class="line"><span class="string">â”œâ”€â”€ requirements.txt       # ä¾èµ–åŒ…</span></span><br><span class="line"><span class="string">â””â”€â”€ README.md             # é¡¹ç›®è¯´æ˜</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="ğŸ—ï¸-æ ¸å¿ƒç»„ä»¶å®ç°"><a href="#ğŸ—ï¸-æ ¸å¿ƒç»„ä»¶å®ç°" class="headerlink" title="ğŸ—ï¸ æ ¸å¿ƒç»„ä»¶å®ç°"></a>ğŸ—ï¸ æ ¸å¿ƒç»„ä»¶å®ç°</h3><h4 id="1-é…ç½®ç®¡ç†"><a href="#1-é…ç½®ç®¡ç†" class="headerlink" title="1. é…ç½®ç®¡ç†"></a>1. é…ç½®ç®¡ç†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/settings.py</span></span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseSettings</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Settings</span>(<span class="title class_ inherited__">BaseSettings</span>):</span><br><span class="line">    <span class="comment"># APIé…ç½®</span></span><br><span class="line">    openai_api_key: <span class="built_in">str</span></span><br><span class="line">    anthropic_api_key: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ¨¡å‹é…ç½®</span></span><br><span class="line">    embedding_model: <span class="built_in">str</span> = <span class="string">&quot;text-embedding-ada-002&quot;</span></span><br><span class="line">    llm_model: <span class="built_in">str</span> = <span class="string">&quot;gpt-4-turbo&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å‘é‡æ•°æ®åº“é…ç½®</span></span><br><span class="line">    vector_db_type: <span class="built_in">str</span> = <span class="string">&quot;chroma&quot;</span>  <span class="comment"># chroma, pinecone</span></span><br><span class="line">    chroma_persist_directory: <span class="built_in">str</span> = <span class="string">&quot;./chroma_db&quot;</span></span><br><span class="line">    pinecone_index_name: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ£€ç´¢é…ç½®</span></span><br><span class="line">    chunk_size: <span class="built_in">int</span> = <span class="number">1000</span></span><br><span class="line">    chunk_overlap: <span class="built_in">int</span> = <span class="number">200</span></span><br><span class="line">    top_k: <span class="built_in">int</span> = <span class="number">4</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç”Ÿæˆé…ç½®</span></span><br><span class="line">    max_tokens: <span class="built_in">int</span> = <span class="number">1000</span></span><br><span class="line">    temperature: <span class="built_in">float</span> = <span class="number">0.7</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Config</span>:</span><br><span class="line">        env_file = <span class="string">&quot;.env&quot;</span></span><br><span class="line"></span><br><span class="line">settings = Settings()</span><br></pre></td></tr></table></figure>

<h4 id="2-æ–‡æ¡£åŠ è½½å™¨"><a href="#2-æ–‡æ¡£åŠ è½½å™¨" class="headerlink" title="2. æ–‡æ¡£åŠ è½½å™¨"></a>2. æ–‡æ¡£åŠ è½½å™¨</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># components/document_loader.py</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Union</span></span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> langchain.document_loaders <span class="keyword">import</span> (</span><br><span class="line">    TextLoader,</span><br><span class="line">    PyPDFLoader,</span><br><span class="line">    UnstructuredWordDocumentLoader,</span><br><span class="line">    CSVLoader</span><br><span class="line">)</span><br><span class="line"><span class="keyword">from</span> langchain.schema <span class="keyword">import</span> Document</span><br><span class="line"><span class="keyword">from</span> langchain.text_splitter <span class="keyword">import</span> RecursiveCharacterTextSplitter</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DocumentLoader</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, chunk_size: <span class="built_in">int</span> = <span class="number">1000</span>, chunk_overlap: <span class="built_in">int</span> = <span class="number">200</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.text_splitter = RecursiveCharacterTextSplitter(</span><br><span class="line">            chunk_size=chunk_size,</span><br><span class="line">            chunk_overlap=chunk_overlap,</span><br><span class="line">            length_function=<span class="built_in">len</span></span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load_file</span>(<span class="params">self, file_path: <span class="type">Union</span>[<span class="built_in">str</span>, Path]</span>) -&gt; <span class="type">List</span>[Document]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åŠ è½½å•ä¸ªæ–‡ä»¶&quot;&quot;&quot;</span></span><br><span class="line">        file_path = Path(file_path)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> file_path.suffix.lower() == <span class="string">&#x27;.txt&#x27;</span>:</span><br><span class="line">            loader = TextLoader(<span class="built_in">str</span>(file_path), encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> file_path.suffix.lower() == <span class="string">&#x27;.pdf&#x27;</span>:</span><br><span class="line">            loader = PyPDFLoader(<span class="built_in">str</span>(file_path))</span><br><span class="line">        <span class="keyword">elif</span> file_path.suffix.lower() <span class="keyword">in</span> [<span class="string">&#x27;.doc&#x27;</span>, <span class="string">&#x27;.docx&#x27;</span>]:</span><br><span class="line">            loader = UnstructuredWordDocumentLoader(<span class="built_in">str</span>(file_path))</span><br><span class="line">        <span class="keyword">elif</span> file_path.suffix.lower() == <span class="string">&#x27;.csv&#x27;</span>:</span><br><span class="line">            loader = CSVLoader(<span class="built_in">str</span>(file_path))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: <span class="subst">&#123;file_path.suffix&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        documents = loader.load()</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.text_splitter.split_documents(documents)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load_directory</span>(<span class="params">self, directory_path: <span class="type">Union</span>[<span class="built_in">str</span>, Path]</span>) -&gt; <span class="type">List</span>[Document]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åŠ è½½ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶&quot;&quot;&quot;</span></span><br><span class="line">        directory_path = Path(directory_path)</span><br><span class="line">        all_documents = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> file_path <span class="keyword">in</span> directory_path.rglob(<span class="string">&#x27;*&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> file_path.is_file() <span class="keyword">and</span> file_path.suffix.lower() <span class="keyword">in</span> [<span class="string">&#x27;.txt&#x27;</span>, <span class="string">&#x27;.pdf&#x27;</span>, <span class="string">&#x27;.doc&#x27;</span>, <span class="string">&#x27;.docx&#x27;</span>, <span class="string">&#x27;.csv&#x27;</span>]:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    documents = <span class="variable language_">self</span>.load_file(file_path)</span><br><span class="line">                    all_documents.extend(documents)</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;åŠ è½½æ–‡ä»¶ <span class="subst">&#123;file_path&#125;</span> æ—¶å‡ºé”™: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> all_documents</span><br></pre></td></tr></table></figure>

<h4 id="3-å‘é‡å­˜å‚¨ç®¡ç†"><a href="#3-å‘é‡å­˜å‚¨ç®¡ç†" class="headerlink" title="3. å‘é‡å­˜å‚¨ç®¡ç†"></a>3. å‘é‡å­˜å‚¨ç®¡ç†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># components/vector_store.py</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Optional</span></span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"><span class="keyword">from</span> langchain.schema <span class="keyword">import</span> Document</span><br><span class="line"><span class="keyword">from</span> langchain.vectorstores <span class="keyword">import</span> Chroma</span><br><span class="line"><span class="keyword">from</span> langchain.embeddings <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"><span class="keyword">import</span> chromadb</span><br><span class="line"><span class="keyword">from</span> config.settings <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VectorStoreBase</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_documents</span>(<span class="params">self, documents: <span class="type">List</span>[Document]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">similarity_search</span>(<span class="params">self, query: <span class="built_in">str</span>, k: <span class="built_in">int</span> = <span class="number">4</span></span>) -&gt; <span class="type">List</span>[Document]:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete_collection</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChromaVectorStore</span>(<span class="title class_ inherited__">VectorStoreBase</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, collection_name: <span class="built_in">str</span> = <span class="string">&quot;default&quot;</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.embeddings = OpenAIEmbeddings(</span><br><span class="line">            model=settings.embedding_model,</span><br><span class="line">            openai_api_key=settings.openai_api_key</span><br><span class="line">        )</span><br><span class="line">        <span class="variable language_">self</span>.collection_name = collection_name</span><br><span class="line">        <span class="variable language_">self</span>.vectorstore = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>._initialize_store()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_initialize_store</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åˆå§‹åŒ–å‘é‡å­˜å‚¨&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.vectorstore = Chroma(</span><br><span class="line">            collection_name=<span class="variable language_">self</span>.collection_name,</span><br><span class="line">            embedding_function=<span class="variable language_">self</span>.embeddings,</span><br><span class="line">            persist_directory=settings.chroma_persist_directory</span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_documents</span>(<span class="params">self, documents: <span class="type">List</span>[Document]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ·»åŠ æ–‡æ¡£åˆ°å‘é‡å­˜å‚¨&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> documents:</span><br><span class="line">            <span class="variable language_">self</span>.vectorstore.add_documents(documents)</span><br><span class="line">            <span class="variable language_">self</span>.vectorstore.persist()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">similarity_search</span>(<span class="params">self, query: <span class="built_in">str</span>, k: <span class="built_in">int</span> = <span class="number">4</span></span>) -&gt; <span class="type">List</span>[Document]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ç›¸ä¼¼æ€§æœç´¢&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.vectorstore.similarity_search(query, k=k)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete_collection</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åˆ é™¤é›†åˆ&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.vectorstore.delete_collection()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VectorStoreFactory</span>:</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_vector_store</span>(<span class="params">store_type: <span class="built_in">str</span> = <span class="string">&quot;chroma&quot;</span>, **kwargs</span>) -&gt; VectorStoreBase:</span><br><span class="line">        <span class="keyword">if</span> store_type == <span class="string">&quot;chroma&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> ChromaVectorStore(**kwargs)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;ä¸æ”¯æŒçš„å‘é‡å­˜å‚¨ç±»å‹: <span class="subst">&#123;store_type&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="4-æ£€ç´¢å™¨"><a href="#4-æ£€ç´¢å™¨" class="headerlink" title="4. æ£€ç´¢å™¨"></a>4. æ£€ç´¢å™¨</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># components/retriever.py</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Any</span></span><br><span class="line"><span class="keyword">from</span> langchain.schema <span class="keyword">import</span> Document</span><br><span class="line"><span class="keyword">from</span> langchain.retrievers <span class="keyword">import</span> ContextualCompressionRetriever</span><br><span class="line"><span class="keyword">from</span> langchain.retrievers.document_compressors <span class="keyword">import</span> LLMChainExtractor</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> components.vector_store <span class="keyword">import</span> VectorStoreBase</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdvancedRetriever</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, vector_store: VectorStoreBase, use_compression: <span class="built_in">bool</span> = <span class="literal">True</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.vector_store = vector_store</span><br><span class="line">        <span class="variable language_">self</span>.use_compression = use_compression</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> use_compression:</span><br><span class="line">            <span class="variable language_">self</span>.llm = ChatOpenAI(</span><br><span class="line">                model=settings.llm_model,</span><br><span class="line">                api_key=settings.openai_api_key,</span><br><span class="line">                temperature=<span class="number">0</span></span><br><span class="line">            )</span><br><span class="line">            <span class="variable language_">self</span>.compressor = LLMChainExtractor.from_llm(<span class="variable language_">self</span>.llm)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">retrieve</span>(<span class="params">self, query: <span class="built_in">str</span>, k: <span class="built_in">int</span> = <span class="literal">None</span></span>) -&gt; <span class="type">List</span>[Document]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ£€ç´¢ç›¸å…³æ–‡æ¡£&quot;&quot;&quot;</span></span><br><span class="line">        k = k <span class="keyword">or</span> settings.top_k</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># åŸºç¡€æ£€ç´¢</span></span><br><span class="line">        base_retriever = <span class="variable language_">self</span>.vector_store.vectorstore.as_retriever(</span><br><span class="line">            search_kwargs=&#123;<span class="string">&quot;k&quot;</span>: k&#125;</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.use_compression:</span><br><span class="line">            <span class="comment"># ä½¿ç”¨å‹ç¼©æ£€ç´¢å™¨</span></span><br><span class="line">            compression_retriever = ContextualCompressionRetriever(</span><br><span class="line">                base_compressor=<span class="variable language_">self</span>.compressor,</span><br><span class="line">                base_retriever=base_retriever</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">return</span> compression_retriever.get_relevant_documents(query)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> base_retriever.get_relevant_documents(query)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">retrieve_with_scores</span>(<span class="params">self, query: <span class="built_in">str</span>, k: <span class="built_in">int</span> = <span class="literal">None</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">tuple</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ£€ç´¢æ–‡æ¡£å¹¶è¿”å›ç›¸ä¼¼åº¦åˆ†æ•°&quot;&quot;&quot;</span></span><br><span class="line">        k = k <span class="keyword">or</span> settings.top_k</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.vector_store.vectorstore.similarity_search_with_score(query, k=k)</span><br></pre></td></tr></table></figure>

<h4 id="5-ç”Ÿæˆå™¨"><a href="#5-ç”Ÿæˆå™¨" class="headerlink" title="5. ç”Ÿæˆå™¨"></a>5. ç”Ÿæˆå™¨</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># components/generator.py</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Any</span>, <span class="type">Optional</span></span><br><span class="line"><span class="keyword">from</span> langchain.schema <span class="keyword">import</span> Document</span><br><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> RetrievalQA</span><br><span class="line"><span class="keyword">from</span> langchain.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> components.retriever <span class="keyword">import</span> AdvancedRetriever</span><br><span class="line"><span class="keyword">from</span> config.settings <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RAGGenerator</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, retriever: AdvancedRetriever</span>):</span><br><span class="line">        <span class="variable language_">self</span>.retriever = retriever</span><br><span class="line">        <span class="variable language_">self</span>.llm = ChatOpenAI(</span><br><span class="line">            model=settings.llm_model,</span><br><span class="line">            api_key=settings.openai_api_key,</span><br><span class="line">            temperature=settings.temperature,</span><br><span class="line">            max_tokens=settings.max_tokens</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è‡ªå®šä¹‰æç¤ºè¯æ¨¡æ¿</span></span><br><span class="line">        <span class="variable language_">self</span>.prompt_template = PromptTemplate(</span><br><span class="line">            input_variables=[<span class="string">&quot;context&quot;</span>, <span class="string">&quot;question&quot;</span>],</span><br><span class="line">            template=<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            åŸºäºä»¥ä¸‹ä¸Šä¸‹æ–‡ä¿¡æ¯å›ç­”é—®é¢˜ã€‚å¦‚æœä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¯·è¯´æ˜æ— æ³•ä»æä¾›çš„ä¿¡æ¯ä¸­æ‰¾åˆ°ç­”æ¡ˆã€‚</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š</span></span><br><span class="line"><span class="string">            &#123;context&#125;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            é—®é¢˜ï¼š&#123;question&#125;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            å›ç­”ï¼š</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># åˆ›å»ºQAé“¾</span></span><br><span class="line">        <span class="variable language_">self</span>.qa_chain = RetrievalQA.from_chain_type(</span><br><span class="line">            llm=<span class="variable language_">self</span>.llm,</span><br><span class="line">            chain_type=<span class="string">&quot;stuff&quot;</span>,</span><br><span class="line">            retriever=<span class="variable language_">self</span>.retriever.vector_store.vectorstore.as_retriever(),</span><br><span class="line">            chain_type_kwargs=&#123;<span class="string">&quot;prompt&quot;</span>: <span class="variable language_">self</span>.prompt_template&#125;,</span><br><span class="line">            return_source_documents=<span class="literal">True</span></span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_answer</span>(<span class="params">self, question: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ç”Ÿæˆç­”æ¡ˆ&quot;&quot;&quot;</span></span><br><span class="line">        result = <span class="variable language_">self</span>.qa_chain(&#123;<span class="string">&quot;query&quot;</span>: question&#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;answer&quot;</span>: result[<span class="string">&quot;result&quot;</span>],</span><br><span class="line">            <span class="string">&quot;source_documents&quot;</span>: result[<span class="string">&quot;source_documents&quot;</span>],</span><br><span class="line">            <span class="string">&quot;question&quot;</span>: question</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_streaming_answer</span>(<span class="params">self, question: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æµå¼ç”Ÿæˆç­”æ¡ˆ&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># æ£€ç´¢ç›¸å…³æ–‡æ¡£</span></span><br><span class="line">        docs = <span class="variable language_">self</span>.retriever.retrieve(question)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ„å»ºä¸Šä¸‹æ–‡</span></span><br><span class="line">        context = <span class="string">&quot;\n\n&quot;</span>.join([doc.page_content <span class="keyword">for</span> doc <span class="keyword">in</span> docs])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ„å»ºæç¤ºè¯</span></span><br><span class="line">        prompt = <span class="variable language_">self</span>.prompt_template.<span class="built_in">format</span>(context=context, question=question)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æµå¼ç”Ÿæˆ</span></span><br><span class="line">        <span class="keyword">for</span> chunk <span class="keyword">in</span> <span class="variable language_">self</span>.llm.stream(prompt):</span><br><span class="line">            <span class="keyword">yield</span> chunk.content</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ–¥ï¸-Streamlitåº”ç”¨ç•Œé¢"><a href="#ğŸ–¥ï¸-Streamlitåº”ç”¨ç•Œé¢" class="headerlink" title="ğŸ–¥ï¸ Streamlitåº”ç”¨ç•Œé¢"></a>ğŸ–¥ï¸ Streamlitåº”ç”¨ç•Œé¢</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app.py</span></span><br><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> components.document_loader <span class="keyword">import</span> DocumentLoader</span><br><span class="line"><span class="keyword">from</span> components.vector_store <span class="keyword">import</span> VectorStoreFactory</span><br><span class="line"><span class="keyword">from</span> components.retriever <span class="keyword">import</span> AdvancedRetriever</span><br><span class="line"><span class="keyword">from</span> components.generator <span class="keyword">import</span> RAGGenerator</span><br><span class="line"><span class="keyword">from</span> config.settings <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line"><span class="comment"># é¡µé¢é…ç½®</span></span><br><span class="line">st.set_page_config(</span><br><span class="line">    page_title=<span class="string">&quot;æ™ºèƒ½æ–‡æ¡£é—®ç­”ç³»ç»Ÿ&quot;</span>,</span><br><span class="line">    page_icon=<span class="string">&quot;ğŸ¤–&quot;</span>,</span><br><span class="line">    layout=<span class="string">&quot;wide&quot;</span>,</span><br><span class="line">    initial_sidebar_state=<span class="string">&quot;expanded&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–ä¼šè¯çŠ¶æ€</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;vector_store&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> st.session_state:</span><br><span class="line">    st.session_state.vector_store = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;rag_generator&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> st.session_state:</span><br><span class="line">    st.session_state.rag_generator = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;chat_history&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> st.session_state:</span><br><span class="line">    st.session_state.chat_history = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾§è¾¹æ é…ç½®</span></span><br><span class="line"><span class="keyword">with</span> st.sidebar:</span><br><span class="line">    st.header(<span class="string">&quot;ğŸ“ æ–‡æ¡£ç®¡ç†&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line">    uploaded_files = st.file_uploader(</span><br><span class="line">        <span class="string">&quot;ä¸Šä¼ æ–‡æ¡£&quot;</span>,</span><br><span class="line">        <span class="built_in">type</span>=[<span class="string">&quot;txt&quot;</span>, <span class="string">&quot;pdf&quot;</span>, <span class="string">&quot;docx&quot;</span>, <span class="string">&quot;csv&quot;</span>],</span><br><span class="line">        accept_multiple_files=<span class="literal">True</span>,</span><br><span class="line">        <span class="built_in">help</span>=<span class="string">&quot;æ”¯æŒTXTã€PDFã€DOCXã€CSVæ ¼å¼&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> uploaded_files <span class="keyword">and</span> st.button(<span class="string">&quot;å¤„ç†æ–‡æ¡£&quot;</span>, <span class="built_in">type</span>=<span class="string">&quot;primary&quot;</span>):</span><br><span class="line">        <span class="keyword">with</span> st.spinner(<span class="string">&quot;æ­£åœ¨å¤„ç†æ–‡æ¡£...&quot;</span>):</span><br><span class="line">            <span class="comment"># ä¿å­˜ä¸Šä¼ çš„æ–‡ä»¶</span></span><br><span class="line">            docs_dir = Path(<span class="string">&quot;./temp_docs&quot;</span>)</span><br><span class="line">            docs_dir.mkdir(exist_ok=<span class="literal">True</span>)</span><br><span class="line">            </span><br><span class="line">            saved_files = []</span><br><span class="line">            <span class="keyword">for</span> uploaded_file <span class="keyword">in</span> uploaded_files:</span><br><span class="line">                file_path = docs_dir / uploaded_file.name</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    f.write(uploaded_file.getbuffer())</span><br><span class="line">                saved_files.append(file_path)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># åŠ è½½æ–‡æ¡£</span></span><br><span class="line">            loader = DocumentLoader(</span><br><span class="line">                chunk_size=settings.chunk_size,</span><br><span class="line">                chunk_overlap=settings.chunk_overlap</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            all_documents = []</span><br><span class="line">            <span class="keyword">for</span> file_path <span class="keyword">in</span> saved_files:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    documents = loader.load_file(file_path)</span><br><span class="line">                    all_documents.extend(documents)</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    st.error(<span class="string">f&quot;å¤„ç†æ–‡ä»¶ <span class="subst">&#123;file_path.name&#125;</span> æ—¶å‡ºé”™: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> all_documents:</span><br><span class="line">                <span class="comment"># åˆ›å»ºå‘é‡å­˜å‚¨</span></span><br><span class="line">                vector_store = VectorStoreFactory.create_vector_store(</span><br><span class="line">                    store_type=settings.vector_db_type,</span><br><span class="line">                    collection_name=<span class="string">&quot;uploaded_docs&quot;</span></span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># æ·»åŠ æ–‡æ¡£åˆ°å‘é‡å­˜å‚¨</span></span><br><span class="line">                vector_store.add_documents(all_documents)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># åˆ›å»ºæ£€ç´¢å™¨å’Œç”Ÿæˆå™¨</span></span><br><span class="line">                retriever = AdvancedRetriever(vector_store)</span><br><span class="line">                rag_generator = RAGGenerator(retriever)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># ä¿å­˜åˆ°ä¼šè¯çŠ¶æ€</span></span><br><span class="line">                st.session_state.vector_store = vector_store</span><br><span class="line">                st.session_state.rag_generator = rag_generator</span><br><span class="line">                </span><br><span class="line">                st.success(<span class="string">f&quot;æˆåŠŸå¤„ç† <span class="subst">&#123;<span class="built_in">len</span>(all_documents)&#125;</span> ä¸ªæ–‡æ¡£ç‰‡æ®µï¼&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># æ¸…ç†ä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line">            <span class="keyword">for</span> file_path <span class="keyword">in</span> saved_files:</span><br><span class="line">                file_path.unlink()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç³»ç»Ÿé…ç½®</span></span><br><span class="line">    st.header(<span class="string">&quot;âš™ï¸ ç³»ç»Ÿé…ç½®&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ£€ç´¢å‚æ•°</span></span><br><span class="line">    top_k = st.slider(<span class="string">&quot;æ£€ç´¢æ–‡æ¡£æ•°é‡&quot;</span>, <span class="number">1</span>, <span class="number">10</span>, settings.top_k)</span><br><span class="line">    temperature = st.slider(<span class="string">&quot;ç”Ÿæˆæ¸©åº¦&quot;</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, settings.temperature, <span class="number">0.1</span>)</span><br><span class="line">    max_tokens = st.number_input(<span class="string">&quot;æœ€å¤§Tokenæ•°&quot;</span>, <span class="number">100</span>, <span class="number">2000</span>, settings.max_tokens)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ¸…é™¤å†å²</span></span><br><span class="line">    <span class="keyword">if</span> st.button(<span class="string">&quot;æ¸…é™¤å¯¹è¯å†å²&quot;</span>):</span><br><span class="line">        st.session_state.chat_history = []</span><br><span class="line">        st.rerun()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»ç•Œé¢</span></span><br><span class="line">st.title(<span class="string">&quot;ğŸ¤– æ™ºèƒ½æ–‡æ¡£é—®ç­”ç³»ç»Ÿ&quot;</span>)</span><br><span class="line">st.markdown(<span class="string">&quot;åŸºäºRAGæŠ€æœ¯çš„æ™ºèƒ½æ–‡æ¡£é—®ç­”ï¼Œæ”¯æŒå¤šç§æ–‡æ¡£æ ¼å¼&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥æ˜¯å¦å·²åŠ è½½æ–‡æ¡£</span></span><br><span class="line"><span class="keyword">if</span> st.session_state.rag_generator <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    st.info(<span class="string">&quot;ğŸ‘ˆ è¯·å…ˆåœ¨ä¾§è¾¹æ ä¸Šä¼ æ–‡æ¡£&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ˜¾ç¤ºç¤ºä¾‹</span></span><br><span class="line">    <span class="keyword">with</span> st.expander(<span class="string">&quot;ğŸ’¡ ä½¿ç”¨è¯´æ˜&quot;</span>, expanded=<span class="literal">True</span>):</span><br><span class="line">        st.markdown(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        ### å¦‚ä½•ä½¿ç”¨ï¼š</span></span><br><span class="line"><span class="string">        1. **ä¸Šä¼ æ–‡æ¡£**ï¼šåœ¨å·¦ä¾§ä¾§è¾¹æ ä¸Šä¼ æ‚¨çš„æ–‡æ¡£æ–‡ä»¶</span></span><br><span class="line"><span class="string">        2. **å¤„ç†æ–‡æ¡£**ï¼šç‚¹å‡»&quot;å¤„ç†æ–‡æ¡£&quot;æŒ‰é’®ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†æå’Œç´¢å¼•æ–‡æ¡£å†…å®¹</span></span><br><span class="line"><span class="string">        3. **å¼€å§‹é—®ç­”**ï¼šåœ¨ä¸‹æ–¹è¾“å…¥æ¡†ä¸­è¾“å…¥æ‚¨çš„é—®é¢˜</span></span><br><span class="line"><span class="string">        4. **æŸ¥çœ‹ç­”æ¡ˆ**ï¼šç³»ç»Ÿä¼šåŸºäºæ–‡æ¡£å†…å®¹ç”Ÿæˆå‡†ç¡®çš„ç­”æ¡ˆ</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        ### æ”¯æŒçš„æ–‡æ¡£æ ¼å¼ï¼š</span></span><br><span class="line"><span class="string">        - ğŸ“„ TXTæ–‡æœ¬æ–‡ä»¶</span></span><br><span class="line"><span class="string">        - ğŸ“• PDFæ–‡æ¡£</span></span><br><span class="line"><span class="string">        - ğŸ“˜ Wordæ–‡æ¡£ï¼ˆDOCXï¼‰</span></span><br><span class="line"><span class="string">        - ğŸ“Š CSVæ•°æ®æ–‡ä»¶</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        ### åŠŸèƒ½ç‰¹ç‚¹ï¼š</span></span><br><span class="line"><span class="string">        - ğŸ” æ™ºèƒ½æ£€ç´¢ï¼šåŸºäºè¯­ä¹‰ç›¸ä¼¼åº¦æ£€ç´¢ç›¸å…³å†…å®¹</span></span><br><span class="line"><span class="string">        - ğŸ§  ä¸Šä¸‹æ–‡ç†è§£ï¼šç»“åˆå¤šä¸ªæ–‡æ¡£ç‰‡æ®µç”Ÿæˆç»¼åˆç­”æ¡ˆ</span></span><br><span class="line"><span class="string">        - ğŸ“š æ¥æºè¿½è¸ªï¼šæ˜¾ç¤ºç­”æ¡ˆçš„å…·ä½“æ¥æºæ–‡æ¡£</span></span><br><span class="line"><span class="string">        - ğŸ’¬ å¯¹è¯è®°å¿†ï¼šæ”¯æŒå¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># å¯¹è¯ç•Œé¢</span></span><br><span class="line">    st.header(<span class="string">&quot;ğŸ’¬ æ™ºèƒ½é—®ç­”&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ˜¾ç¤ºå¯¹è¯å†å²</span></span><br><span class="line">    <span class="keyword">for</span> i, (question, answer, sources) <span class="keyword">in</span> <span class="built_in">enumerate</span>(st.session_state.chat_history):</span><br><span class="line">        <span class="keyword">with</span> st.container():</span><br><span class="line">            st.markdown(<span class="string">f&quot;**ğŸ™‹ é—®é¢˜ <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>ï¼š** <span class="subst">&#123;question&#125;</span>&quot;</span>)</span><br><span class="line">            st.markdown(<span class="string">f&quot;**ğŸ¤– å›ç­”ï¼š** <span class="subst">&#123;answer&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> sources:</span><br><span class="line">                <span class="keyword">with</span> st.expander(<span class="string">f&quot;ğŸ“š å‚è€ƒæ¥æº (<span class="subst">&#123;<span class="built_in">len</span>(sources)&#125;</span>ä¸ªæ–‡æ¡£ç‰‡æ®µ)&quot;</span>):</span><br><span class="line">                    <span class="keyword">for</span> j, source <span class="keyword">in</span> <span class="built_in">enumerate</span>(sources):</span><br><span class="line">                        st.markdown(<span class="string">f&quot;**ç‰‡æ®µ <span class="subst">&#123;j+<span class="number">1</span>&#125;</span>ï¼š**&quot;</span>)</span><br><span class="line">                        st.text(source.page_content[:<span class="number">300</span>] + <span class="string">&quot;...&quot;</span> <span class="keyword">if</span> <span class="built_in">len</span>(source.page_content) &gt; <span class="number">300</span> <span class="keyword">else</span> source.page_content)</span><br><span class="line">                        <span class="keyword">if</span> <span class="built_in">hasattr</span>(source, <span class="string">&#x27;metadata&#x27;</span>) <span class="keyword">and</span> source.metadata:</span><br><span class="line">                            st.caption(<span class="string">f&quot;æ¥æºï¼š<span class="subst">&#123;source.metadata&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            st.markdown(<span class="string">&quot;---&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># é—®é¢˜è¾“å…¥</span></span><br><span class="line">    question = st.text_input(</span><br><span class="line">        <span class="string">&quot;è¯·è¾“å…¥æ‚¨çš„é—®é¢˜ï¼š&quot;</span>,</span><br><span class="line">        placeholder=<span class="string">&quot;ä¾‹å¦‚ï¼šæ–‡æ¡£ä¸­æåˆ°äº†å“ªäº›å…³é”®æŠ€æœ¯ï¼Ÿ&quot;</span>,</span><br><span class="line">        key=<span class="string">&quot;question_input&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    col1, col2 = st.columns([<span class="number">1</span>, <span class="number">4</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> col1:</span><br><span class="line">        ask_button = st.button(<span class="string">&quot;ğŸš€ æé—®&quot;</span>, <span class="built_in">type</span>=<span class="string">&quot;primary&quot;</span>, use_container_width=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> col2:</span><br><span class="line">        stream_mode = st.checkbox(<span class="string">&quot;æµå¼è¾“å‡º&quot;</span>, value=<span class="literal">False</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ask_button <span class="keyword">and</span> question:</span><br><span class="line">        <span class="keyword">with</span> st.spinner(<span class="string">&quot;æ­£åœ¨æ€è€ƒä¸­...&quot;</span>):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> stream_mode:</span><br><span class="line">                    <span class="comment"># æµå¼è¾“å‡º</span></span><br><span class="line">                    answer_placeholder = st.empty()</span><br><span class="line">                    answer_text = <span class="string">&quot;&quot;</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">for</span> chunk <span class="keyword">in</span> st.session_state.rag_generator.generate_streaming_answer(question):</span><br><span class="line">                        answer_text += chunk</span><br><span class="line">                        answer_placeholder.markdown(<span class="string">f&quot;**ğŸ¤– å›ç­”ï¼š** <span class="subst">&#123;answer_text&#125;</span>&quot;</span>)</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># è·å–æ¥æºæ–‡æ¡£</span></span><br><span class="line">                    docs = st.session_state.rag_generator.retriever.retrieve(question, k=top_k)</span><br><span class="line">                    </span><br><span class="line">                    result = &#123;</span><br><span class="line">                        <span class="string">&quot;answer&quot;</span>: answer_text,</span><br><span class="line">                        <span class="string">&quot;source_documents&quot;</span>: docs,</span><br><span class="line">                        <span class="string">&quot;question&quot;</span>: question</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># æ™®é€šè¾“å‡º</span></span><br><span class="line">                    result = st.session_state.rag_generator.generate_answer(question)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># æ·»åŠ åˆ°å¯¹è¯å†å²</span></span><br><span class="line">                st.session_state.chat_history.append((</span><br><span class="line">                    result[<span class="string">&quot;question&quot;</span>],</span><br><span class="line">                    result[<span class="string">&quot;answer&quot;</span>],</span><br><span class="line">                    result[<span class="string">&quot;source_documents&quot;</span>]</span><br><span class="line">                ))</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># é‡æ–°è¿è¡Œä»¥æ˜¾ç¤ºæ–°çš„å¯¹è¯</span></span><br><span class="line">                st.rerun()</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                st.error(<span class="string">f&quot;ç”Ÿæˆç­”æ¡ˆæ—¶å‡ºé”™ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç»Ÿè®¡ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">if</span> st.session_state.chat_history:</span><br><span class="line">        st.header(<span class="string">&quot;ğŸ“Š å¯¹è¯ç»Ÿè®¡&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        col1, col2, col3 = st.columns(<span class="number">3</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> col1:</span><br><span class="line">            st.metric(<span class="string">&quot;å¯¹è¯è½®æ•°&quot;</span>, <span class="built_in">len</span>(st.session_state.chat_history))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> col2:</span><br><span class="line">            total_chars = <span class="built_in">sum</span>(<span class="built_in">len</span>(answer) <span class="keyword">for</span> _, answer, _ <span class="keyword">in</span> st.session_state.chat_history)</span><br><span class="line">            st.metric(<span class="string">&quot;æ€»å›ç­”å­—æ•°&quot;</span>, total_chars)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> col3:</span><br><span class="line">            avg_sources = <span class="built_in">sum</span>(<span class="built_in">len</span>(sources) <span class="keyword">for</span> _, _, sources <span class="keyword">in</span> st.session_state.chat_history) / <span class="built_in">len</span>(st.session_state.chat_history)</span><br><span class="line">            st.metric(<span class="string">&quot;å¹³å‡å‚è€ƒæ¥æº&quot;</span>, <span class="string">f&quot;<span class="subst">&#123;avg_sources:<span class="number">.1</span>f&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é¡µè„š</span></span><br><span class="line">st.markdown(<span class="string">&quot;---&quot;</span>)</span><br><span class="line">st.markdown(</span><br><span class="line">    <span class="string">&quot;&lt;div style=&#x27;text-align: center; color: gray;&#x27;&gt;&quot;</span>  </span><br><span class="line">    <span class="string">&quot;ğŸ¤– æ™ºèƒ½æ–‡æ¡£é—®ç­”ç³»ç»Ÿ | åŸºäºLangChainå’ŒStreamlitæ„å»º&quot;</span>  </span><br><span class="line">    <span class="string">&quot;&lt;/div&gt;&quot;</span>,</span><br><span class="line">    unsafe_allow_html=<span class="literal">True</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ“¦-éƒ¨ç½²é…ç½®"><a href="#ğŸ“¦-éƒ¨ç½²é…ç½®" class="headerlink" title="ğŸ“¦ éƒ¨ç½²é…ç½®"></a>ğŸ“¦ éƒ¨ç½²é…ç½®</h3><h4 id="1-ä¾èµ–æ–‡ä»¶"><a href="#1-ä¾èµ–æ–‡ä»¶" class="headerlink" title="1. ä¾èµ–æ–‡ä»¶"></a>1. ä¾èµ–æ–‡ä»¶</h4><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># requirements.txt</span><br><span class="line">streamlit&gt;=1.28.0</span><br><span class="line">langchain&gt;=0.1.0</span><br><span class="line">langchain-openai&gt;=0.0.5</span><br><span class="line">langchain-community&gt;=0.0.10</span><br><span class="line">chromadb&gt;=0.4.0</span><br><span class="line">openai&gt;=1.10.0</span><br><span class="line">tiktoken&gt;=0.5.0</span><br><span class="line">pandas&gt;=2.0.0</span><br><span class="line">numpy&gt;=1.24.0</span><br><span class="line">plotly&gt;=5.15.0</span><br><span class="line">pydantic&gt;=2.0.0</span><br><span class="line">python-dotenv&gt;=1.0.0</span><br><span class="line">PyPDF2&gt;=3.0.0</span><br><span class="line">python-docx&gt;=0.8.11</span><br><span class="line">unstructured&gt;=0.10.0</span><br><span class="line">jieba&gt;=0.42.1</span><br></pre></td></tr></table></figure>

<h4 id="2-ç¯å¢ƒé…ç½®"><a href="#2-ç¯å¢ƒé…ç½®" class="headerlink" title="2. ç¯å¢ƒé…ç½®"></a>2. ç¯å¢ƒé…ç½®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .env</span></span><br><span class="line">OPENAI_API_KEY=your-openai-api-key</span><br><span class="line">ANTHROPIC_API_KEY=your-anthropic-api-key</span><br><span class="line">EMBEDDING_MODEL=text-embedding-ada-002</span><br><span class="line">LLM_MODEL=gpt-4-turbo</span><br><span class="line">VECTOR_DB_TYPE=chroma</span><br><span class="line">CHROMA_PERSIST_DIRECTORY=./chroma_db</span><br><span class="line">CHUNK_SIZE=1000</span><br><span class="line">CHUNK_OVERLAP=200</span><br><span class="line">TOP_K=4</span><br><span class="line">MAX_TOKENS=1000</span><br><span class="line">TEMPERATURE=0.7</span><br></pre></td></tr></table></figure>

<h4 id="3-å¯åŠ¨è„šæœ¬"><a href="#3-å¯åŠ¨è„šæœ¬" class="headerlink" title="3. å¯åŠ¨è„šæœ¬"></a>3. å¯åŠ¨è„šæœ¬</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># run.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">python -m venv venv</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line"><span class="built_in">source</span> venv/bin/activate  <span class="comment"># Linux/Mac</span></span><br><span class="line"><span class="comment"># venv\Scripts\activate  # Windows</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…ä¾èµ–</span></span><br><span class="line">pip install -r requirements.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨åº”ç”¨</span></span><br><span class="line">streamlit run app.py --server.port 8501</span><br></pre></td></tr></table></figure>

<h2 id="ğŸš€-æœ€ä½³å®è·µå’Œä¼˜åŒ–å»ºè®®"><a href="#ğŸš€-æœ€ä½³å®è·µå’Œä¼˜åŒ–å»ºè®®" class="headerlink" title="ğŸš€ æœ€ä½³å®è·µå’Œä¼˜åŒ–å»ºè®®"></a>ğŸš€ æœ€ä½³å®è·µå’Œä¼˜åŒ–å»ºè®®</h2><h3 id="1-æ€§èƒ½ä¼˜åŒ–"><a href="#1-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="1. æ€§èƒ½ä¼˜åŒ–"></a>1. æ€§èƒ½ä¼˜åŒ–</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼“å­˜ä¼˜åŒ–</span></span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@functools.lru_cache(<span class="params">maxsize=<span class="number">128</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cached_embedding</span>(<span class="params">text: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">float</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ç¼“å­˜åµŒå…¥è®¡ç®—ç»“æœ&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> embeddings.embed_query(text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¹é‡å¤„ç†</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">batch_process_documents</span>(<span class="params">documents: <span class="type">List</span>[Document], batch_size: <span class="built_in">int</span> = <span class="number">10</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ‰¹é‡å¤„ç†æ–‡æ¡£ä»¥æé«˜æ•ˆç‡&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(documents), batch_size):</span><br><span class="line">        batch = documents[i:i + batch_size]</span><br><span class="line">        <span class="keyword">yield</span> batch</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼‚æ­¥å¤„ç†</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">async_generate_answer</span>(<span class="params">question: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å¼‚æ­¥ç”Ÿæˆç­”æ¡ˆ&quot;&quot;&quot;</span></span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line">    result = <span class="keyword">await</span> loop.run_in_executor(</span><br><span class="line">        <span class="literal">None</span>, </span><br><span class="line">        rag_generator.generate_answer, </span><br><span class="line">        question</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<h3 id="2-é”™è¯¯å¤„ç†"><a href="#2-é”™è¯¯å¤„ç†" class="headerlink" title="2. é”™è¯¯å¤„ç†"></a>2. é”™è¯¯å¤„ç†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¥å£®çš„é”™è¯¯å¤„ç†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RAGError</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;RAGç³»ç»Ÿè‡ªå®šä¹‰å¼‚å¸¸&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">safe_generate_answer</span>(<span class="params">question: <span class="built_in">str</span>, max_retries: <span class="built_in">int</span> = <span class="number">3</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å®‰å…¨çš„ç­”æ¡ˆç”Ÿæˆï¼ŒåŒ…å«é‡è¯•æœºåˆ¶&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> attempt <span class="keyword">in</span> <span class="built_in">range</span>(max_retries):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> rag_generator.generate_answer(question)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">if</span> attempt == max_retries - <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">raise</span> RAGError(<span class="string">f&quot;ç”Ÿæˆç­”æ¡ˆå¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            time.sleep(<span class="number">2</span> ** attempt)  <span class="comment"># æŒ‡æ•°é€€é¿</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;answer&quot;</span>: <span class="string">&quot;æŠ±æ­‰ï¼Œæš‚æ—¶æ— æ³•ç”Ÿæˆç­”æ¡ˆ&quot;</span>, <span class="string">&quot;source_documents&quot;</span>: []&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-ç›‘æ§å’Œæ—¥å¿—"><a href="#3-ç›‘æ§å’Œæ—¥å¿—" class="headerlink" title="3. ç›‘æ§å’Œæ—¥å¿—"></a>3. ç›‘æ§å’Œæ—¥å¿—</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®æ—¥å¿—</span></span><br><span class="line">logging.basicConfig(</span><br><span class="line">    level=logging.INFO,</span><br><span class="line">    <span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>,</span><br><span class="line">    handlers=[</span><br><span class="line">        logging.FileHandler(<span class="string">&#x27;rag_app.log&#x27;</span>),</span><br><span class="line">        logging.StreamHandler()</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MonitoredRAGGenerator</span>(<span class="title class_ inherited__">RAGGenerator</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_answer</span>(<span class="params">self, question: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        start_time = datetime.now()</span><br><span class="line">        logger.info(<span class="string">f&quot;å¼€å§‹å¤„ç†é—®é¢˜: <span class="subst">&#123;question[:<span class="number">50</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            result = <span class="built_in">super</span>().generate_answer(question)</span><br><span class="line">            duration = (datetime.now() - start_time).total_seconds()</span><br><span class="line">            </span><br><span class="line">            logger.info(<span class="string">f&quot;é—®é¢˜å¤„ç†å®Œæˆï¼Œè€—æ—¶: <span class="subst">&#123;duration:<span class="number">.2</span>f&#125;</span>ç§’&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(<span class="string">f&quot;é—®é¢˜å¤„ç†å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>

<h2 id="ğŸ“ˆ-è¿›é˜¶åŠŸèƒ½æ‰©å±•"><a href="#ğŸ“ˆ-è¿›é˜¶åŠŸèƒ½æ‰©å±•" class="headerlink" title="ğŸ“ˆ è¿›é˜¶åŠŸèƒ½æ‰©å±•"></a>ğŸ“ˆ è¿›é˜¶åŠŸèƒ½æ‰©å±•</h2><h3 id="1-å¤šæ¨¡æ€RAG"><a href="#1-å¤šæ¨¡æ€RAG" class="headerlink" title="1. å¤šæ¨¡æ€RAG"></a>1. å¤šæ¨¡æ€RAG</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ”¯æŒå›¾åƒå’Œæ–‡æœ¬çš„å¤šæ¨¡æ€RAG</span></span><br><span class="line"><span class="keyword">from</span> langchain.document_loaders <span class="keyword">import</span> UnstructuredImageLoader</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MultiModalRAG</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.text_retriever = AdvancedRetriever(text_vector_store)</span><br><span class="line">        <span class="variable language_">self</span>.image_retriever = AdvancedRetriever(image_vector_store)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_image</span>(<span class="params">self, image_path: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç†å›¾åƒå¹¶æå–æ–‡æœ¬æè¿°&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># ä½¿ç”¨GPT-4Våˆ†æå›¾åƒ</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(image_path, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> image_file:</span><br><span class="line">            response = openai.ChatCompletion.create(</span><br><span class="line">                model=<span class="string">&quot;gpt-4-vision-preview&quot;</span>,</span><br><span class="line">                messages=[</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;content&quot;</span>: [</span><br><span class="line">                            &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>, <span class="string">&quot;text&quot;</span>: <span class="string">&quot;è¯·è¯¦ç»†æè¿°è¿™å¼ å›¾ç‰‡çš„å†…å®¹&quot;</span>&#125;,</span><br><span class="line">                            &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;image_url&quot;</span>, <span class="string">&quot;image_url&quot;</span>: &#123;<span class="string">&quot;url&quot;</span>: <span class="string">f&quot;data:image/jpeg;base64,<span class="subst">&#123;base64.b64encode(image_file.read()).decode()&#125;</span>&quot;</span>&#125;&#125;</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">return</span> response.choices[<span class="number">0</span>].message.content</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">multimodal_search</span>(<span class="params">self, query: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[Document]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤šæ¨¡æ€æœç´¢&quot;&quot;&quot;</span></span><br><span class="line">        text_results = <span class="variable language_">self</span>.text_retriever.retrieve(query)</span><br><span class="line">        image_results = <span class="variable language_">self</span>.image_retriever.retrieve(query)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># åˆå¹¶å’Œæ’åºç»“æœ</span></span><br><span class="line">        all_results = text_results + image_results</span><br><span class="line">        <span class="keyword">return</span> all_results[:<span class="number">10</span>]  <span class="comment"># è¿”å›å‰10ä¸ªç»“æœ</span></span><br></pre></td></tr></table></figure>

<h3 id="2-å®æ—¶å­¦ä¹ å’Œæ›´æ–°"><a href="#2-å®æ—¶å­¦ä¹ å’Œæ›´æ–°" class="headerlink" title="2. å®æ—¶å­¦ä¹ å’Œæ›´æ–°"></a>2. å®æ—¶å­¦ä¹ å’Œæ›´æ–°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®æ—¶å­¦ä¹ ç³»ç»Ÿ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdaptiveRAG</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.feedback_store = []</span><br><span class="line">        <span class="variable language_">self</span>.performance_metrics = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">collect_feedback</span>(<span class="params">self, question: <span class="built_in">str</span>, answer: <span class="built_in">str</span>, rating: <span class="built_in">int</span>, feedback: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ”¶é›†ç”¨æˆ·åé¦ˆ&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.feedback_store.append(&#123;</span><br><span class="line">            <span class="string">&quot;question&quot;</span>: question,</span><br><span class="line">            <span class="string">&quot;answer&quot;</span>: answer,</span><br><span class="line">            <span class="string">&quot;rating&quot;</span>: rating,</span><br><span class="line">            <span class="string">&quot;feedback&quot;</span>: feedback,</span><br><span class="line">            <span class="string">&quot;timestamp&quot;</span>: datetime.now()</span><br><span class="line">        &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_retrieval_strategy</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åŸºäºåé¦ˆæ›´æ–°æ£€ç´¢ç­–ç•¥&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># åˆ†æåé¦ˆæ•°æ®</span></span><br><span class="line">        low_rating_questions = [</span><br><span class="line">            item <span class="keyword">for</span> item <span class="keyword">in</span> <span class="variable language_">self</span>.feedback_store </span><br><span class="line">            <span class="keyword">if</span> item[<span class="string">&quot;rating&quot;</span>] &lt; <span class="number">3</span></span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è°ƒæ•´æ£€ç´¢å‚æ•°</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(low_rating_questions) &gt; <span class="number">10</span>:</span><br><span class="line">            <span class="comment"># å¢åŠ æ£€ç´¢çš„æ–‡æ¡£æ•°é‡</span></span><br><span class="line">            settings.top_k = <span class="built_in">min</span>(settings.top_k + <span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">            logger.info(<span class="string">f&quot;è°ƒæ•´æ£€ç´¢å‚æ•°ï¼Œtop_kå¢åŠ åˆ°: <span class="subst">&#123;settings.top_k&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ¯-æ€»ç»“å’Œé€‰æ‹©å»ºè®®"><a href="#ğŸ¯-æ€»ç»“å’Œé€‰æ‹©å»ºè®®" class="headerlink" title="ğŸ¯ æ€»ç»“å’Œé€‰æ‹©å»ºè®®"></a>ğŸ¯ æ€»ç»“å’Œé€‰æ‹©å»ºè®®</h2><h3 id="æ¡†æ¶é€‰æ‹©çŸ©é˜µ"><a href="#æ¡†æ¶é€‰æ‹©çŸ©é˜µ" class="headerlink" title="æ¡†æ¶é€‰æ‹©çŸ©é˜µ"></a>æ¡†æ¶é€‰æ‹©çŸ©é˜µ</h3><table>
<thead>
<tr>
<th>ä½¿ç”¨åœºæ™¯</th>
<th>æ¨èæ¡†æ¶ç»„åˆ</th>
<th>ç†ç”±</th>
</tr>
</thead>
<tbody><tr>
<td><strong>å¿«é€ŸåŸå‹</strong></td>
<td>LangChain + Gradio</td>
<td>å¼€å‘é€Ÿåº¦å¿«ï¼Œç»„ä»¶ä¸°å¯Œ</td>
</tr>
<tr>
<td><strong>ä¼ä¸šåº”ç”¨</strong></td>
<td>LlamaIndex + Streamlit</td>
<td>ä¸“ä¸šRAGï¼Œç•Œé¢ç¾è§‚</td>
</tr>
<tr>
<td><strong>ç ”ç©¶é¡¹ç›®</strong></td>
<td>Transformers + Jupyter</td>
<td>çµæ´»æ€§é«˜ï¼Œå¯å®šåˆ¶æ€§å¼º</td>
</tr>
<tr>
<td><strong>ç”Ÿäº§ç¯å¢ƒ</strong></td>
<td>LangChain + FastAPI + React</td>
<td>æ€§èƒ½ç¨³å®šï¼Œå¯æ‰©å±•æ€§å¥½</td>
</tr>
</tbody></table>
<h3 id="å­¦ä¹ è·¯å¾„å»ºè®®"><a href="#å­¦ä¹ è·¯å¾„å»ºè®®" class="headerlink" title="å­¦ä¹ è·¯å¾„å»ºè®®"></a>å­¦ä¹ è·¯å¾„å»ºè®®</h3><ol>
<li><p><strong>å…¥é—¨é˜¶æ®µ</strong>ï¼ˆ1-2å‘¨ï¼‰</p>
<ul>
<li>å­¦ä¹ LangChainåŸºç¡€æ¦‚å¿µ</li>
<li>å®Œæˆç®€å•çš„LLMè°ƒç”¨</li>
<li>å°è¯•Gradioå¿«é€ŸåŸå‹</li>
</ul>
</li>
<li><p><strong>è¿›é˜¶é˜¶æ®µ</strong>ï¼ˆ2-4å‘¨ï¼‰</p>
<ul>
<li>æŒæ¡RAGç³»ç»Ÿæ„å»º</li>
<li>å­¦ä¹ å‘é‡æ•°æ®åº“ä½¿ç”¨</li>
<li>å¼€å‘å®Œæ•´çš„é—®ç­”åº”ç”¨</li>
</ul>
</li>
<li><p><strong>é«˜çº§é˜¶æ®µ</strong>ï¼ˆ1-2ä¸ªæœˆï¼‰</p>
<ul>
<li>ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½</li>
<li>æ·»åŠ ç›‘æ§å’Œæ—¥å¿—</li>
<li>éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ</li>
</ul>
</li>
</ol>
<h3 id="å¸¸è§é—®é¢˜è§£å†³"><a href="#å¸¸è§é—®é¢˜è§£å†³" class="headerlink" title="å¸¸è§é—®é¢˜è§£å†³"></a>å¸¸è§é—®é¢˜è§£å†³</h3><ol>
<li><strong>å†…å­˜ä¸è¶³</strong>ï¼šä½¿ç”¨æ‰¹é‡å¤„ç†å’Œç¼“å­˜ä¼˜åŒ–</li>
<li><strong>å“åº”æ…¢</strong>ï¼šä¼˜åŒ–æ£€ç´¢ç®—æ³•å’Œæ¨¡å‹é€‰æ‹©</li>
<li><strong>ç­”æ¡ˆè´¨é‡å·®</strong>ï¼šæ”¹è¿›æç¤ºè¯å’Œå¢åŠ ä¸Šä¸‹æ–‡</li>
<li><strong>æˆæœ¬è¿‡é«˜</strong>ï¼šä½¿ç”¨æœ¬åœ°æ¨¡å‹æˆ–ä¼˜åŒ–APIè°ƒç”¨</li>
</ol>
<hr>
<p>AIåº”ç”¨å¼€å‘æ¡†æ¶ä¸ºæ„å»ºæ™ºèƒ½åº”ç”¨æä¾›äº†å¼ºå¤§çš„åŸºç¡€è®¾æ–½ã€‚é€šè¿‡åˆç†é€‰æ‹©å’Œç»„åˆè¿™äº›æ¡†æ¶ï¼Œæ‚¨å¯ä»¥å¿«é€Ÿæ„å»ºå‡ºåŠŸèƒ½å¼ºå¤§ã€æ€§èƒ½ä¼˜ç§€çš„AIåº”ç”¨ã€‚</p>
<p><strong>ä¸‹ä¸€ç¯‡é¢„å‘Š</strong>ï¼š<a href="./ai-programming-assistants.md">AIç¼–ç¨‹åŠ©æ‰‹ä½¿ç”¨æŒ‡å—</a> - æ·±å…¥äº†è§£GitHub Copilotã€Cursorç­‰AIç¼–ç¨‹å·¥å…·çš„ä½¿ç”¨æŠ€å·§ã€‚</p>
<p><em>æœ¬æ–‡ä¸ºAIå¼€å‘å·¥å…·ç³»åˆ—æ–‡ç« ç¬¬ä¸‰ç¯‡ï¼Œæ›´å¤šç²¾å½©å†…å®¹è¯·å…³æ³¨åç»­æ–‡ç« ã€‚</em></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/AI%E5%BC%80%E5%8F%91/" rel="tag"># AIå¼€å‘</a>
              <a href="/tags/LangChain/" rel="tag"># LangChain</a>
              <a href="/tags/LlamaIndex/" rel="tag"># LlamaIndex</a>
              <a href="/tags/RAG/" rel="tag"># RAG</a>
              <a href="/tags/Agent/" rel="tag"># Agent</a>
              <a href="/tags/%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"># å‘é‡æ•°æ®åº“</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/08/07/local-ai-model-deployment-tools/" rel="prev" title="æœ¬åœ°AIæ¨¡å‹éƒ¨ç½²å·¥å…·è¯¦è§£ï¼šä»LM Studioåˆ°Ollamaçš„å®Œæ•´æŒ‡å—">
                  <i class="fa fa-angle-left"></i> æœ¬åœ°AIæ¨¡å‹éƒ¨ç½²å·¥å…·è¯¦è§£ï¼šä»LM Studioåˆ°Ollamaçš„å®Œæ•´æŒ‡å—
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/08/10/legend-eternal-update-instance-node-gm-commands/" rel="next" title="ä¼ å¥‡æ°¸æ’æ›´æ–°ï¼šå‰¯æœ¬èŠ‚ç‚¹ç³»ç»Ÿä¸ GM å˜é‡å‘½ä»¤ä¸Šçº¿ï¼Œå…¨é¢æ”¯æŒã€Œä¹å±‚å¦–å¡”ã€">
                  ä¼ å¥‡æ°¸æ’æ›´æ–°ï¼šå‰¯æœ¬èŠ‚ç‚¹ç³»ç»Ÿä¸ GM å˜é‡å‘½ä»¤ä¸Šçº¿ï¼Œå…¨é¢æ”¯æŒã€Œä¹å±‚å¦–å¡”ã€ <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">V.Joker</span>
  </div><footer class="custom-footer">
    <p>å¾®ç¬‘æ˜¯æ··ä¹±çš„æœ€ä½³é¢å…·</p>
</footer>


    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
